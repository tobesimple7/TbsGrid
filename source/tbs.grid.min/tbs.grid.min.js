TbsGrid=function(gridId){this.gridId=gridId;this.gridConfig=tbsGridConfigs[Object.keys(tbsGridConfigs)[0]];this.maxRowId=-1;this.topMaxRowId=1;this.footerMaxRowId=1;this.data_user=[];this.data_table=[];this.data_view=[];this.data_temp=[];this.data_page=[];this.data_top=[];this.data_footer=[];this.data_update=[];this.data_insert=[];this.data_delete=[];this.data_select_panel30=[];this.data_select_panel31=[];this.pageRowCount=0;this.pageIntRowCount=0;this.startRowIndex=-1;this.startCellIndex=-1;this.lastRowIndex=-1;this.lastCellIndex=-1;this._startRowIndex=-1;this._startCellIndex=-1;this._lastRowIndex=-1;this._lastCellIndex=-1;this.selectRangeArray=[];this.startX=0;this.startY=0;this.lastX=0;this.lastY=0;this.userColumns=[];this.headerColumns=[];this.headerColumnTable=[];this.topColumns=[];this.footerColumns=[];this.module_default=null;this.module_toolbar="toolbar";this.module_header="header";this.module_content="content";this.module_top="top";this.module_footer="footer";this.module_fixedRow="fixedRow";this.module_fixedColumn="fixedColumn";this.module_filtering="filtering";this.module_grouping="grouping";this.module_sorting="sorting";this.module_column="column";this.module_paging="paging";this.module_pagination="pagination";this.toolbar={};this.filtering={};this.grouping={};this.sorting={};this.column_name="name";this.column_text="text";this.column_type="type";this.column_width="width";this.column_editable="editable";this.column_visible="visible";this.column_align="align";this.column_scale="scale";this.column_roundType="roundType";this.column_fixedScale="fixedScale";this.column_scaleMax="scaleMax";this.column_scaleMin="scalemin";this.column_showZero="showZero";this.column_commaUnit="commaUnit";this.column_thousandChar="thousandChar";this.column_decimalChar="decimalChar";this.column_currencyChar="currencyChar";this.column_className="className";this.column_summaryType="summaryType";this.column_required="required";this.column_combo="combo";this.column_format="format";this.column_children="children";this.column_kind="kind";this.column_rowSpan="rowSpan";this.column_colSpan="colSpan";this.column_rowIndex="rowIndex";this.column_colIndex="colIndex";this.column_fromcol="fromcol";this.column_tocol="tocol";this.column_num="_number";this.column_parentNum="_parentNumber";this.column_subRowSpan="subRowSpan";this.column_subColSpan="subColSpan";this.column_order="order";this.columns=[];this.filterColumns=[];this.const_filterValue="value";this.const_filterType="type";this.const_filterexcludedValues="excludedValues";this.const_filterEqual=1;this.const_filterNotEqual=2;this.const_filterGreater=3;this.const_filterGreaterEqual=4;this.const_filterLess=5;this.const_filterLessEqual=6;this.const_filterBetween=7;this.const_filterBlank=8;this.const_filterInclude=9;this.const_filterNotInclude=10;this.const_filterStartCharacter=11;this.const_filterEndCharacter=12;this.const_filterReset="Reset";this.const_filterSave="Save";this.summaryColumns=[];this.headerRowCount=0;this.options={};this.toolbar_filter_placeholder="Search";this.toolbar_visible=true;this.options.toolbar={};this.options.toolbar[this.toolbar_visible]=true;this.option_filterVisible="showFilterPanel";this.options[this.option_filterVisible]=false;this.option_sortVisible="showSortPanel";this.options[this.option_sortVisible]=false;this.option_groupVisible="showGroupPanel";this.options[this.option_groupVisible]=false;this.option_sortable="sortable";this.option_resizable="resizable";this.option_movable="movable";this.option_autoResizable="autoResizable";this.option_autoWidth="autoWidth";this.options[this.option_sortable]=true;this.options[this.option_resizable]=true;this.options[this.option_movable]=true;this.options[this.option_autoResizable]=true;this.options[this.option_autoWidth]=false;this.option_selectMode="selectMode";this.option_addRow="addRow";this.option_delRow="delRow";this.options[this.option_selectMode]="cells";this.options[this.option_addRow]=false;this.options[this.option_delRow]=false;this.option_rowMode="rowMode";this.option_checkbox="checkbox";this.option_numWidth="numWidth";this.option_rowModeWidth="rowModeWidth";this.option_checkBoxWidth="checkBoxWidth";this.options[this.option_rowMode]=false;this.options[this.option_checkbox]=false;this.options[this.option_numWidth]=50;this.options[this.option_rowModeWidth]=20;this.options[this.option_checkBoxWidth]=25;this.option_insertRow="insertRow";this.option_updateRow="updateRow";this.option_deleteRow="deleteRow";this.option_zeroChar="zeroChar";this.option_useToolbar="useToolbar";this.option_imageRoot="imageRoot";this.options[this.option_insertRow]=false;this.options[this.option_updateRow]=false;this.options[this.option_deleteRow]=false;this.options[this.option_zeroChar]=this.gridConfig.culture.zeroChar;this.options[this.option_useToolbar]=true;this.options[this.option_imageRoot]=this.gridConfig.options.imageRoot;this.grid_mousePointRange=10;this.grid_event="";this.popupActive=0;this.fixedColumnIndex=-1;this.fixedRowCount=0;this.fixedRowIndex=-1;this.merge=false;this.mergeType=0;this.headerRowHeight=25;this.rowHeight=25;this.topRowHeight=25;this.footerRowHeight=25;this.md=new MobileDetect(window.navigator.userAgent);this.mobile=this.md.mobile();this.userAgent=this.md.userAgent();this.user_click=null;this.user_dblclick=null;this.user_editStart=null;this.user_edit=null;this.user_editEnd=null;this.user_keydown="";this.user_keyup="";this.user_blur="";this.debug_mode=true;this.grid_mode="";this.code_tree="tree";this.code_pivot="pivot";this.code_group="group";this.code_page="page";this.code_mode="_mode";this.code_rowId="_rowId";this.code_isOpen="isOpen";this.code_string="string";this.code_number="number";this.code_currency="currency";this.code_date="date";this.code_combo="combo";this.code_up="up";this.code_down="down";this.code_left="left";this.code_right="right";this.code_before="before";this.code_after="after";this.code_front="front";this.code_back="back";this.code_horizontal="horizontal";this.code_vertical="vertical";this.code_depth="_depth";this.code_children="_children";this.code_num="_number";this.code_parentNum="_parentNumber";this.code_open="open";this.code_closed="closed";this.code_itemName="itemName";this.code_parentName="parentName";this.code_rootValue="rootValue";this.tbsGridDate;this.tbsGridCombo;this.classControl=new TbsGridControl(this);this.classRange40=new TbsGridRange(this,"panel40");this.classRange50=new TbsGridRange(this,"panel50");this.classFilter=new TbsGridFilter(this);this.classGroup=new TbsGridGroup(this);this.classPage=new TbsGridPage(this);this.classSort=new TbsGridSort(this);this.classTree=new TbsGridTree(this);this.verticalScroll=new TbsGridScroll(this,"verticalScroll");this.horizontalScroll=new TbsGridScroll(this,"horizontalScroll")};TbsGridCombo=function(grid,column,input,input_code){this.colType=grid.code_combo;this.grid=grid;this.gridId=grid.gridId;this.column=column;this.input=input;this.input_code=input_code;this.tbs_create()};TbsGridCombo.prototype.tbs_create=function(){let selector="#"+this.grid.gridId;this.grid.popupActive=1;let div=document.createElement("div");div.className="tbs-grid-input-combo";div.style.display="none";let s="";s+='<div class="tbs-grid-input-combo">';s+='  <div class="tbs-grid-input-combo-content">';s+='      <table class="tbs-grid-input-combo-content-table">';s+="      <tr>";s+="          <td>";s+='              <select class="tbs-grid-input-combo-select" multiple>';s+='                  <option class="tbs-grid-input-combo-option" value="1">1ì›”</option>';s+="              </select>";s+="          <td>";s+="      </tr>";s+="      </table>";s+="  </div>";s+="</div>";document.querySelector(selector+" .tbs-grid-input-panel").innerHTML=s;let inputPanel=document.querySelector(selector+" .tbs-grid-input-panel");inputPanel.style.width="140px";inputPanel.style.height="130px";let gridRect=document.querySelector(selector).getBoundingClientRect();let inputRect=this.input.getBoundingClientRect();let top=inputRect.top;let left=inputRect.left;let right=inputRect.right;let height=inputRect.height;let documentRect=document.documentElement.getBoundingClientRect();let documentRight=documentRect.right;let documentBottom=documentRect.bottom;if(left+140>documentRight){document.querySelector(selector+" .tbs-grid-input-panel").style.left=`${right-140}px`}else{document.querySelector(selector+" .tbs-grid-input-panel").style.left=`${left}px`}if(top+height+130>documentBottom){document.querySelector(selector+" .tbs-grid-input-panel").style.top=`${top-130}px`}else{document.querySelector(selector+" .tbs-grid-input-panel").style.top=`${top+height}px`}this.tbs_setData();this.tbs_AddEvent()};TbsGridCombo.prototype.tbs_clear=function(){let selector="#"+this.grid.gridId;let grid=this.grid;if(document.querySelector(selector+" .tbs-grid-input-combo-select")){document.querySelector(selector+" .tbs-grid-input-combo-select").options.length=0}};TbsGridCombo.prototype.tbs_getDisplay=function(){return document.querySelectorAll(".tbs-grid-input-combo").length>0?document.querySelector(".tbs-grid-input-combo").style.display:"none"};TbsGridCombo.prototype.tbs_setData=function(){let selector="#"+this.grid.gridId;let grid=this.grid;this.tbs_clear();let input_combo=document.querySelector(selector+" .tbs-grid-input-combo-select");let rowIndex=this.input.dataset.rowIndex;let cellIndex=this.input.dataset.cellIndex;let column=this.grid.columns[cellIndex];let data=column.renderer;let key=column.renderer.valueName;let val=column.renderer.labelName;let value=this.input.value;let eCount=0;if(value!=""){input_combo.options.length=0;for(let i=0,len=data.length;i<len;i++){let row=data[i];let option=document.createElement("option");option.value=row[key];option.text=row[val];option.classList.add("tbs-grid-input-combo-option");input_combo.append(option);eCount=1}}if(value==""||eCount==0){input_combo.options.length=0;let option=document.createElement("option");if(name!=""){option.value="";option.text="==selected==";option.classList.add("tbs-grid-input-combo-option");input_combo.append(option)}for(let i=0,len=data.length;i<len;i++){let row=data[i];let option=document.createElement("option");option.value=row[key];option.text=row[val];option.classList.add("tbs-grid-input-combo-option");input_combo.append(option)}}};TbsGridCombo.prototype.tbs_AddEvent=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let input=this.input;let input_code=this.input_code;let gridCombo=this;const changeEvent=function(e){let combo=document.querySelector(selector+" .tbs-grid-input-combo-select");input.value=combo.selectedOptions[0].text;input_code.value=combo.selectedOptions[0].value;document.querySelector(selector+" .tbs-grid-input").focus();document.querySelector(selector+" .tbs-grid-input").select();gridCombo.tbs_destroy()};document.querySelector(selector+" .tbs-grid-input-combo-select").addEventListener("change",changeEvent)};TbsGridCombo.prototype.tbs_destroy=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let input=this.input;let input_code=this.input_code;let gridDate=this;document.querySelector(selector+" .tbs-grid-input-panel").innerHTML="";document.querySelector(selector+" .tbs-grid-input-panel").style.width="0px";document.querySelector(selector+" .tbs-grid-input-panel").style.left="30000px"};class TbsGridControl{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId}}TbsGridControl.prototype.after_addColumn=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_createColumn(grid.headerColumns);grid.tbs_createGrid(grid.columns);grid.tbs_selectRange(0,0,0,0);grid.tbs_displayPanel20()};TbsGridControl.prototype.after_removeColumn=function(headerColumns,columns){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_createColumn(grid.headerColumns);grid.tbs_createGrid(grid.columns);grid.tbs_selectRange(0,0,0,0);grid.tbs_displayPanel20()};TbsGridControl.prototype.after_changeColumnOrder=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);let topRowIndex=grid.tbs_getFirstRowIndex();grid.tbs_displayPanel20(topRowIndex);grid.tbs_displayPanel30(topRowIndex);grid.tbs_displayPanel40();grid.tbs_displayPanel50()};TbsGridControl.prototype.after_showFilterPanel=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_setPanelSize();grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel70("panel70");grid.tbs_displayPanel30(0)};TbsGridControl.prototype.after_hideFilterPanel=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_setPanelSize();grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel70("panel70");grid.tbs_displayPanel30(0)};TbsGridControl.prototype.after_showSortrPanel=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_setPanelSize();grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0)};TbsGridControl.prototype.after_hideSortPanel=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.tbs_setPanelSize();grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0)};TbsGridControl.prototype.after_setColumnVisible=function(){let selector=this.selector;let grid=this.grid;let classControl=this;grid.tbs_removeRange(0,-1);grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.apply()};TbsGrid.prototype.tbs_apply=function(){let selector="#"+this.gridId;let grid=this;let topRowIndex=grid.tbs_getFirstRowIndex();this.tbs_displayPanel20(topRowIndex);this.tbs_displayPanel30(topRowIndex);this.tbs_displayPanel40();this.tbs_displayPanel50();this.tbs_displayPanel70();this.tbs_displayPanel10()};TbsGrid.prototype.tbs_displayPanel=function(topRowIndex,isHeader=false){let selector=this.selector;let grid=this.grid;if(isHeader)grid.tbs_displayPanel20();grid.tbs_displayPanel30(topRowIndex);grid.tbs_displayPanel40();grid.tbs_displayPanel50()};TbsGrid.prototype.tbs_setDataTable=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(grid.grid_mode==grid.code_tree){if(panelName=="panel31")grid.tbs_setTreeDataTable1(param);else if(panelName=="panel32")grid.tbs_setTreeDataTable2(param);else if(panelName=="panel30")grid.tbs_setTreeDataTable3(param);else if(panelName=="panel61"){if(grid.fixedRowIndex==-1)return;grid.tbs_setTreeDataTable1(param)}else if(panelName=="panel62"){if(grid.fixedRowIndex==-1)return;grid.tbs_setTreeDataTable2(param)}else if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return;grid.tbs_setTreeDataTable3(param)}}else if(grid.grid_mode==grid.code_group){if(panelName=="panel31")grid.tbs_setDataTable1(param);else if(panelName=="panel32")grid.tbs_setDataTable2(param);else if(panelName=="panel30")grid.tbs_setGroupDataTable3(param);else if(panelName=="panel61"){if(grid.fixedRowIndex==-1)return;grid.tbs_setDataTable1(param)}else if(panelName=="panel62"){if(grid.fixedRowIndex==-1)return;grid.tbs_setDataTable2(param)}else if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return;grid.tbs_setGroupDataTable3(param)}}else{if(panelName=="panel31")grid.tbs_setDataTable1(param);else if(panelName=="panel32")grid.tbs_setDataTable2(param);else if(panelName=="panel30")grid.tbs_setDataTable3(param);else if(panelName=="panel61"){if(grid.fixedRowIndex==-1)return;grid.tbs_setDataTable1(param)}else if(panelName=="panel62"){if(grid.fixedRowIndex==-1)return;grid.tbs_setDataTable2(param)}else if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return;grid.tbs_setDataTable3(param)}}if(panelName=="panel41")grid.tbs_setDataTopTable1();else if(panelName=="panel42")grid.tbs_setDataTopTable2();else if(panelName=="panel40")grid.tbs_setDataTopTable3();else if(panelName=="panel51")grid.tbs_setDataFooterTable1();else if(panelName=="panel52")grid.tbs_setDataFooterTable2();else if(panelName=="panel50")grid.tbs_setDataFooterTable3();else if(panelName=="panel21")grid.tbs_setDataHeaderTable1(param);else if(panelName=="panel22")grid.tbs_setDataHeaderTable1(param);else if(panelName=="panel20")grid.tbs_setDataHeaderTable3(param);else if(panelName=="panel70")grid.tbs_setDataFilterTable(param)};TbsGrid.prototype.tbs_setData=function(data,openDepth=0,isFirst=true){let selector="#"+this.gridId;let grid=this;if(grid.grid_mode==grid.code_group)grid.tbs_setGroupData(data,openDepth,isFirst);else if(grid.grid_mode==grid.code_tree)grid.tbs_setTreeData(data,openDepth,isFirst);else grid.tbs_setGridData(data)};TbsGrid.prototype.tbs_setGridMode=function(gridMode){let selector="#"+this.gridId;let grid=this;grid.grid_mode=grid.tbs_trim(gridMode);if(grid.grid_mode==grid.code_paging)grid.tbs_setGridModePage();else if(grid.grid_mode==grid.module_pagination)grid.tbs_setGridModePagenation();else if(grid.grid_mode==grid.code_group){}};TbsGridDate=function(grid,column,input){this.colType="date";this.grid=grid;this.gridId=grid.gridId;this.column=column;this.input=input;this.tbs_create()};TbsGridDate.prototype.tbs_create=function(){let selector="#"+this.grid.gridId;let grid=this.grid;if(this.grid.null(this.grid))return;this.grid.popupActive=1;let s="";s+='<div class="tbs-grid-input-date">';s+='  <div class="tbs-grid-input-date-header">';s+='      <table class="tbs-grid-input-date-header-table" style="width:100%;">';s+="      <tr>";s+='      <td class="tbs-grid-input-date-prev"  onclick="'+this.grid.gridId+'.tbsGridDate.tbs_prev();" style="width:40px;">'+grid.gridConfig.calendar.prevLinkName+"</td>";s+='      <td class="tbs-grid-input-date-month" style="width:100px;">';s+='          <select class="tbs-grid-input-date-select-month" style="width:100px;" onchange="'+this.grid.gridId+'.tbsGridDate.tbs_selectMonth(this.value);">';s+='          <option value="01">'+grid.gridConfig.calendar.months[0]+"</option>";s+='          <option value="02">'+grid.gridConfig.calendar.months[1]+"</option>";s+='          <option value="03">'+grid.gridConfig.calendar.months[2]+"</option>";s+='          <option value="04">'+grid.gridConfig.calendar.months[3]+"</option>";s+='          <option value="05">'+grid.gridConfig.calendar.months[4]+"</option>";s+='          <option value="06">'+grid.gridConfig.calendar.months[5]+"</option>";s+='          <option value="07">'+grid.gridConfig.calendar.months[6]+"</option>";s+='          <option value="08">'+grid.gridConfig.calendar.months[7]+"</option>";s+='          <option value="09">'+grid.gridConfig.calendar.months[8]+"</option>";s+='          <option value="10">'+grid.gridConfig.calendar.months[9]+"</option>";s+='          <option value="11">'+grid.gridConfig.calendar.months[10]+"</option>";s+='          <option value="12">'+grid.gridConfig.calendar.months[11]+"</option>";s+="          </select></td>";s+='      <td class="tbs-grid-input-date-year"  style="width:50px;"></td>';s+='      <td class="tbs-grid-input-date-today" onclick="'+this.grid.gridId+'.tbsGridDate.tbs_today();" style="width:40px;">'+grid.gridConfig.calendar.todayLinkName+"</td>";s+='      <td class="tbs-grid-input-date-next"  onclick="'+this.grid.gridId+'.tbsGridDate.tbs_next();" style="width:40px;">'+grid.gridConfig.calendar.nextLinkName+"</td>";s+="      </tr>";s+="      </table>";s+="  </div>";s+='  <div class="tbs-grid-input-date-content">';s+='      <table class="tbs-grid-input-date-content-table" style="width:100%;">';s+="      <thead>";s+="      <tr>";s+='      <th class="tbs-grid-input-date-cell" style="color:red;">'+grid.gridConfig.calendar.dayShortNames[0]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="">'+grid.gridConfig.calendar.dayShortNames[1]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="">'+grid.gridConfig.calendar.dayShortNames[2]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="">'+grid.gridConfig.calendar.dayShortNames[3]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="">'+grid.gridConfig.calendar.dayShortNames[4]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="">'+grid.gridConfig.calendar.dayShortNames[5]+"</td>";s+='      <th class="tbs-grid-input-date-cell" style="color:blue">'+grid.gridConfig.calendar.dayShortNames[6]+"</td>";s+="      </tr>";s+="      </thead>";s+="      <tbody>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      <tr>";s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-start"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div"></div></td>';s+='      <td class="tbs-grid-input-date-cell"><div class="tbs-grid-input-date-div-end"></div></td>';s+="      </tr>";s+="      </tbody>";s+="      </table>";s+="  </div>";s+="</div>";document.querySelector(selector+" .tbs-grid-input-panel").innerHTML=s;let gridRect=document.querySelector(selector).getBoundingClientRect();let inputRect=this.input.getBoundingClientRect();let top=inputRect.top;let left=inputRect.left;let right=inputRect.right;let height=window.pageXOffset+inputRect.height;let documentRect=document.documentElement.getBoundingClientRect();let documentRight=documentRect.right;let documentBottom=documentRect.bottom;if(left+231>documentRight){document.querySelector(selector+" .tbs-grid-input-panel").style.left=`${right-231}px`}else{document.querySelector(selector+" .tbs-grid-input-panel").style.left=`${left}px`}if(top+height+187>documentBottom){document.querySelector(selector+" .tbs-grid-input-panel").style.top=`${top-187}px`}else{document.querySelector(selector+" .tbs-grid-input-panel").style.top=`${top+height}px`}this.tbs_setData();this.tbs_addEvent()};TbsGridDate.prototype.tbs_clear=function(){let cells=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-content-table td");let count=cells.length;for(let i=0;i<count;i++){let cell=cells[i];cell.childNodes[0].innerHTML=""}document.querySelector(".tbs-grid-input-date").style.display=""};TbsGridDate.prototype.tbs_getDisplay=function(){return document.querySelector(".tbs-grid-input-date")?document.querySelector(".tbs-grid-input-date").style.display:"none"};TbsGridDate.prototype.tbs_setData=function(data){this.tbs_clear();let prevCell=document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-prev");let yearCell=document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-year");let monthCell=document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-month");let todayCell=document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-today");let nextCell=document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-next");if(this.grid.null(data))data=new Date;else{data=new Date(data)}let year=data.getFullYear();let month=data.getMonth()+1;let curDay=data.getDate();let d=new Date(year,month,0);let curYear=d.getFullYear();let curMonth=d.getMonth()+1;let curLastDay=d.getDate();let curLastYoil=d.getDay();yearCell.innerHTML=curYear;document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-select-month").value=this.tbs_addZero(curMonth);d=new Date(curYear,curMonth-1,0);let prevYear=curMonth-1==0?curYear-1:curYear;let prevMonth=curMonth-1==0?12:curMonth-1;let prevLastDay=d.getDate();let prevLastYoil=d.getDay();let trList=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-content-table tr");let tr=trList[0];let count=7;for(let i=0;i<count;i++){let cell=trList[1].children[i];if(prevLastYoil==i){cell.childNodes[0].innerHTML=prevLastDay;cell.dataset.value=prevYear+"-"+this.tbs_addZero(prevMonth)+"-"+this.tbs_addZero(prevLastDay);break}}for(let i=prevLastYoil;i>=0;i--){let cell=trList[1].children[i];let day=cell.childNodes[0].innerHTML==""?prevLastDay-(prevLastYoil-i):cell.childNodes[0].innerHTML;cell.childNodes[0].innerHTML=day;cell.childNodes[0].style.color="grey";cell.dataset.value=prevYear+"-"+this.tbs_addZero(prevMonth)+"-"+this.tbs_addZero(day)}let cells=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-content-table td");count=cells.length;let k=1;let nextMonth=0;for(let i=prevLastYoil+1;i<cells.length;i++){let cell=cells[i];if(k>curLastDay){k=1;nextMonth=1}cell.childNodes[0].innerHTML=k;cell.childNodes[0].style.background="white";if(nextMonth==1){cell.childNodes[0].style.color="grey";if(curMonth==12){cell.dataset.value=curYear+1+"-"+this.tbs_addZero(1)+"-"+this.tbs_addZero(k)}else{cell.dataset.value=curYear+"-"+this.tbs_addZero(curMonth+1)+"-"+this.tbs_addZero(k)}}else{cell.childNodes[0].style.color="black";cell.dataset.value=curYear+"-"+this.tbs_addZero(curMonth)+"-"+this.tbs_addZero(k);if(cell.dataset.value==this.tbs_getToday()){cell.childNodes[0].style.background="yellow"}}k+=1}cells=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-div-start");for(let i=0;i<cells.length;i++){let cell=cells[i];if(cell.style.color=="black")cell.style.color="red"}cells=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-div-end");for(let i=0;i<cells.length;i++){let cell=cells[i];if(cell.style.color=="black")cell.style.color="blue"}};TbsGridDate.prototype.tbs_getToday=function(){let d=new Date;let curYear=d.getFullYear();let curMonth=d.getMonth()+1;let curDay=d.getDate();return curYear+"-"+this.tbs_addZero(curMonth)+"-"+this.tbs_addZero(curDay)};TbsGridDate.prototype.tbs_today=function(){let d=new Date;let curYear=d.getFullYear();let curMonth=d.getMonth()+1;let curDay=d.getDate();let selector="#"+this.grid;let grid=this.grid;let format=this.column[grid.column_format];format=format.replace("yyyy",curYear);format=format.replace("MM",this.tbs_addZero(curMonth));format=format.replace("dd",this.tbs_addZero(curDay));this.input.value=format;this.input.focus();this.input.select();this.tbs_destroy()};TbsGridDate.prototype.tbs_prev=function(){let currentYear=parseInt(document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-year").innerHTML.replace("",""));let currentMonth=parseInt(document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-select-month").value);let year,month;year=currentYear;month=currentMonth-1;if(month<1){year-=1;month=12}this.tbs_setData(year+"-"+month+"-01")};TbsGridDate.prototype.tbs_next=function(){let currentYear=parseInt(document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-year").innerHTML.replace("",""));let currentMonth=parseInt(document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-select-month").value);let year,month;year=currentYear;month=currentMonth+1;if(month>12){year+=1;month=1}this.tbs_setData(year+"-"+month+"-01")};TbsGridDate.prototype.tbs_selectMonth=function(value){let currentYear=parseInt(document.querySelector(".tbs-grid-input-date .tbs-grid-input-date-year").innerHTML.replace("",""));let currentMonth=parseInt(value);let year,month;year=currentYear;month=currentMonth;this.tbs_setData(year+"-"+month+"-01")};TbsGridDate.prototype.tbs_addEvent=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let input=this.input;let gridDate=this;let column=this.column;const mouseDownEvent=function(e){e.stopPropagation();let dateText=e.currentTarget.dataset.value;let yyyy=grid.tbs_substr(dateText,0,4);let MM=grid.tbs_substr(dateText,5,2);let dd=grid.tbs_substr(dateText,8,2);let format=column[grid.column_format];format=format.replace("yyyy",yyyy);format=format.replace("MM",MM);format=format.replace("dd",dd);gridDate.tbs_destroy();input.value=format;input.focus();input.select()};const cols=document.querySelectorAll(".tbs-grid-input-date .tbs-grid-input-date-content-table td");[].forEach.call(cols,function(cell){cell.addEventListener("mousedown",mouseDownEvent)});const changeEvent=function(e){let combo=document.querySelector(".tbs-grid-datecombo-select");document.querySelector(selector+" .tbs-grid-input").focus();document.querySelector(selector+" .tbs-grid-input").select();gridDate.tbs_destroy()}};TbsGridDate.prototype.tbs_addZero=function(value){value=parseInt(value);return value<10?"0"+value.toString():value.toString()};TbsGridDate.prototype.tbs_destroy=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let input=this.input;let gridDate=this;document.querySelector(selector+" .tbs-grid-input-panel").innerHTML="";document.querySelector(selector+" .tbs-grid-input-panel").style.width="0px";document.querySelector(selector+" .tbs-grid-input-panel").style.left="30000px"};class TbsGridFilter{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId;this.options={}}}TbsGrid.prototype.totalFilterSearch=function(s){let grid=this;let filterArray=[];let arr=this.tbs_trim(s).split(" ");for(let i=0;i<arr.length;i++){if(this.tbs_trim(arr[i])!==""){filterArray.push(arr[i].toLowerCase())}}const data=this.data_table.filter(function(item){let bool=true;let count=[];for(let i=0;i<filterArray.length;i++){count[i]=0}let columnArray=[];for(let key in item){let column=grid.tbs_getColumn(key);if(column[grid.column_visible]===false)continue;else columnArray.push(item[key])}if(filterArray.length===0){return true}else{filterArray.forEach(function(cond,i){for(let colIndex=0,len=columnArray.length;colIndex<len;colIndex++){if(columnArray[colIndex]==null)count[i]=count[i];else{count[i]=columnArray[colIndex].toString().toLowerCase().includes(cond)===true?count[i]+1:count[i]}}});for(let i=0;i<filterArray.length;i++){if(count[i]==0){bool=false;break}}return bool}});if(data.length>0){this.data_view=JSON.parse(JSON.stringify(data));if(this.merge)this.setGroup(this.classSort.sortColumns,this.summaryColumns,this.mergeType)}else{this.data_view=[]}this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_setBarPosition(grid.code_vertical,0);this.tbs_refreshRefData()};TbsGrid.prototype.tbs_showFilterPanel=function(){let selector="#"+this.gridId;let grid=this;grid.options[grid.option_filterVisible]=true;grid.classControl.after_showFilterPanel()};TbsGrid.prototype.tbs_hideFilterPanel=function(){let selector="#"+this.gridId;let grid=this;grid.options[grid.option_filterVisible]=false;grid.tbs_initFilterData();grid.classControl.after_hideFilterPanel()};TbsGrid.prototype.tbs_filters=function(){let selector="#"+this.gridId;let grid=this;let filterColumns=grid.filterColumns;let result=grid.tbs_copyJson(grid.data_table);for(let i=0,len=filterColumns.length;i<len;i++){result=grid.tbs_filter(result,filterColumns[i])}grid.data_view=result;grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_setBarPosition(grid.code_vertical,0)};TbsGrid.prototype.tbs_filter=function(data,filterColumn){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(filterColumn.name);let columnType=column[grid.column_type];let columnName=filterColumn.name;let filterType=filterColumn.type;let value=filterColumn.value;return result=data.filter(function(dataRow){let bool=true;if(columnType==grid.code_number||columnType==grid.code_currency){let columnText=dataRow[columnName];let isExist=grid.tbs_filterNumberByType(filterType,value,columnText);return isExist}else if(columnType==grid.code_string){let val=dataRow[columnName];let columnText=grid.tbs_getFormatText(column,val);let isExist=grid.tbs_filterStringByType(filterType,value,columnText);return isExist}else return true})};TbsGrid.prototype.tbs_getFilterColumns=function(){let selector="#"+this.gridId;let grid=this;let result=[];let inputs=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-cell-filter-input");for(let i=0,len=inputs.length;i<len;i++){let input=inputs[i];let columnName=input.dataset.name;let word=input.value;if(word=="")continue;let item={};item.name=columnName;item.value=word;item.type="";item.excludedValue=[];result.push(item)}return grid.filterColumns=result};TbsGrid.prototype.tbs_filterNumberByType=function(filterType,n,targetNumber){let selector="#"+this.gridId;let grid=this;if(grid.null(n))n=0;if(grid.null(targetNumber))targetNumber=0;let toNumber=null;if(filterType==grid.const_filterBetween){let arr=n.split("-");n=parseFloat(arr[0]);if(arr.length>1){toNumber=parseFloat(arr[1])}else{toNumber=99999999999999}}else{n=parseFloat(n);toNumber=null}targetNumber=parseFloat(targetNumber);if(filterType==grid.const_filterEqual){return n==targetNumber?true:false}else if(filterType==grid.const_filterNotEqual){return n!=targetNumber?true:false}else if(filterType==grid.const_filterGreater){return n<targetNumber?true:false}else if(filterType==grid.const_filterGreaterEqual){return n<=targetNumber?true:false}else if(filterType==grid.const_filterLess){return n>targetNumber?true:false}else if(filterType==grid.const_filterLessEqual){return n>=targetNumber?true:false}else if(filterType==grid.const_filterBetween){return targetNumber>=n&&targetNumber<=toNumber?true:false}else if(filterType==grid.const_filterBlank){return targetNumber==null}};TbsGrid.prototype.tbs_filterStringByType=function(filterType,s,targetString){let grid=this;let regExp;s=s.toLowerCase();targetString=targetString.toLowerCase();if(filterType==grid.const_filterEqual){regExp=new RegExp(`^${s}$`);return regExp.test(targetString)}else if(filterType==grid.const_filterNotEqual){regExp=new RegExp(`^${s}$`);return regExp.test(targetString)==false?true:false}else if(filterType==grid.const_filterInclude){regExp=new RegExp(`${s}`);return regExp.test(targetString)}else if(filterType==grid.const_filterNotInclude){regExp=new RegExp(`${s}`);return regExp.test(targetString)==false?true:false}else if(filterType==grid.const_filterStartCharacter){regExp=new RegExp(`^${s}`);return regExp.test(targetString)}else if(filterType==grid.const_filterEndCharacter){regExp=new RegExp(`${s}$`);return regExp.test(targetString)}else if(filterType==grid.const_filterBlank){regExp=new RegExp(`^$`);return regExp.test(targetString)}};TbsGrid.prototype.tbs_setFilterColumn=function(column,filterType,word){let selector="#"+this.gridId;let grid=this;let filterColumns=grid.filterColumns;let json=grid.tbs_getJsonRow(filterColumns,grid.column_name,column[grid.column_name]);if(grid.null(json)){let item={};item.name=column[grid.column_name];item.type=filterType;item.value=word;item.excludedValue=[];filterColumns.push(item)}else{let item=json;item.name=column[grid.column_name];item.type=filterType;item.value=word;item.excludedValue=[]}};TbsGrid.prototype.tbs_removeFilterColumn=function(column){let selector="#"+this.gridId;let grid=this;let columnName=column[grid.column_name];let filterColumns=grid.filterColumns;for(let i=0,len=filterColumns.length;i<len;i++){let filterColumn=filterColumns[0];if(filterColumn.name==columnName){filterColumns.splice(i,1);break}}};TbsGrid.prototype.tbs_createFilterCombo=function(column){let selector="#"+this.gridId;let grid=this;let combo=document.createElement("select");if(column[grid.column_type]==grid.code_string){let option;grid.tbs_addFilterComboOption(combo,grid.const_filterInclude,"Include");grid.tbs_addFilterComboOption(combo,grid.const_filterEqual,"Equal");grid.tbs_addFilterComboOption(combo,grid.const_filterStartCharacter,"Start Characters");grid.tbs_addFilterComboOption(combo,grid.const_filterEndCharacter,"End Characters");grid.tbs_addFilterComboOption(combo,grid.const_filterBlank,"Blank");grid.tbs_addFilterComboOption(combo,grid.const_filterNotEqual,"Does not equal");grid.tbs_addFilterComboOption(combo,grid.const_filterNotInclude,"Not Include")}else if(column[grid.column_type]==grid.code_number||column[grid.column_type]==grid.code_currency){let option;grid.tbs_addFilterComboOption(combo,grid.const_filterEqual,"Equal");grid.tbs_addFilterComboOption(combo,grid.const_filterGreaterEqual,"Greater than or Equal to");grid.tbs_addFilterComboOption(combo,grid.const_filterLessEqual,"Less than or Equal to");grid.tbs_addFilterComboOption(combo,grid.const_filterGreater,"Greater than");grid.tbs_addFilterComboOption(combo,grid.const_filterLess,"Less than");grid.tbs_addFilterComboOption(combo,grid.const_filterBetween,"Between");grid.tbs_addFilterComboOption(combo,grid.const_filterBlank,"Blank")}return combo};TbsGrid.prototype.tbs_addFilterComboOption=function(combo,value,text){let selector="#"+this.gridId;let grid=this;let option=document.createElement("option");option.value=value;option.text=text;combo.add(option)};TbsGrid.prototype.tbs_initFilterData=function(){let selector="#"+this.gridId;let grid=this;grid.filterColumns=[];let inputs=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-cell-filter-input");let combos=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-cell-filter-combo");for(let i=0;i<inputs.length;i++){inputs[i].value="";combos[i].selectedIndex=0}grid.data_view=grid.tbs_copyJson(grid.data_table);grid.tbs_removeRange(0,-1);grid.tbs_apply()};TbsGrid.prototype.tbs_getFilterColumn=function(columnName){let index=this.tbs_getFilterColumnIndex(columnName);return this.filterColumns[index]};TbsGrid.prototype.tbs_getFilterColumnIndex=function(columnName){let grid=this;let result=-1;for(let i=0,len=this.filterColumns.length;i<len;i++){let filterColumn=this.filterColumns[i];if(columnName==filterColumn[grid.column_name]){result=i;break}}return result};TbsGrid.prototype.tbs_getFilterColumnName=function(colIndex){return this.filterColumn[colIndex][this.column_name]};TbsGridFilterLayer=function(grid,icon,input,column){this.grid=grid;this.gridId=grid.gridId;this.column=column;this.iconElement=icon;this.inputElement=input;this.tbs_createFilter();this.tbs_showFilterLayer();this.tbs_AddEvent();this.tbs_setData()};TbsGridFilterLayer.prototype.tbs_getComboData=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let combo=document.createElement("select");combo.classList.add("tbs-grid-layer-filter-combo");if(column[grid.column_type]==grid.code_string){let option;gridFilter.tbs_addComboOption(combo,grid.const_filterEqual,"Equal");gridFilter.tbs_addComboOption(combo,grid.const_filterInclude,"Include");gridFilter.tbs_addComboOption(combo,grid.const_filterStartCharacter,"Start Characters");gridFilter.tbs_addComboOption(combo,grid.const_filterEndCharacter,"End Characters");gridFilter.tbs_addComboOption(combo,grid.const_filterBlank,"Blank");gridFilter.tbs_addComboOption(combo,grid.const_filterNotEqual,"Does not equal");gridFilter.tbs_addComboOption(combo,grid.const_filterNotInclude,"Not Include")}else if(column[grid.column_type]==grid.code_number){let option;gridFilter.tbs_addComboOption(combo,grid.const_filterEqual,"Equal");gridFilter.tbs_addComboOption(combo,grid.const_filterGreaterEqual,"Greater than or Equal to");gridFilter.tbs_addComboOption(combo,grid.const_filterLessEqual,"Less than or Equal to");gridFilter.tbs_addComboOption(combo,grid.const_filterGreater,"Greater than");gridFilter.tbs_addComboOption(combo,grid.const_filterLess,"Less than");gridFilter.tbs_addComboOption(combo,grid.const_filterBetween,"Between");gridFilter.tbs_addComboOption(combo,grid.const_filterBlank,"Blank")}return combo};TbsGridFilterLayer.prototype.tbs_addComboOption=function(combo,value,text){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let option=document.createElement("option");option.value=value;option.text=text;combo.add(option)};TbsGridFilterLayer.prototype.tbs_createFilter=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let combo=gridFilter.tbs_getComboData();let s="";s+='<div class="tbs-grid-layer-filter">';s+='  <div class="tbs-grid-layer-filter-main">';s+='      <div class="tbs-grid-layer-filter-content">';s+=combo.outerHTML;s+="      </div>";s+='      <div class="tbs-grid-layer-filter-content">';s+='          <input class="tbs-grid-layer-filter-content-input" placeholder="Words to filter">';s+="      </div>";s+='      <div class="tbs-grid-layer-filter-content">';s+='              <button class="tbs-grid-layer-filter-content-button-save">save</button>';s+='              <button class="tbs-grid-layer-filter-content-button-reset">reset</button>';s+="      </div>";s+="  </div>";s+="</div>";document.querySelector(selector+" .tbs-grid-layer").innerHTML=s};TbsGridFilterLayer.prototype.tbs_showFilterLayer=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let rectIcon=this.iconElement.getBoundingClientRect();let top=rectIcon.top;let left=rectIcon.left;let right=rectIcon.right;let height=rectIcon.height;let layer=document.querySelector(selector+" .tbs-grid-layer");layer.style.width="192px";layer.style.height="102px";let rectDocument=document.documentElement.getBoundingClientRect();let documentRight=rectDocument.right;let documentBottom=rectDocument.bottom;if(left+150>documentRight){layer.style.left=`${right-150}px`}else{layer.style.left=`${left}px`}if(top+height+180>documentBottom){layer.style.top=`${top-180}px`}else{layer.style.top=`${top+height}px`}};TbsGridFilterLayer.prototype.tbs_AddEvent=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let iconElement=this.iconElement;let inputElement=this.inputElement;const changeEvent=function(e){let combo=e.target;let columnType=column[grid.column_type]};const saveEvent=function(e){let combo=document.querySelector(selector+" .tbs-grid-layer-filter-combo");let filterType=combo.selectedOptions[0].value;let word=document.querySelector(selector+" .tbs-grid-layer-filter-content-input").value;grid.tbs_setFilterColumn(column,filterType,word);grid.tbs_filters();grid.apply();inputElement.value=word;document.querySelector(selector+" .tbs-grid-layer").innerHTML="";document.querySelector(selector+" .tbs-grid-layer").style.width="0px";document.querySelector(selector+" .tbs-grid-layer").style.left="30000px"};const resetEvent=function(e){document.querySelector(selector+" .tbs-grid-layer-filter-content-input").value=""};document.querySelector(selector+" .tbs-grid-layer-filter-combo").addEventListener("change",changeEvent);document.querySelector(selector+" .tbs-grid-layer-filter-content-button-save").addEventListener("mousedown",saveEvent);document.querySelector(selector+" .tbs-grid-layer-filter-content-button-reset").addEventListener("mousedown",resetEvent)};TbsGridFilterLayer.prototype.tbs_setData=function(){let selector="#"+this.grid.gridId;let grid=this.grid;let column=this.column;let gridFilter=this;let iconElement=this.iconElement;let inputElement=this.inputElement;let filterColumn=grid.tbs_getJsonRow(grid.filterColumns,grid.column_name,column[grid.column_name]);if(grid.notNull(filterColumn)){let combo=document.querySelector(selector+" .tbs-grid-layer-filter-combo");for(let i=0,len=combo.options.length;i<len;i++){if(filterColumn.type==combo.options[i].value){combo.selectedIndex=i;break}}document.querySelector(selector+" .tbs-grid-layer-filter-content-input").value=filterColumn.value}};class TbsGridGroup{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId;this.groupColumns=[];this.options={};this.infoText=grid.gridConfig.options.groupInfoText}}TbsGridGroup.prototype.tbs_setGroupOption=function(optionName,optionValue){let selector=this.selector;let grid=this.grid;let classGroup=this;classGroup.options[optionName]=optionValue};TbsGrid.prototype.tbs_createGroupData=function(dataRows){let selector="#"+this.gridId;let grid=this;let resultRows=[];const fn_getChildrenRowIds=function(row){row[grid.code_children]=[];for(let i=0,len=resultRows.length;i<len;i++){let resultRow=resultRows[i];if(row[grid.code_num]==resultRow[grid.code_parentNum]){row[grid.code_children].push(resultRow[grid.code_rowId])}}};const fn_setRelation=function(row,depth,parentNum=0){row[grid.code_num]=row[grid.code_rowId]+1;row[grid.code_parentNum]=parentNum;resultRows.push(grid.tbs_copyJson(row));if(depth==grid.classGroup.groupColumns.length+1)return;let key=grid.tbs_getGroupKeyByDepth(row,depth);for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];let childKey=grid.tbs_getGroupKeyByDepth(dataRow,depth);let childDepth=dataRow[grid.code_depth];if(key==childKey&&childDepth==depth+1)fn_setRelation(dataRow,depth+1,row[grid.code_num])}};let maxDepth=grid.classGroup.groupColumns.length+1;dataRows.map(row=>row[grid.code_depth]=maxDepth);let groupData=grid.tbs_createGroupKeyData(dataRows);groupData.map(row=>{grid.maxRowId+=1;row[grid.code_rowId]=grid.maxRowId;dataRows.push(row)});for(let i=0,len=dataRows.length;i<len;i++){let row=dataRows[i];if(row[grid.code_depth]&&row[grid.code_depth]==1)fn_setRelation(row,1)}resultRows.map(row=>fn_getChildrenRowIds(row));return resultRows};TbsGrid.prototype.tbs_createGroupKeyData=function(dataRows,depth=1){let selector="#"+this.gridId;let grid=this;let resultRows=[];let tempRows=[];const fn_getKey=function(row,depth){let key="";for(let i=0;i<depth;i++){let groupColumn=grid.classGroup.groupColumns[i];let name=groupColumn[grid.column_name];key+="-"+row[name]}return key};const fn_getKeyData=function(row,depth){let tempRow={};for(let i=0;i<depth;i++){let groupColumn=grid.classGroup.groupColumns[i];let name=groupColumn[grid.column_name];tempRow[name]=row[name];tempRow[grid.code_depth]=depth}return tempRow};for(let i=depth,len=grid.classGroup.groupColumns.length+1;i<len;i++){let rows=dataRows.reduce((acc,row)=>{let key=grid.tbs_getGroupKeyByDepth(row,i);let tempRow=grid.tbs_getGroupKeyRowByDepth(row,i);if(acc.hasOwnProperty(key)==false)acc[key]=tempRow;return acc},{});rows=Object.values(rows);rows.map(row=>resultRows.push(row))}return resultRows};TbsGrid.prototype.tbs_getGroupKeyByDepth=function(row,depth){let selector="#"+this.gridId;let grid=this;let key="";for(let i=0;i<depth;i++){let groupColumn=grid.classGroup.groupColumns[i];let name=groupColumn[grid.column_name];key+="-"+row[name]}return key};TbsGrid.prototype.tbs_getGroupKeyRowByDepth=function(row,depth){let selector="#"+this.gridId;let grid=this;let tempRow={};for(let i=0;i<depth;i++){let groupColumn=grid.classGroup.groupColumns[i];let name=groupColumn[grid.column_name];tempRow[name]=row[name];tempRow[grid.code_depth]=depth}return tempRow};TbsGrid.prototype.tbs_setgroupColumns=function(groupColumns){let selector="#"+this.gridId;let grid=this;grid.classGroup.groupColumns=groupColumns};TbsGrid.prototype.tbs_setGroupData=function(data,openDepth=0,isFirst=true){let selector="#"+this.gridId;let grid=this;if(grid.tbs_isColumnName("group_column")==false){let userColumn={name:"group_column",header:{text:"Group"},width:150,type:"string"};grid.tbs_addColumn(userColumn,0,0,grid.code_before)}if(grid.null(data)||data.length==0)return;grid.data_user=[];for(let i=0,len=data.length;i<len;i++){let row=data[i];if(grid.notNull([grid.code_mode]))delete row[grid.code_mode];if(grid.notNull([grid.code_num]))delete row[grid.code_num];if(grid.notNull([grid.code_parentNum]))delete row[grid.code_parentNum];if(grid.notNull([grid.code_children]))row[grid.code_children]=[];grid.data_user.push(row)}let columns=grid.columns;let dataRows=grid.tbs_copyJson(grid.data_user);dataRows.map((dataRow,rowIndex)=>{if(grid.null(dataRow[grid.code_rowId])){grid.maxRowId+=1;dataRow[grid.code_rowId]=grid.maxRowId}});if(isFirst==true){grid.data_table=[];grid.data_view=[];for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];let item={};item[grid.code_rowId]=dataRow[grid.code_rowId];item[grid.code_mode]="";for(let x=0,len=grid.columns.length;x<len;x++){let column=grid.columns[x];let columnName=column[grid.column_name];let val=grid.null(dataRow[columnName])?null:dataRow[columnName];item[columnName]=val}grid.data_table.push(item);grid.data_view.push(grid.tbs_copyJson(item))}}else{grid.data_view=grid.tbs_copyJson(grid.data_table)}grid.tbs_filters();grid.tbs_sortJsonData(grid.data_view,grid.classSort.sortColumns);dataRows=grid.tbs_createGroupData(grid.tbs_copyJson(grid.data_view));grid.data_view=[];for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];let item={};item[grid.code_rowId]=dataRow[grid.code_rowId];item[grid.code_mode]="";item[grid.code_depth]=dataRow[grid.code_depth];item[grid.code_num]=dataRow[grid.code_num];item[grid.code_parentNum]=dataRow[grid.code_parentNum];item[grid.code_children]=grid.tbs_copyJson(dataRow[grid.code_children]);item[grid.code_isOpen]=false;for(let x=0,len=columns.length;x<len;x++){let column=columns[x];let columnName=column[grid.column_name];let val=grid.null(dataRow[columnName])?null:dataRow[columnName];item[columnName]=val}grid.data_view.push(item)}grid.data_temp=grid.tbs_copyJson(grid.data_view);grid.data_temp.map(item=>item[grid.code_isOpen]=false);if(grid.notNull(openDepth)&&grid.classGroup.groupColumns.length>0){for(let i=grid.data_view.length-1;i>=0;i--){let row=grid.data_view[i];let depth=row[grid.code_depth];if(depth>openDepth){grid.data_view.splice(i,1)}}}document.querySelector(selector+" .tbs-grid-panel10-filter-input").value="";dataRows=grid.data_view;if(dataRows.length==0){document.querySelector(selector+" .tbs-grid-panel21 td div").textContent="0";grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0)}else{document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=dataRows.length;grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0);grid.tbs_displayPanel40();grid.tbs_displayPanel50()}if(grid.options[grid.option_autoWidth]==true)grid.tbs_setColumnAutoWidth();grid.tbs_getGroupButtonList();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,0,0,0)};TbsGrid.prototype.tbs_setGroupIcon=function(tableCell,rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let arr=row[grid.code_children];let element=tableCell.querySelector(".tbs-grid-cell-div-icon");if(grid.null(arr))return;if(arr.length>0){let nextRow=grid.tbs_getRow(rowIndex+1);if(grid.null(nextRow))grid.tbs_toggleGroupIcon(rowIndex,element,"closed");else{if(nextRow[grid.code_parentNum]==row[grid.code_num])grid.tbs_toggleGroupIcon(rowIndex,element,"open");else grid.tbs_toggleGroupIcon(rowIndex,element,"closed")}}else grid.tbs_toggleGroupIcon(rowIndex,element)};TbsGrid.prototype.tbs_toggleGroupIcon=function(rowIndex,element,type){let selector="#"+this.gridId;let grid=this;if(type==grid.code_open)element.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_open.png)";else if(type==grid.code_closed)element.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_closed.png)";else element.style["backgroundImage"]=""};TbsGrid.prototype.tbs_isGroupChildrenRow=function(rowIndex){let selector="#"+this.gridId;let grid=this;let result=false;let row=grid.tbs_getRow(rowIndex);let childRow=grid.tbs_getRow(rowIndex+1);if(grid.null(childRow))result=false;else{if(row[grid.code_num]==childRow[grid.code_parentNum])result=true}return result};TbsGrid.prototype.tbs_getGroupChildrenRows=function(folding,rowIndex,isAll=true){let selector="#"+this.gridId;let grid=this;let dataRows=grid.data_view;let resultRows=[];const fn_getChildrenRows=function(row,count){if(Object.keys(row).length==0)return;if(count>1)resultRows.push(grid.tbs_copyJson(row));let arr=row[grid.code_children];if(arr.length>0){if(count==1){for(let i=0,len=arr.length;i<len;i++){let dataRow=grid.tbs_getTempRowByRowId(arr[i]);fn_getChildrenRows(dataRow,count+1)}}else{if(folding==grid.code_open){if(row[grid.code_isOpen]){for(let i=0,len=arr.length;i<len;i++){let dataRow=grid.tbs_getTempRowByRowId(arr[i]);fn_getChildrenRows(dataRow,count+1)}}}else{for(let i=0,len=arr.length;i<len;i++){let dataRow=grid.tbs_getTempRowByRowId(arr[i]);fn_getChildrenRows(dataRow,count+1)}}}}};let row=grid.tbs_getRow(rowIndex);fn_getChildrenRows(row,1);return resultRows};TbsGrid.prototype.tbs_setGroupFolding=function(tableCell){let selector="#"+this.gridId;let grid=this;let rowIndex=parseInt(tableCell.parentNode.dataset.rowIndex);let row=grid.tbs_getRow(rowIndex);let spanIcon=tableCell.querySelector(".tbs-grid-cell-div-icon");if(grid.null(spanIcon))return;let folding=grid.tbs_getGroupFlodingStatus(tableCell);if(folding==grid.code_open)grid.tbs_closeGroupRow(rowIndex);else if(folding==grid.code_closed)grid.tbs_openGroupRow(rowIndex,false);grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())};TbsGrid.prototype.tbs_getGroupFlodingStatus=function(tableCell){let selector="#"+this.gridId;let grid=this;let spanIcon=tableCell.querySelector(".tbs-grid-cell-div-icon");if(grid.null(spanIcon))return null;if(spanIcon.style["backgroundImage"].includes("tree_open.png"))return grid.code_open;else if(spanIcon.style["backgroundImage"].includes("tree_closed.png"))return grid.code_closed;else return null};TbsGrid.prototype.tbs_openGroupRow=function(rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let rowId=row[grid.code_rowId];for(let i=0,len=grid.data_temp.length;i<len;i++){if(rowId==grid.data_temp[i][grid.code_rowId])grid.data_temp[i][grid.code_isOpen]=true}let rows=grid.tbs_getGroupChildrenRows(grid.code_open,rowIndex,false);grid.tbs_addGroupRows(rowIndex)};TbsGrid.prototype.tbs_closeGroupRow=function(rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let rowId=row[grid.code_rowId];for(let i=0,len=grid.data_view.length;i<len;i++){if(rowId==grid.data_view[i][grid.code_rowId])grid.data_view[i][grid.code_isOpen]=false}let rows=grid.tbs_getGroupChildrenRows(grid.code_closed,rowIndex,true);rows.map(row=>grid.tbs_removeGroupRow(row))};TbsGrid.prototype.tbs_addGroupRows=function(rowIndex){let selector="#"+this.gridId;let grid=this;let rows=grid.tbs_getGroupChildrenRows(grid.code_open,rowIndex,false);for(let i=0,startRowIndex=rowIndex+1,len=rows.length;i<len;i++,startRowIndex++){grid.tbs_addGroupRow(startRowIndex,rows[i])}};TbsGrid.prototype.tbs_addGroupRow=function(startRowIndex,row){let selector="#"+this.gridId;let grid=this;startRowIndex=parseInt(startRowIndex);if(startRowIndex==grid.data_view.length){grid.data_view.push(row)}else{grid.data_view.splice(startRowIndex,0,row)}};TbsGrid.prototype.tbs_removeGroupRow=function(row){let selector="#"+this.gridId;let grid=this;grid.tbs_removeRowInPanel30(row);grid.data_select_panel30=[];grid.data_select_panel31=[]};TbsGrid.prototype.tbs_setGroupDataTable3=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return}grid.tbs_setTableHead(panelName);let topRowIndex=grid.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=grid.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=grid.tbs_getPageRowCount(panelName);let rowHeight=grid.rowHeight;let columns=grid.columns;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){if(i>grid.tbs_getRowCount()-1)break;let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;if(tableRow.style.height!=grid.rowHeight+"px")tableRow.style.height=rowHeight+"px";grid.tbs_setAlternativeRowColor(panelName,tableRow,i);let selectedValue=grid.tbs_isSelectedCell("panel31",i,0);if(tableRow.style.display=="none")tableRow.style.display="";for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(grid.fixedColumnIndex!=-1){if(x>grid.fixedColumnIndex&&x<startColumnIndex)continue}else{if(x<startColumnIndex)continue}let column=grid.columns[x];let columnName=column[grid.column_name];tableCell.dataset.name=columnName;let colValue=grid.tbs_getText(i,columnName);let divCell=tableCell.childNodes[0];let row=grid.tbs_getRow(i);let rowDepth=row[grid.code_depth];if(columnName=="group_column"){let icon=grid.tbs_createElementCellIcon();grid.tbs_prependIcon(tableCell,icon);grid.tbs_setGroupIcon(tableCell,i);grid.tbs_setCellStyle(divCell,"paddingLeft",rowDepth*15+"px");grid.tbs_setCellStyle(tableCell,"textAlign",column[grid.column_align]);grid.tbs_setCellStyle(tableCell,"width",column[grid.column_width]+"px");grid.tbs_setCellStyle(tableCell,"backgroundImage","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setSelectedCell(panelName,tableCell,i,x);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");if(rowDepth<=grid.classGroup.groupColumns.length){colValue=grid.getText(i,grid.classGroup.groupColumns[rowDepth-1][grid.column_name])+"("+row[grid.code_children].length+")"}grid.tbs_setCell(spanText,"textContent",colValue)}else{let icons=tableCell.querySelectorAll(".tbs-grid-cell-div-icon");if(icons.length>0)icons[0].remove();grid.tbs_setCellStyle(tableCell,"textAlign",column[grid.column_align]);grid.tbs_setCellStyle(tableCell,"width",column[grid.column_width]+"px");grid.tbs_setCellStyle(tableCell,"backgroundImage","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setSelectedCell(panelName,tableCell,i,x);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");if(rowDepth<=grid.classGroup.groupColumns.length)colValue=null;grid.tbs_setCell(spanText,"textContent",colValue)}}for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(grid.fixedColumnIndex!=-1&&x<=grid.fixedColumnIndex)grid.tbs_setCellStyle(tableCell,"display","none")}tableRowIndex+=1}grid.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,grid.pageRowCount);if(param.panelName=="panel30")document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=grid.tbs_getRowCount()};TbsGrid.prototype.tbs_addGroupButton=function(name,text,order,targetIndex){let selector="#"+this.gridId;let grid=this;let groupColumns=grid.classGroup.groupColumns;for(let i=0,len=groupColumns.length;i<len;i++){let groupColumn=groupColumns[i];if(name==groupColumn[grid.column_name]){return}}let column={};column[grid.column_name]=name;column[grid.column_text]=text;column[grid.column_order]=order;if(grid.notNull(targetIndex))grid.classGroup.groupColumns.splice(targetIndex,0,column);else grid.classGroup.groupColumns.push(column);let button=grid.tbs_createGroupButton(name);let bar=document.querySelector(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar");if(grid.notNull(targetIndex))bar.insertBefore(button,bar.childNodes[targetIndex]);else bar.append(button);grid.tbs_toggleGroupPlaceHolder();let data=grid.data_user;grid.tbs_setGroupData(data,null,false)};TbsGrid.prototype.tbs_removeGroupButton=function(element){let selector="#"+this.gridId;let grid=this;let name=element.dataset.name;let columnIndex;let groupColumns=grid.classGroup.groupColumns;for(let i=0,len=groupColumns.length;i<len;i++){let groupColumn=groupColumns[i];if(name==groupColumn[grid.column_name]){columnIndex=i;break}}groupColumns.splice(columnIndex,1);let button=element.parentNode;button.remove();grid.tbs_toggleGroupPlaceHolder();let data=grid.data_user;grid.tbs_setGroupData(data,null,false)};TbsGrid.prototype.tbs_removeGroupButtonList=function(){let selector="#"+this.gridId;let grid=this;let buttons=document.querySelectorAll(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar .tbs-grid-panel-button");for(let i=buttons.length-1;i>=0;i--)buttons[i].remove()};TbsGrid.prototype.tbs_getGroupButtonList=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_removeGroupButtonList();let bar=document.querySelector(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar");let groupColumns=grid.classGroup.groupColumns;for(let i=0,len=groupColumns.length;i<len;i++){let groupColumn=groupColumns[i];let button=grid.tbs_createGroupButton(groupColumn[grid.column_name]);let bar=document.querySelector(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar");if(grid.null(bar))return;bar.append(button)}grid.tbs_toggleGroupPlaceHolder()};TbsGrid.prototype.tbs_createGroupButton=function(columnName){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(columnName);let text=document.createElement("span");text.classList.add("tbs-grid-panel-button-text");text.textContent=column.header[grid.column_text];text.dataset.name=columnName;let icon=document.createElement("span");icon.classList.add("tbs-grid-panel-button-icon");icon.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_closed.png)";icon.dataset.name=columnName;let button=document.createElement("div");button.classList.add("tbs-grid-panel-button");button.dataset.name=columnName;button.append(text);button.append(icon);return button};TbsGrid.prototype.tbs_toggleGroupPlaceHolder=function(){let selector="#"+this.gridId;let grid=this;let buttons=document.querySelectorAll(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar .tbs-grid-panel-button");let span=document.querySelector(selector+" .tbs-grid-panel80 .tbs-grid-panel-bar-span");if(buttons.length>0)span.style.display="none";else span.style.display="";if(buttons.length==0){grid.tbs_setColumn("group_column","visible",false)}else{grid.tbs_setColumn("group_column","visible",true)}grid.classControl.after_setColumnVisible()};TbsGrid.prototype.tbs_allowGroupMode=function(){let selector="#"+this.gridId;let grid=this;grid1.tbs_setGridMode(grid1.code_group);grid1.tbs_setOption(grid.option_groupVisible,true);grid1.tbs_removeRange(0,-1);grid1.tbs_setPanelSize();grid1.verticalScroll.tbs_setScroll(grid.code_vertical);if(grid.data_view.length>=0&&grid.null(grid.data_view[0]["group_column"]))grid1.tbs_setData(grid.data_view);else grid1.apply()};TbsGrid.prototype.tbs_denyGroupMode=function(){let selector="#"+this.gridId;let grid=this;for(let i=grid.data_view.length-1;i>=0;i--){let row=grid.data_view[i];if(grid.notNull(row[grid.code_children])&&row[grid.code_children].length!=0)grid.data_view.splice(i,1)}grid1.tbs_setgroupColumns([]);grid1.tbs_getGroupButtonList();grid1.tbs_setOption(grid.option_groupVisible,false);grid1.tbs_removeRange(0,-1);grid1.tbs_setPanelSize();grid1.verticalScroll.tbs_setScroll(grid.code_vertical);grid1.tbs_apply()};TbsGrid.prototype.tbs_showGroupPanel=function(){let selector="#"+this.gridId;let grid=this;let panel=document.querySelector(selector+" .tbs-grid-panel80");panel.classList.remove("tbs-hide");panel.classList.add("tbs-show")};TbsGrid.prototype.tbs_hideGroupPanel=function(){let selector="#"+this.gridId;let grid=this;let panel=document.querySelector(selector+" .tbs-grid-panel80");panel.classList.remove("tbs-show");panel.classList.add("tbs-hide")};TbsGrid.prototype.tbs_initGroupData=function(){let selector="#"+this.gridId;let grid=this;grid1.tbs_setgroupColumns([]);grid1.tbs_removeRange(0,-1);grid1.tbs_setPanelSize();grid1.verticalScroll.tbs_setScroll(grid.code_vertical);if(grid.data_view.length>=0&&grid.null(grid.data_view[0]["group_column"]))grid1.tbs_setData(grid.data_view,null,false)};class TbsGridPage{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId;this.pageIndex=0;this.pageCount=0;this.pageRowCount=0;this.pageTotalRowCount=0;this.options={};this.options.pageRowCount=10;this.options.pageRowCountList=[10,20,30,50,100];this.user_clickPageFirst=null;this.user_clickPagePrev=null;this.user_clickPageIndex=null;this.user_clickPageNext=null;this.user_clickPageLast=null}}TbsGridPage.prototype.tbs_setPageOption=function(optionName,optionValue){let selector=this.selector;let grid=this.grid;let classPage=this;classPage.options[optionName]=optionValue};TbsGrid.prototype.tbs_setPageData=function(){let selector="#"+this.gridId;let grid=this;if(grid.grid_mode!=grid.module_paging)return;if(grid.data_view.length==0)return;if(grid.classPage.pageRowCount==0)grid.classPage.pageRowCount=grid.classPage.options.pageRowCount;grid.classPage.pageTotalRowCount=grid.data_page.length;grid.classPage.pageCount=Math.ceil(grid.data_page.length/grid.classPage.pageRowCount);if(grid.classPage.pageIndex==0)grid.classPage.pageIndex=1;if(grid.classPage.pageIndex<1)grid.classPage.pageIndex=1;else if(grid.classPage.pageIndex>grid.classPage.pageCount)grid.classPage.pageIndex=grid.classPage.pageCount;grid.classPage.startRowIndex=(grid.classPage.pageIndex-1)*grid.classPage.pageRowCount;grid.classPage.lastRowIndex=grid.classPage.startRowIndex+grid.classPage.pageRowCount-1;if(grid.classPage.lastRowIndex>grid.data_page.length-1)grid.classPage.lastRowIndex=grid.data_page.length-1;grid.data_view=[];for(let i=grid.classPage.startRowIndex;i<=grid.classPage.lastRowIndex;i++){let row=grid.data_page[i];grid.data_view.push(grid.tbs_copyJson(row))}document.querySelector(selector+" .tbs-grid-panel10-page-select").textContent=grid.classPage.pageIndex};class TbsGridRange{constructor(grid,panelName){this.grid=grid;this.selector="#"+grid.gridId;this.panelName=panelName;this.startRowIndex=-1;this.startCellIndex=-1;this.lastRowIndex=-1;this.lastCellIndex=-1;this._startRowIndex=-1;this._startCellIndex=-1;this._lastRowIndex=-1;this._lastCellIndex=-1;this.selectRangeArray=[];this.data_select_panel31=[];this.data_select_panel30=[];this.data_summary=[];if(this.panelName=="panel40"){this.data_summary=grid.data_top}else if(this.panelName=="panel50"){this.data_summary=grid.data_footer}}}TbsGridRange.prototype.class_selectRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;if(arguments.length==2){startCellIndex=0;lastCellIndex=-1}if(lastRowIndex==-1){lastRowIndex=grid.data_summary.length-1}if(lastCellIndex==-1){lastCellIndex=grid.columns.length-1}if(panelName=="panel40")grid.classRange50.class_removeRange(0,-1,0,-1);else if(panelName=="panel50")grid.classRange40.class_removeRange(0,-1,0,-1);classRange.class_setRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,"")};TbsGridRange.prototype.class_setRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,type="add"){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;classRange.startRowIndex=startRowIndex;classRange.startCellIndex=startCellIndex;classRange.lastRowIndex=lastRowIndex;classRange.lastCellIndex=lastCellIndex;let _startRowIndex=startRowIndex>lastRowIndex?lastRowIndex:startRowIndex;let _lastRowIndex=startRowIndex>lastRowIndex?startRowIndex:lastRowIndex;let _startCellIndex=startCellIndex>lastCellIndex?lastCellIndex:startCellIndex;let _lastCellIndex=startCellIndex>lastCellIndex?startCellIndex:lastCellIndex;classRange._startRowIndex=_startRowIndex;classRange._startCellIndex=_startCellIndex;classRange._lastRowIndex=_lastRowIndex;classRange._lastCellIndex=_lastCellIndex;if(type=="add"||classRange.selectRangeArray==0){let selectRange={};classRange.startRowIndex=startRowIndex;classRange.startCellIndex=startCellIndex;classRange.lastRowIndex=lastRowIndex;classRange.lastCellIndex=lastCellIndex;classRange._startRowIndex=_startRowIndex;classRange._startCellIndex=_startCellIndex;classRange._lastRowIndex=_lastRowIndex;classRange._lastCellIndex=_lastCellIndex;classRange.selectRangeArray.push(selectRange)}else{let selectRange=classRange.selectRangeArray[0];classRange.startRowIndex=startRowIndex;classRange.startCellIndex=startCellIndex;classRange.lastRowIndex=lastRowIndex;classRange.lastCellIndex=lastCellIndex;classRange._startRowIndex=_startRowIndex;classRange._startCellIndex=_startCellIndex;classRange._lastRowIndex=_lastRowIndex;classRange._lastCellIndex=_lastCellIndex}classRange.class_setRangeValue(_startRowIndex,_lastRowIndex,_startCellIndex,_lastCellIndex);if(grid.fixedRowIndex==-1){topRowIndex=topRowIndex==undefined?grid.tbs_getFirstRowIndex():classRange.fixedRowIndex+1}else{topRowIndex=topRowIndex==undefined?grid.tbs_getFirstRowIndex():topRowIndex}grid.tbs_displayPanel30(topRowIndex);grid.tbs_displayPanel40();grid.tbs_displayPanel50()};TbsGridRange.prototype.class_setRangeValue=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;if(grid.options[grid.option_selectMode]=="cell"){startRowIndex=startRowIndex;lastRowIndex=startRowIndex}let data=classRange.data_select_panel31;if(lastRowIndex==-1)lastRowIndex=data.length-1;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){let len=data.length;let bCount=false;for(let n=0;n<len;n++){if(rowIndex==data[n][0][0]){bCount=true;data[n][1][0]=1;break}}if(bCount==false){data.push([new Int32Array([rowIndex]),new Int8Array([1,0,0])])}}let column=grid.columns;let columnLen=column.length;data=classRange.data_select_panel30;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){if(lastCellIndex==-1)lastCellIndex=column.length-1;let len=data.length;let bCount=false;for(let n=0;n<len;n++){if(rowIndex==data[n][0][0]){bCount=true;for(let colIndex=0;colIndex<columnLen;colIndex++){if(colIndex>=startCellIndex&&colIndex<=lastCellIndex){data[n][1][colIndex]=1}else{data[n][1][colIndex]=0}}break}}if(bCount==false){let array=[];for(let colIndex=0;colIndex<columnLen;colIndex++)array.push(0);let row=[new Int32Array([rowIndex]),new Int8Array(array)];for(let colIndex=0;colIndex<columnLen;colIndex++){if(colIndex>=startCellIndex&&colIndex<=lastCellIndex)row[1][colIndex]=1;else row[1][colIndex]=0}data.push(row)}}};TbsGridRange.prototype.class_removeRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;if(classRange.startRowIndex!=-1)classRange.startRowIndex=-1;if(classRange.startCellIndex!=-1)classRange.startCellIndex=-1;if(classRange.lastRowIndex!=-1)classRange.lastRowIndex=-1;if(classRange.lastCellIndex!=-1)classRange.lastCellIndex=-1;if(classRange._startRowIndex!=-1)classRange._startRowIndex=-1;if(classRange._startCellIndex!=-1)classRange._startCellIndex=-1;if(classRange._lastRowIndex!=-1)classRange._lastRowIndex=-1;if(classRange._lastCellIndex!=-1)classRange._lastCellIndex=-1;classRange.data_select_panel30=[];classRange.data_select_panel31=[];classRange.selectRangeArray=[];document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table td").forEach(function(td){td.classList.remove("tbs-grid-cell-select")});if(this.fixedColumnIndex!=-1){document.querySelectorAll(selector+" .tbs-grid-panel22 .tbs-grid-table td").forEach(function(td){td.classList.remove("tbs-grid-cell-select")})}};TbsGridRange.prototype.class_addRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;if(arguments.length==2){startCellIndex=0;lastCellIndex=-1}if(lastRowIndex==-1){lastRowIndex=classRange.data_summary.length-1}if(lastCellIndex==-1){lastCellIndex=grid.columns.length-1}classRange.class_setRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,"add")};TbsGridRange.prototype.class_getMaxCellIndexByMouseMove=function(){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;let panelName2;let panelName0;if(panelName=="panel40"){panelName2="panel42";panelName0="panel40"}else{panelName2="panel52";panelName0="panel50"}let maxCellIndex,num;const rowIndexArray=[];if(grid.fixedColumnIndex!=-1){num=classRange.class_getMaxCellIndexByMouseMove2(panelName2);if(num!=undefined)rowIndexArray.push(num);num=classRange.class_getMaxCellIndexByMouseMove2(panelName0);if(num!=undefined)rowIndexArray.push(num);maxCellIndex=Math.max(...rowIndexArray)}else{maxCellIndex=classRange.class_getMaxCellIndexByMouseMove2(panelName0)}return maxCellIndex};TbsGridRange.prototype.class_getMinCellIndexByMouseMove=function(){let selector=this.selector;let grid=this.grid;let classRange=this;let panelName=this.panelName;let panelName2;let panelName0;if(panelName=="panel40"){panelName2="panel42";panelName0="panel40"}else{panelName2="panel52";panelName0="panel50"}let minCellIndex;const rowIndexArray=[];if(grid.fixedRowIndex!=-1&&grid.fixedColumnIndex!=-1){num=classRange.class_getMinCellIndexByMouseMove2(panelName2);if(num!=undefined)rowIndexArray.push(num);num=classRange.class_getMinCellIndexByMouseMove2(panelName0);if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else if(grid.fixedRowIndex!=-1){num=classRange.class_getMinCellIndexByMouseMove2(panelName0);if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else if(grid.fixedColumnIndex!=-1){num=classRange.class_getMinCellIndexByMouseMove2(panelName2);if(num!=undefined)rowIndexArray.push(num);num=classRange.class_getMinCellIndexByMouseMove2(panelName0);if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else{minCellIndex=classRange.class_getMinCellIndexByMouseMove2(panelName0)}return minCellIndex};TbsGridRange.prototype.class_getMaxCellIndexByMouseMove2=function(panelName){let selector=this.selector;let grid=this.grid;let classRange=this;let lastX=grid.lastX;let maxCellIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRow=tableRows[0];let len=tableRow&&tableRow.childNodes?tableRow.childNodes.length:0;let startColumnIndex,lastColumnIndex;if(grid.fixedColumnIndex!=-1){if(panelName=="panel42"||panelName=="panel52"){startColumnIndex=0;lastColumnIndex=grid.fixedColumnIndex+1}else if(panelName=="panel40"||panelName=="panel50"){startColumnIndex=grid.fixedColumnIndex+1;lastColumnIndex=len}}else{startColumnIndex=0;lastColumnIndex=len}for(let x=startColumnIndex;x<lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];let column=grid.columns[x];if(column[grid.column_visible]==false)continue;let rect=grid.tbs_getOffset(tableCell);let rectLeft=rect.left;if(lastX>rectLeft)maxCellIndex=tableCell.cellIndex}return maxCellIndex};TbsGridRange.prototype.class_getMinCellIndexByMouseMove2=function(panelName){let selector=this.selector;let grid=this.grid;let classRange=this;let lastX=grid.lastX;let minCellIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRow=tableRows[0];let len=tableRow&&tableRow.childNodes?tableRow.childNodes.length:0;let startColumnIndex,lastColumnIndex;if(grid.fixedColumnIndex!=-1){if(panelName=="panel42"||panelName=="panel52"){startColumnIndex=0;lastColumnIndex=grid.fixedColumnIndex}else if(panelName=="panel40"||panelName=="panel50"){startColumnIndex=grid.fixedColumnIndex+1;lastColumnIndex=len-1}}else{startColumnIndex=0;lastColumnIndex=len-1}for(let x=lastColumnIndex;x>=startColumnIndex;x--){let tableCell=tableRow.childNodes[x];let column=grid.columns[x];if(column[grid.column_visible]==false)continue;let rect=grid.tbs_getOffset(tableCell);let rectRight=rect.left+tableCell.getBoundingClientRect().width;if(lastX<rectRight)minCellIndex=tableCell.cellIndex}return minCellIndex};class TbsGridScroll{constructor(grid,scrollName){this.grid=grid;this.selector="#"+grid.gridId;this.scrollName=scrollName;this.barSize=0;this.railSize=0;this.moveCount=0;this.margin="14px";this.hiddenSize=0;this.panelName;this.type}}TbsGridScroll.prototype.tbs_setScroll=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal)scroll.tbs_setHorizontalScroll();else if(type==grid.code_vertical)scroll.tbs_setVerticalScroll()};TbsGridScroll.prototype.tbs_setHorizontalScroll=function(){let selector=this.selector;let grid=this.grid;let classScroll=this;let type=grid.code_horizontal;let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");let scrollBox=document.querySelector(selector+" .tbs-grid-scroll-box");let panel20=document.querySelector(selector+" .tbs-grid-panel20");let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let rectPanel20=panel20.getBoundingClientRect();let rectTable20=table20.getBoundingClientRect();if(rectTable20.width>rectPanel20.width)classScroll.tbs_showScroll(type);else classScroll.tbs_hideScroll(type);xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");if(xScroll.style.display=="none"&&yScroll.style.display=="none")scrollBox.style.display="none";grid.tbs_setPageRowCount();let pageRowCount=grid.pageRowCount;let pageIntRowCount=grid.pageIntRowCount;let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let leftTrList=document.querySelectorAll(selector+' .tbs-grid-panel31 tbody tr:not([style*="display: none"])');let contentTrList=document.querySelectorAll(selector+' .tbs-grid-panel30 tbody tr:not([style*="display: none"])');let len=leftTrList.length;if(len==0)return;let leftTable=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table");let contentTable=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let leftCount=leftTrList.length;let contentCount=contentTrList.length;for(let i=0;i<pageRowCount;i++){let leftTr=leftTrList[0].cloneNode(true);let contentTr=contentTrList[0].cloneNode(true);leftTable.childNodes[1].append(leftTr);contentTable.childNodes[1].append(contentTr)}for(let i=0;i<leftCount;i++)leftTable.deleteRow(-1);for(let i=0;i<contentCount;i++)contentTable.deleteRow(-1)};TbsGridScroll.prototype.tbs_setVerticalScroll=function(){let selector=this.selector;let grid=this.grid;let scroll=this;let type=grid.code_vertical;let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");let scrollBox=document.querySelector(selector+" .tbs-grid-scroll-box");let wrap=document.querySelector(selector+" .tbs-grid-wrap");let pageRowCount=grid.pageRowCount;let dataLength=grid.data_view.length;if(grid.fixedRowIndex!=-1){dataLength=dataLength-(grid.fixedRowIndex+1);if(dataLength<=grid.pageIntRowCount){scroll.tbs_hideScroll(type)}else if(grid.pageRowCount>grid.pageIntRowCount){if(dataLength>=pageRowCount){yScroll.style.display="";scrollBox.style.display="";wrap.style.marginRight=grid.verticalScroll.margin;scroll.tbs_setScrollSize(type)}else{scroll.tbs_hideScroll(type)}}else{if(dataLength>pageRowCount){yScroll.style.display="";scrollBox.style.display="";wrap.style.marginRight=grid.verticalScroll.margin;scroll.tbs_setScrollSize(type)}else{scroll.tbs_hideScroll(type)}}}else{if(dataLength<=grid.pageIntRowCount){scroll.tbs_hideScroll(type)}else if(grid.pageRowCount>grid.pageIntRowCount){if(dataLength>=pageRowCount){yScroll.style.display="";scrollBox.style.display="";wrap.style.marginRight=grid.verticalScroll.margin;scroll.tbs_setScrollSize(type)}else{scroll.tbs_hideScroll(type)}}else{if(dataLength>pageRowCount){yScroll.style.display="";scrollBox.style.display="";wrap.style.marginRight=grid.verticalScroll.margin;scroll.tbs_setScrollSize(type)}else{scroll.tbs_hideScroll(type)}}}yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");if(xScroll.style.display=="none"&&yScroll.style.display=="none")scrollBox.style.display="none"};TbsGridScroll.prototype.tbs_showScroll=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal){let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");let scrollBox=document.querySelector(selector+" .tbs-grid-scroll-box");let wrap=document.querySelector(selector+" .tbs-grid-wrap");xScroll.style.display="";scrollBox.style.display="";wrap.style.marginBottom=scroll.margin;scroll.tbs_setScrollSize(type)}else if(type==grid.code_vertical){}};TbsGridScroll.prototype.tbs_hideScroll=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal){let wrap=document.querySelector(selector+" .tbs-grid-wrap");let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");let scrollBox=document.querySelector(selector+" .tbs-grid-scroll-box");let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");xScroll.style.display="none";wrap.style.marginBottom="0px";if(xScroll.style.display=="none"&&yScroll.style.display=="none")scrollBox.style.display="none";document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar").style.left="0px";document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").style.left="0px";document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table").style.left="0px";document.querySelector(selector+" .tbs-grid-panel40 .tbs-grid-table").style.left="0px";document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table").style.left="0px";document.querySelector(selector+" .tbs-grid-panel60 .tbs-grid-table").style.left="0px"}else if(type==grid.code_vertical){let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");let scrollBox=document.querySelector(selector+" .tbs-grid-scroll-box");yScroll.style.display="none";if(xScroll.style.display=="none"&&yScroll.style.display=="none")scrollBox.style.display="none"}};TbsGridScroll.prototype.tbs_setScrollSize=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal){let barSize=scroll.tbs_getBarSize(type);let hiddenSize=scroll.tbs_getHiddenSize(type);let railSize=scroll.tbs_getRailSize(type,barSize);scroll.barSize=barSize;scroll.railSize=railSize;scroll.hiddenSize=hiddenSize;let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");xBar.style.width=scroll.tbs_getBarWidth(type,barSize)}else if(type==grid.code_vertical){let barSize=scroll.tbs_getBarSize(type);let railSize=scroll.tbs_getRailSize(type,barSize);let moveCount=scroll.tbs_getMoveCount(type,railSize);scroll.barSize=barSize;scroll.railSize=railSize;scroll.moveCount=moveCount;let yBar=document.querySelector(selector+" .tbs-grid-vertical-scroll-bar");yBar.style.height=barSize+"px"}};TbsGridScroll.prototype.tbs_getBarSize=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal)return scroll.tbs_getHorizontalBarSize();else if(type==grid.code_vertical)return scroll.tbs_getVerticalBarSize()};TbsGridScroll.prototype.tbs_getHorizontalBarSize=function(){let selector=this.selector;let grid=this.grid;let scroll=this;let panel20=document.querySelector(selector+" .tbs-grid-panel20");let xWrap=document.querySelector(selector+" .tbs-grid-horizontal-scroll-wrap");let barSize=parseInt(panel20.clientWidth/panel20.childNodes[0].childNodes[0].clientWidth*xWrap.clientWidth);if(barSize>xWrap.clientWidth)barSize=xWrap.clientWidth;else if(barSize<35)barSize=35;if(panel20.childNodes[0].getBoundingClientRect().width<panel20.getBoundingClientRect().width)barSize=xWrap.clientWidth;return barSize};TbsGridScroll.prototype.tbs_getVerticalBarSize=function(){let selector=this.selector;let grid=this.grid;let scroll=this;if(grid.fixedRowIndex!=-1){let yWrap=document.querySelector(selector+" .tbs-grid-vertical-scroll-wrap");let rowCount=grid.tbs_getRowCount()-(grid.fixedRowIndex+1);let barSize=yWrap.clientHeight-rowCount*6.3;if(barSize<50)barSize=50;return barSize}else{let yWrap=document.querySelector(selector+" .tbs-grid-vertical-scroll-wrap");let rowCount=grid.tbs_getRowCount();let barSize=yWrap.clientHeight-rowCount*6.3;if(barSize<50)barSize=50;return barSize}};TbsGridScroll.prototype.tbs_getRailSize=function(type,barSize){let selector=this.selector;let grid=this.grid;let scroll=this;if(type==grid.code_horizontal)return scroll.tbs_getHorizontalRailSize(barSize);else if(type==grid.code_vertical)return scroll.tbs_getVerticalRailSize(barSize)};TbsGridScroll.prototype.tbs_getHorizontalRailSize=function(barSize){let selector=this.selector;let grid=this.grid;let scroll=this;let xWrap=document.querySelector(selector+" .tbs-grid-horizontal-scroll-wrap");return xWrap.clientWidth-barSize};TbsGridScroll.prototype.tbs_getVerticalRailSize=function(barSize){let selector=this.selector;let grid=this.grid;let scroll=this;let yWrap=document.querySelector(selector+" .tbs-grid-vertical-scroll-wrap");let railSize=yWrap.clientHeight-barSize;return railSize};TbsGridScroll.prototype.tbs_getMoveCount=function(type,railSize){let selector=this.selector;let grid=this.grid;let scroll=this;let moveCount=0;let pageIntRowCount=grid.pageIntRowCount;let pageRowCount=grid.pageRowCount;if(grid.fixedRowIndex!=-1){let rowCount=grid.tbs_getRowCount()-(grid.fixedRowIndex+1);if(pageRowCount>pageIntRowCount)moveCount=Number((rowCount-pageRowCount+1)/railSize);else moveCount=Number((rowCount-pageRowCount)/railSize)}else{let rowCount=grid.tbs_getRowCount();if(pageRowCount>pageIntRowCount)moveCount=Number((rowCount-pageRowCount+1)/railSize);else moveCount=Number((rowCount-pageRowCount)/railSize)}return moveCount};TbsGridScroll.prototype.tbs_getHiddenSize=function(type){let selector=this.selector;let grid=this.grid;let scroll=this;let panel20=document.querySelector(selector+" .tbs-grid-panel20");let hiddenSize=Number(panel20.scrollWidth-panel20.clientWidth)+16;if(panel20.childNodes[0].getBoundingClientRect().width<panel20.getBoundingClientRect().width)hiddenSize=0;return hiddenSize};TbsGridScroll.prototype.tbs_getBarWidth=function(type,barSize){let selector=this.selector;let grid=this.grid;let scroll=this;let wrapRect=document.querySelector(selector+" .tbs-grid-horizontal-scroll-wrap").getBoundingClientRect();let xBarRect=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar").getBoundingClientRect();let barWidth=barSize;if(xBarRect.right>wrapRect.right)barWidth=barSize-(xBarRect.right-wrapRect.right);return barWidth+"px"};class TbsGridSort{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId;this.sortColumns=[];this.options={};this.infoText=grid.gridConfig.options.sortInfoText}}TbsGrid.prototype.tbs_setSortData=function(data,sortColumns){let grid=this;let len=sortColumns.length;data.sort((a,b)=>{for(let i=0;i<len;i++){let sortColumn=sortColumns[i];let name=sortColumn[grid.column_name];let column=grid.tbs_getColumn(name);let type=column[grid.column_type];if(sortColumn["order"]=="asc"){if(type==grid.code_number||type==grid.code_currency){let x=a[name]!=null&&isNaN(a[name])==false?Number(a[name].toString().replace(/\,/g,"")):0;let y=b[name]!=null&&isNaN(b[name])==false?Number(b[name].toString().replace(/\,/g,"")):0;if(x<y)return-1;else if(x>y)return 1}else{if((a[name]==null?"":a[name]).toString().toLowerCase()<(b[name]==null?"":b[name]).toString().toLowerCase())return-1;else if((a[name]==null?"":a[name]).toString().toLowerCase()>(b[name]==null?"":b[name]).toString().toLowerCase())return 1}}else if(sortColumn["order"]=="desc"){if(type==grid.code_number||type==grid.code_currency){let x=a[name]!=null&&isNaN(a[name])==false?Number(a[name].toString().replace(/\,/g,"")):0;let y=b[name]!=null&&isNaN(b[name])==false?Number(b[name].toString().replace(/\,/g,"")):0;if(x<y)return 1;else if(x>y)return-1}else{if((a[name]==null?"":a[name]).toString().toLowerCase()<(b[name]==null?"":b[name]).toString().toLowerCase())return 1;else if((a[name]==null?"":a[name]).toString().toLowerCase()>(b[name]==null?"":b[name]).toString().toLowerCase())return-1}}}})};TbsGrid.prototype.tbs_sortJsonData=function(data,sortColumns){let grid=this;let len=sortColumns.length;data.sort((a,b)=>{for(let i=0;i<len;i++){let sortColumn=sortColumns[i];let name=sortColumn[grid.column_name];let column=grid.tbs_getColumn(name);let type=column[grid.column_type];if(sortColumn["order"]=="asc"){if(type=="number"){let x=a[name]!=null&&isNaN(a[name])==false?Number(a[name].toString().replace(/\,/g,"")):0;let y=b[name]!=null&&isNaN(b[name])==false?Number(b[name].toString().replace(/\,/g,"")):0;if(x<y)return-1;if(x>y)return 1}else{if((a[name]==null?"":a[name]).toString().toLowerCase()<(b[name]==null?"":b[name]).toString().toLowerCase())return-1;if((a[name]==null?"":a[name]).toString().toLowerCase()>(b[name]==null?"":b[name]).toString().toLowerCase())return 1}}else if(sortColumn["order"]=="desc"){if(type=="number"){let x=a[name]!=null&&isNaN(a[name])==false?Number(a[name].toString().replace(/\,/g,"")):0;let y=b[name]!=null&&isNaN(b[name])==false?Number(b[name].toString().replace(/\,/g,"")):0;if(x<y)return 1;if(x>y)return-1}else{if((a[name]==null?"":a[name]).toString().toLowerCase()<(b[name]==null?"":b[name]).toString().toLowerCase())return 1;if((a[name]==null?"":a[name]).toString().toLowerCase()>(b[name]==null?"":b[name]).toString().toLowerCase())return-1}}}})};TbsGrid.prototype.tbs_getSortColumn=function(columnName){let index=this.tbs_getSortColumnIndex(columnName);return this.classSort.sortColumns[index]};TbsGrid.prototype.tbs_getSortColumnIndex=function(columnName){let grid=this;let result=-1;for(let i=0,len=this.classSort.sortColumns.length;i<len;i++){let sortColumn=this.classSort.sortColumns[i];if(columnName==sortColumn[grid.column_name]){result=i;break}}return result};TbsGrid.prototype.tbs_getSortColumnName=function(colIndex){return this.classSort.sortColumns[colIndex][this.column_name]};TbsGrid.prototype.setSort=function(sortColumns,display){let grid=this;let view=this.data_view;this.classSort.sortColumns=sortColumns;let len=sortColumns.length;if(len==0)return;this.data_view.sort(function(a,b){for(let i=0;i<len;i++){let row=sortColumns[i];let type=grid.tbs_getColumn(row.name)[grid.column_type];if(row["order"]=="asc"){if(type=="number"){let x=a[row.name]!=null&&isNaN(a[row.name])==false?Number(a[row.name].toString().replace(/\,/g,"")):0;let y=b[row.name]!=null&&isNaN(b[row.name])==false?Number(b[row.name].toString().replace(/\,/g,"")):0;if(x<y)return-1;if(x>y)return 1}else{if((a[row.name]==null?"":a[row.name]).toString().toLowerCase()<(b[row.name]==null?"":b[row.name]).toString().toLowerCase())return-1;if((a[row.name]==null?"":a[row.name]).toString().toLowerCase()>(b[row.name]==null?"":b[row.name]).toString().toLowerCase())return 1}}else if(row["order"]=="desc"){if(type=="number"){let x=a[row.name]!=null&&isNaN(a[row.name])==false?Number(a[row.name].toString().replace(/\,/g,"")):0;let y=b[row.name]!=null&&isNaN(b[row.name])==false?Number(b[row.name].toString().replace(/\,/g,"")):0;if(x<y)return 1;if(x>y)return-1}else{if((a[row.name]==null?"":a[row.name]).toString().toLowerCase()<(b[row.name]==null?"":b[row.name]).toString().toLowerCase())return 1;if((a[row.name]==null?"":a[row.name]).toString().toLowerCase()>(b[row.name]==null?"":b[row.name]).toString().toLowerCase())return-1}}}});if(display==undefined||display)this.tbs_displayPanel30(0)};TbsGrid.prototype.tbs_addSortButton=function(name,text,order,targetIndex){let selector="#"+this.gridId;let grid=this;let sortColumns=grid.classSort.sortColumns;for(let i=0,len=sortColumns.length;i<len;i++){let sortColumn=sortColumns[i];if(name==sortColumn[grid.column_name]){return}}let column={};column[grid.column_name]=name;column[grid.column_text]=text;column[grid.column_order]=order;if(grid.notNull(targetIndex))grid.classSort.sortColumns.splice(targetIndex,0,column);else grid.classSort.sortColumns.push(column);let button=grid.tbs_createSortButton(name);let bar=document.querySelector(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar");if(grid.notNull(targetIndex))bar.insertBefore(button,bar.childNodes[targetIndex]);else bar.append(button);grid.tbs_toggleSortPlaceHolder();grid.tbs_setSortData(grid.data_user,grid.classSort.sortColumns)};TbsGrid.prototype.tbs_removeSortButton=function(element){let selector="#"+this.gridId;let grid=this;let name=element.dataset.name;let columnIndex;let sortColumns=grid.classSort.sortColumns;for(let i=0,len=sortColumns.length;i<len;i++){let sortColumn=sortColumns[i];if(name==sortColumn[grid.column_name]){columnIndex=i;break}}sortColumns.splice(columnIndex,1);let button=element.parentNode;button.remove();grid.tbs_toggleSortPlaceHolder();if(grid.grid_mode==grid.code_group){grid.tbs_setData(grid.data_view,null,false)}else{if(grid.tbs_isSortableColumn()){grid.tbs_setSortData(grid.data_view,grid.classSort.sortColumns);grid.tbs_removeRange(0,-1);grid.tbs_displayPanel30(0)}}};TbsGrid.prototype.tbs_removeSortButtonList=function(){let selector="#"+this.gridId;let grid=this;let buttons=document.querySelectorAll(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar .tbs-grid-panel-button");for(let i=buttons.length-1;i>=0;i--)buttons[i].remove()};TbsGrid.prototype.tbs_getSortButtonList=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_removeSortButtonList();let bar=document.querySelector(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar");let sortColumns=grid.classSort.sortColumns;for(let i=0,len=sortColumns.length;i<len;i++){let sortColumn=sortColumns[i];let button=grid.tbs_createSortButton(sortColumn[grid.column_name]);let bar=document.querySelector(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar");if(grid.null(bar))return;bar.append(button)}grid.tbs_toggleSortPlaceHolder()};TbsGrid.prototype.tbs_createSortButton=function(columnName){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(columnName);let text=document.createElement("span");text.classList.add("tbs-grid-panel-button-text");text.textContent=column.header[grid.column_text];text.dataset.name=columnName;let icon=document.createElement("span");icon.classList.add("tbs-grid-panel-button-icon");icon.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_closed.png)";icon.dataset.name=columnName;let button=document.createElement("div");button.classList.add("tbs-grid-panel-button");button.dataset.name=columnName;button.append(text);button.append(icon);return button};TbsGrid.prototype.tbs_toggleSortPlaceHolder=function(){let selector="#"+this.gridId;let grid=this;let buttons=document.querySelectorAll(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar .tbs-grid-panel-button");let span=document.querySelector(selector+" .tbs-grid-panel90 .tbs-grid-panel-bar-span");if(buttons.length>0)span.style.display="none";else span.style.display="";if(buttons.length==0){}else{}grid.classControl.after_setColumnVisible()};TbsGrid.prototype.tbs_showSortPanel=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_setOption(grid.option_sortVisible,true);let panel=document.querySelector(selector+" .tbs-grid-panel90");panel.classList.remove("tbs-hide");panel.classList.add("tbs-show");grid.tbs_getSortButtonList()};TbsGrid.prototype.tbs_hideSortPanel=function(){let selector="#"+this.gridId;let grid=this;grid.classSort.sortColumns=[];grid.tbs_setOption(grid.option_sortVisible,false);let panel=document.querySelector(selector+" .tbs-grid-panel90");panel.classList.remove("tbs-show");panel.classList.add("tbs-hide")};TbsGrid.prototype.tbs_initSortData=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_getSortButtonList();grid.classSort.sortColumns=[];grid.data_view=grid.tbs_copyJson(grid.data_table);if(grid.options[grid.option_filterVisible]){grid.tbs_filters();grid.apply()}if(grid.grid_mode==grid.code_group){grid.tbs_setData(grid.data_view,null,false)}else{grid.tbs_removeRange(0,-1);grid.tbs_apply()}};class TbsGridTree{constructor(grid){this.grid=grid;this.selector="#"+grid.gridId;this.options={};this.options[grid.code_itemName]=null;this.options[grid.code_parentName]=null;this.options[grid.code_rootValue]=null}}TbsGridTree.prototype.tbs_setTreeOption=function(optionName,optionValue){let selector=this.selector;let grid=this.grid;let classTree=this;classTree.options[optionName]=optionValue};TbsGrid.prototype.tbs_createTreeData=function(dataRows){let selector="#"+this.gridId;let grid=this;let copyRows=[];let resultRows=[];dataRows.map(row=>copyRows.push(grid.tbs_copyJson(row)));const fn_getChildrenRowIds=function(row){row[grid.code_children]=[];for(let i=0,len=copyRows.length;i<len;i++){let copyRow=copyRows[i];if(row[grid.classTree.options[grid.code_itemName]]==copyRow[grid.classTree.options[grid.code_parentName]]){row[grid.code_children].push(copyRow[grid.code_rowId])}}};const fn_addChildrenRows=function(row,depth=1){fn_getChildrenRowIds(row);let arr=row[grid.code_children];row[grid.code_depth]=depth;resultRows.push(grid.tbs_copyJson(row));if(arr.length>0){for(let i=0,len=copyRows.length;i<len;i++){let copyRow=copyRows[i];if(arr.indexOf(copyRow[grid.code_rowId])!=-1)fn_addChildrenRows(copyRow,depth+1)}}};for(let i=0,len=copyRows.length;i<len;i++){let copyRow=copyRows[i];if(grid.classTree.options[grid.code_rootValue]==copyRow[grid.classTree.options[grid.code_parentName]]){fn_addChildrenRows(copyRow)}}return resultRows};TbsGrid.prototype.tbs_setTreeSortColumns=function(sortColumns){let selector="#"+this.gridId;let grid=this;this.classSort.sortColumns=grid.tbs_copyJson(sortColumns)};TbsGrid.prototype.tbs_setTreeData=function(data,openDepth){let selector="#"+this.gridId;let grid=this;if(grid.null(data))return;grid.data_user=grid.tbs_copyJson(data);grid.data_table=[];grid.data_view=[];grid.data_select_panel30=[];grid.data_select_panel31=[];let columns=grid.columns;let dataRows=data;dataRows.map((dataRow,rowIndex)=>dataRow[grid.code_rowId]=rowIndex);dataRows=grid.tbs_createTreeData(dataRows);let count=dataRows.length;for(let i=0;i<count;i++){let source={};let data30={};let row=dataRows[i];source[grid.code_rowId]=data30[grid.code_rowId]=row[grid.code_rowId];source[grid.code_mode]=data30[grid.code_mode]="";source[grid.code_depth]=data30[grid.code_depth]=row[grid.code_depth];source[grid.code_children]=grid.tbs_copyJson(row[grid.code_children]);data30[grid.code_children]=grid.tbs_copyJson(row[grid.code_children]);source[grid.code_isOpen]=false;for(let colIndex=0,len=columns.length;colIndex<len;colIndex++){let col=columns[colIndex];let id=col[grid.column_name];let val=grid.null(row[id])?null:grid.tbs_getFormatValue(col,row[id]);let colType=columns[colIndex][grid.column_type];source[id]=val;data30[id]=val}grid.data_table.push(source);grid.data_view.push(data30)}if(grid.notNull(openDepth)){for(let i=grid.data_view.length-1;i>=0;i--){let row=grid.data_view[i];let depth=row[grid.code_depth];if(depth>openDepth)grid.data_view.splice(i,1)}}grid.maxRowId=dataRows.length;document.querySelector(selector+" .tbs-grid-panel10-filter-input").value="";if(dataRows.length==0){document.querySelector(selector+" .tbs-grid-panel21 td div").textContent="0";grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0)}else{document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=dataRows.length;grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(0);grid.tbs_displayPanel40();grid.tbs_displayPanel50()}if(grid.options[grid.option_autoWidth]==true)grid.tbs_setColumnAutoWidth();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,0,0,0)};TbsGrid.prototype.tbs_setTreeDataTable1=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataTable1(param)};TbsGrid.prototype.tbs_setTreeDataTable2=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataTable2(param)};TbsGrid.prototype.tbs_setTreeDataTable3=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return}let topRowIndex=grid.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=grid.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=grid.tbs_getPageRowCount(panelName);let rowHeight=grid.rowHeight;let columns=grid.columns;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){if(i>grid.tbs_getRowCount()-1)break;let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;if(tableRow.style.height!=grid.rowHeight+"px")tableRow.style.height=rowHeight+"px";grid.tbs_setAlternativeRowColor(panelName,tableRow,i);let selectedValue=grid.tbs_isSelectedCell("panel31",i,0);if(tableRow.style.display=="none")tableRow.style.display="";for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(grid.fixedColumnIndex!=-1){if(x>grid.fixedColumnIndex&&x<startColumnIndex)continue}else{if(x<startColumnIndex)continue}let column=grid.columns[x];let columnName=column[grid.column_name];let colValue=grid.tbs_getText(i,columnName);let divCell=tableCell.childNodes[0];if(x==startColumnIndex){let row=grid.tbs_getRow(i);let rowDepth=row[grid.code_depth];let childrenRows=row[grid.code_children];let icon=grid.tbs_createElementCellIcon();grid.tbs_prependIcon(tableCell,icon);grid.tbs_setTreeIcon(tableCell,i);grid.tbs_setCellStyle(divCell,"paddingLeft",rowDepth*15+"px");grid.tbs_setCellStyle(tableCell,"textAlign",column[grid.column_align]);grid.tbs_setCellStyle(tableCell,"width",column[grid.column_width]+"px");grid.tbs_setCellStyle(tableCell,"backgroundImage","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setCell(tableCell,"rowSpan","1")}else{grid.tbs_setCellStyle(tableCell,"textAlign",column[grid.column_align]);grid.tbs_setCellStyle(tableCell,"width",column[grid.column_width]+"px");grid.tbs_setCellStyle(tableCell,"backgroundImage","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setCell(tableCell,"rowSpan","1")}grid.tbs_setSelectedCell(panelName,tableCell,i,x);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",colValue)}for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(grid.fixedColumnIndex!=-1&&x<=grid.fixedColumnIndex)grid.tbs_setCellStyle(tableCell,"display","none")}tableRowIndex+=1}grid.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,grid.pageRowCount);if(param.panelName=="panel30")document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=grid.tbs_getRowCount()};TbsGrid.prototype.tbs_setTreeDataSummaryTable=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataSummaryTable(param)};TbsGrid.prototype.tbs_setTreeDataHeaderTable1=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataHeaderTable1(param)};TbsGrid.prototype.tbs_setTreeDataHeaderTable2=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataHeaderTable2(param)};TbsGrid.prototype.tbs_setTreeDataHeaderTable3=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataHeaderTable3(param)};TbsGrid.prototype.tbs_setTreeIcon=function(tableCell,rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let arrayChildren=row[grid.code_children];let element=tableCell.querySelector(".tbs-grid-cell-div-icon");if(arrayChildren.length>0){let nextRow=grid.tbs_getRow(rowIndex+1);if(grid.null(nextRow))grid.tbs_toggleTreeIcon(rowIndex,element,"closed");else{if(nextRow[grid.classTree.options[grid.code_parentName]]==row[grid.classTree.options["itemName"]])grid.tbs_toggleTreeIcon(rowIndex,element,"open");else grid.tbs_toggleTreeIcon(rowIndex,element,"closed")}}else grid.tbs_toggleTreeIcon(rowIndex,element)};TbsGrid.prototype.tbs_toggleTreeIcon=function(rowIndex,element,type){let selector="#"+this.gridId;let grid=this;if(type==grid.code_open)element.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_open.png)";else if(type==grid.code_closed)element.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"tree_closed.png)";else element.style["backgroundImage"]=""};TbsGrid.prototype.tbs_getTreeFlodingStatus=function(tableCell){let selector="#"+this.gridId;let grid=this;let spanIcon=tableCell.querySelector(".tbs-grid-cell-div-icon");if(grid.null(spanIcon))return null;if(spanIcon.style["backgroundImage"].includes("tree_open.png"))return grid.code_open;else if(spanIcon.style["backgroundImage"].includes("tree_closed.png"))return grid.code_closed;else return null};TbsGrid.prototype.tbs_setTreeFolding=function(tableCell){let selector="#"+this.gridId;let grid=this;let rowIndex=parseInt(tableCell.parentNode.dataset.rowIndex);let row=grid.tbs_getRow(rowIndex);let spanIcon=tableCell.querySelector(".tbs-grid-cell-div-icon");if(grid.null(spanIcon))return;let folding=grid.tbs_getTreeFlodingStatus(tableCell);if(folding==grid.code_open)grid.tbs_closeTreeRow(rowIndex);else if(folding==grid.code_closed)grid.tbs_openTreeRow(rowIndex,false);grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())};TbsGrid.prototype.tbs_getTreeChildrenRows=function(folding,rowIndex,isAll=true){let selector="#"+this.gridId;let grid=this;let dataRows=grid.data_table;let resultRows=[];const fn_getChildrenRows=function(row,count){if(count>1)resultRows.push(grid.tbs_copyJson(row));let arr=row[grid.code_children];if(arr.length>0){if(count==1){for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];if(arr.indexOf(dataRow[grid.code_rowId])!=-1){fn_getChildrenRows(dataRow,count+1)}}}else{if(folding==grid.code_open){if(row[grid.code_isOpen]){for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];if(arr.indexOf(dataRow[grid.code_rowId])!=-1){fn_getChildrenRows(dataRow,count+1)}}}}else{for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];if(arr.indexOf(dataRow[grid.code_rowId])!=-1){fn_getChildrenRows(dataRow,count+1)}}}}}};let row=grid.tbs_getRow(rowIndex);fn_getChildrenRows(row,1);return resultRows};TbsGrid.prototype.tbs_openTreeRow=function(rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let rowId=row[grid.code_rowId];for(let i=0,len=grid.data_table.length;i<len;i++){if(rowId==grid.data_table[i][grid.code_rowId])grid.data_table[i][grid.code_isOpen]=true}let rows=grid.tbs_getTreeChildrenRows(grid.code_open,rowIndex,false);grid.tbs_addTreeRows(rowIndex)};TbsGrid.prototype.tbs_closeTreeRow=function(rowIndex){let selector="#"+this.gridId;let grid=this;let row=grid.tbs_getRow(rowIndex);let rowId=row[grid.code_rowId];for(let i=0,len=grid.data_table.length;i<len;i++){if(rowId==grid.data_table[i][grid.code_rowId])grid.data_table[i][grid.code_isOpen]=false}let rows=grid.tbs_getTreeChildrenRows(grid.code_closed,rowIndex,true);rows.map(row=>grid.tbs_removeTreeRow(row))};TbsGrid.prototype.tbs_addTreeRows=function(rowIndex){let selector="#"+this.gridId;let grid=this;let rows=grid.tbs_getTreeChildrenRows(grid.code_open,rowIndex,false);for(let i=0,startRowIndex=rowIndex+1,len=rows.length;i<len;i++,startRowIndex++){grid.tbs_addTreeRow(startRowIndex,rows[i])}};TbsGrid.prototype.tbs_addTreeRow=function(startRowIndex,row){let selector="#"+this.gridId;let grid=this;startRowIndex=parseInt(startRowIndex);if(startRowIndex==grid.data_view.length){grid.data_view.push(row)}else{grid.data_view.splice(startRowIndex,0,row)}};TbsGrid.prototype.tbs_removeTreeRow=function(row){let selector="#"+this.gridId;let grid=this;grid.tbs_removeRowInPanel30(row);grid.data_select_panel30=[];grid.data_select_panel31=[]};TbsGrid.prototype.tbs_setColumnDefaultValue=function(column){let selector="#"+this.gridId;let grid=this;let columnType=column[grid.column_type];column[grid.column_width]=100;column[grid.column_editable]=null;column[grid.column_visible]=true;if(columnType==grid.code_string){column[grid.column_align]="left"}else if(columnType==grid.code_number){column[grid.column_align]="right";column[grid.column_scale]="18,0";column[grid.column_roundType]="round";column[grid.column_fixedScale]=true;column[grid.column_showZero]=false;column[grid.column_commaUnit]=3;column[grid.column_thousandChar]=grid.gridConfig.culture.thousandChar;column[grid.column_decimalChar]=grid.gridConfig.culture.decimalChar}else if(columnType==grid.code_currency){column[grid.column_align]="right";column[grid.column_scale]="18,0";column[grid.column_roundType]="round";column[grid.column_fixedScale]=true;column[grid.column_showZero]=false;column[grid.column_commaUnit]=3;column[grid.column_thousandChar]=grid.gridConfig.culture.thousandChar;column[grid.column_decimalChar]=grid.gridConfig.culture.decimalChar;column[grid.column_currencyChar]=grid.gridConfig.culture.currencyChar}else if(columnType==grid.code_date){column[grid.column_align]="center";column[grid.column_format]=grid.gridConfig.calendar.dayPattern}else if(columnType==grid.code_combo){column[grid.column_align]="left"}return column};TbsGrid.prototype.tbs_createColumn=function(userColumns){let selector="#"+this.gridId;let grid=this;if(grid.columns.length>0){let prevColumns=grid.tbs_copyJson(grid.columns);grid.userColumns=grid.tbs_copyJson(userColumns);userColumns=grid.userColumns;let columns=[];const getColumnList=function(userColumns){const searchColumn=function(node){if(!node[grid.column_children]){let columnType=node[grid.column_type];let column={};column[grid.column_type]=grid.null(columnType)?grid.code_string:columnType;column=grid.tbs_setColumnDefaultValue(column);for(let key in node){if(grid.null(key))continue;column[key]=node[key]}columns.push(column)}else node[grid.column_children].map(n=>searchColumn(n))};userColumns.map(userColumn=>searchColumn(userColumn,null))};getColumnList(grid.userColumns);columns.map(column=>{if(grid.tbs_empty(column[grid.column_name]))grid.tbs_error(`column's id is not exist`);if(grid.tbs_empty(column.header[grid.column_text]))grid.tbs_error(`column's text is not exist`)});let result=[];for(let i=0;i<columns.length;i++){let column=columns[i];let addColumn=column;for(let x=0;x<prevColumns.length;x++){let prevColumn=prevColumns[x];if(column[grid.column_name]==prevColumn[grid.column_name])addColumn=prevColumn}result.push(grid.tbs_copyJson(addColumn))}grid.columns=result;grid.tbs_createHeader(grid.headerColumns)}else{grid.userColumns=grid.tbs_copyJson(userColumns);userColumns=grid.userColumns;let columns=[];const getColumnList=function(userColumns){const searchColumn=function(node){if(!node[grid.column_children]){let columnType=node[grid.column_type];let column={};column[grid.column_type]=grid.null(columnType)?grid.code_string:columnType;column=grid.tbs_setColumnDefaultValue(column);for(let key in node){if(grid.null(key))continue;column[key]=node[key]}columns.push(column)}else node[grid.column_children].map(n=>searchColumn(n))};userColumns.map(userColumn=>searchColumn(userColumn,null))};getColumnList(grid.userColumns);columns.map(column=>{if(grid.tbs_empty(column[grid.column_name]))grid.tbs_error(`column's id is not exist`);if(grid.tbs_empty(column.header[grid.column_text]))grid.tbs_error(`column's text is not exist`);if(grid.tbs_isNotValidColumnType(column[grid.column_type]))grid.tbs_error(`column's type [${column[grid.column_type]}] is not valid`)});grid.columns=columns;grid.tbs_createHeader(grid.userColumns)}};TbsGrid.prototype.tbs_addColumn=function(addColumn,targetRowIndex,targetColumnIndex,orderType){let selector="#"+this.gridId;let grid=this;if(grid.tbs_isColumnName(addColumn[grid.column_name])){alert("Duplication column name.");return}let result=[];let headerColumn=grid.tbs_getHeaderColumn(targetRowIndex,targetColumnIndex);if(grid.null(headerColumn)){alert("Header column not found.");return}let targetColumn;let parentColumn;let num=headerColumn[grid.column_num];let parentNum=headerColumn[grid.column_parentNum];targetColumn=grid.tbs_getHeaderColumnByNumber(num);if(parentNum!=0){parentColumn=grid.tbs_getHeaderColumnByNumber(parentNum);parentColumn=parentColumn.childNodes}else parentColumn=grid.headerColumns;let targetIndex;for(let i=0;i<parentColumn.length;i++){let node=parentColumn[i];if(num==node[grid.column_num])targetIndex=i}if(orderType==grid.code_before){parentColumn.splice(targetIndex,0,addColumn)}else if(orderType==grid.code_after){targetIndex+=1;if(targetIndex>=parentColumn.length)parentColumn.push(addColumn);else parentColumn.splice(targetIndex,0,addColumn)}grid.classControl.after_addColumn()};TbsGrid.prototype.tbs_removeColumn=function(targetRowIndex,targetColumnIndex){let selector="#"+this.gridId;let grid=this;let result=[];let headerColumn=grid.tbs_getHeaderColumn(targetRowIndex,targetColumnIndex);if(grid.null(headerColumn)){alert("Header column not found.");return}let targetColumn;let parentColumn;let num=headerColumn[grid.column_num];let parentNum=headerColumn[grid.column_parentNum];targetColumn=grid.tbs_getHeaderColumnByNumber(num);if(parentNum!=0){parentColumn=grid.tbs_getHeaderColumnByNumber(parentNum);parentColumn=parentColumn.childNodes}else parentColumn=grid.headerColumns;let targetIndex;for(let i=0;i<parentColumn.length;i++){let node=parentColumn[i];if(num==node[grid.column_num])targetIndex=i}parentColumn.splice(targetIndex,1);grid.classControl.after_removeColumn()};TbsGrid.prototype.tbs_getColumn=function(name){let cellIndex=this.tbs_getColumnIndex(name);return this.columns[cellIndex]};TbsGrid.prototype.tbs_getColumnByIndex=function(colIndex){return this.columns[colIndex]};TbsGrid.prototype.tbs_getColumnName=function(colIndex){return this.columns[colIndex][this.column_name]};TbsGrid.prototype.tbs_getColumnIndex=function(name){let grid=this;let result=null;if(this.columns.length==0)return result;for(let i=0,len=this.columns.length;i<len;i++){let column=this.columns[i];if(name==column[grid.column_name]){result=i;break}}return result};TbsGrid.prototype.tbs_getColumns=function(){return this.columns};TbsGrid.prototype.tbs_getColumnPropertyByIndex=function(columnIndex,property){let grid=this;let column=grid.columns[columnIndex];let result=grid.null(column[property])?null:column[property];return result};TbsGrid.prototype.tbs_getColumnProperty=function(columnName,property){let grid=this;let columnIndex=grid.tbs_getColumnIndex(columnName);return grid.null(columnIndex)?null:grid.tbs_getColumnPropertyByIndex(columnIndex,property)};TbsGrid.prototype.tbs_getFirstVisibleColumnIndex=function(){let result=null;for(let i=0;i<this.columns.length;i++){let column=this.columns[i];if(column[this.column_visible]){result=i;break}}return result};TbsGrid.prototype.tbs_getLastVisibleColumnIndex=function(){let result=null;for(let i=this.columns.length-1;i>=0;i--){let column=this.columns[i];if(column[this.column_visible]){result=i;break}}return result};TbsGrid.prototype.tbs_setColumn=function(columnName,property,value){let column=this.tbs_getColumn(columnName);column[property]=value;if(property==this.column_visible){}};TbsGrid.prototype.tbs_setColumnByType=function(columnType,property,value){let grid=this;let columns=this.columns;for(let i=0,len=columns.length;i<len;i++){let column=columns[i];if(column[grid.column_type]==columnType)column[property]=value}};TbsGrid.prototype.tbs_setSortColumn=function(sortColumn){this.classSort.sortColumns=Object.keys(sortColumn).length==0?[]:sortColumn};TbsGrid.prototype.tbs_setGroupColumn=function(groupColumn){this.classGroup.groupColumns=Object.keys(groupColumn).length==0?[]:groupColumn;if(Object.keys(this.sortColumn).length==0)this.sortColumn=Object.keys[sortColumn].length==0?[]:groupColumn};TbsGrid.prototype.tbs_getSelectedTableCell=function(rowIndex,cellIndex){let selector="#"+this.gridId;let grid=this;let td=null;let startRowIndex;let startCellIndex;if(arguments.length==0){startRowIndex=this.startRowIndex;startCellIndex=this.startCellIndex}else{startRowIndex=rowIndex;startCellIndex=cellIndex}if(startRowIndex==-1||startCellIndex==-1)return;let trList=document.querySelectorAll(selector+" .tbs-grid-panel31 table tbody tr");let trContentList=document.querySelectorAll(selector+" .tbs-grid-panel30 table tbody tr");for(let i=0;i<trList.length;i++){let tr=trList[i];let dataRowIndex=parseInt(tr.childNodes[0].childNodes[0].innerText)-1;if(dataRowIndex==startRowIndex){let td=trContentList[i].childNodes[startCellIndex];break}}return td};TbsGrid.prototype.tbs_getRowIndexInTable=function(tableRowIndex,panelName="panel31"){let selector="#"+this.gridId;let grid=this;let leftPanelName=panelName;if(panelName=="panel61"||panelName=="panel62"||panelName=="panel60")leftPanelName="panel61";else leftPanelName="panel31";let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+leftPanelName+" .tbs-grid-table tr");return parseInt(tableRows[tableRowIndex].childNodes[0].dataset.rowIndex)};TbsGrid.prototype.tbs_getLeftTableCell=function(rowIndex,panel="panel31"){1;let selector="#"+this.gridId;let grid=this;let result=null;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panel+' .tbs-grid-table tbody tr:not([style*="display:"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let index=parseInt(tableRow.childNodes[0].childNodes[0].innerText)-1;if(index==rowIndex){result=tableRow.childNodes[0];break}}return result};TbsGrid.prototype.tbs_getJsonRow=function(jsonArray,name,value){let result;for(let i=0,len=jsonArray.length;i<len;i++){let json=jsonArray[i];if(json[name]==value){result=json;break}}return result};TbsGrid.prototype.tbs_setGridData=function(data){let selector="#"+this.gridId;let grid=this;if(data==undefined)return;let column=this.columns;this.data_insert=[];this.data_update=[];this.data_delete=[];this.data_select_panel30=[];this.data_select_panel31=[];for(let rowIndex=0;rowIndex<data.length;rowIndex++){data[rowIndex][grid.code_rowId]=rowIndex}this.data_user=grid.tbs_copyJson(data);this.data_table=[];this.data_view=[];let count=data.length;for(let i=0;i<count;i++){let source={};let data30={};let page={};let row=data[i];source[grid.code_rowId]=row[grid.code_rowId];data30[grid.code_rowId]=row[grid.code_rowId];page[grid.code_rowId]=row[grid.code_rowId];source[grid.code_mode]="";data30[grid.code_mode]="";page[grid.code_mode]="";for(let colIndex=0,len=column.length;colIndex<len;colIndex++){let col=column[colIndex];let columnName=col[grid.column_name];let val=this.null(row[columnName])?null:this.tbs_getFormatValue(col,row[columnName]);let colType=column[colIndex][grid.column_type];source[columnName]=val;data30[columnName]=val;page[columnName]=val}this.data_table.push(source);this.data_view.push(data30);if(grid.grid_mode==grid.module_paging)this.data_page.push(page)}this.maxRowId=data.length;grid.tbs_setTopData();grid.tbs_setFooterData();if(this.tbs_isAutoWidthColumn())this.tbs_setColumnAutoWidth();document.querySelector(selector+" .tbs-grid-panel10-filter-input").value="";this.tbs_removeRange(0,-1);this.tbs_selectRange(0,0,0,0);if(data.length==0){document.querySelector(selector+" .tbs-grid-panel21 td div").textContent="0";this.tbs_displayPanel30(0);this.verticalScroll.tbs_setScroll(grid.code_vertical)}else{document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=data.length;this.tbs_displayPanel30(0);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel40();this.tbs_displayPanel50()}};TbsGrid.prototype.tbs_refreshRefData=function(){let selector="#"+this.gridId;let grid=this;let data=this.data_view;this.data_select_panel30=[];this.data_select_panel31=[];for(let rowIndex=0;rowIndex<data.length;rowIndex++){let itemSelect={};let itemLeftSelect={};let itemLeftView={};itemSelect[grid.code_rowId]=data[rowIndex][grid.code_rowId];itemSelect=new Uint8ClampedArray([]);itemLeftView[grid.code_mode]="";itemLeftView[grid.code_rowId]=data[rowIndex][grid.code_rowId];itemLeftSelect[grid.code_mode]=0;itemLeftSelect[grid.code_rowId]=data[rowIndex][grid.code_rowId];this.data_select_panel30.push(itemSelect);this.data_select_panel31.push(itemLeftSelect)}this.tbs_removeRange(0,-1);this.tbs_displayPanel30(0)};TbsGrid.prototype.tbs_getValue=function(rowIndex,columnName){let column=this.tbs_getColumn(columnName);let columnType=column[this.column_type];let val=this.data_view[rowIndex][columnName];if(columnType==this.code_number)return Number(val);else if(columnType==this.code_currency)return Number(val);else return val};TbsGrid.prototype.tbs_getValueByIndex=function(rowIndex,colIndex){let columnName=this.tbs_getColumnName(colIndex);return this.tbs_getValue(rowIndex,columnName)};TbsGrid.prototype.tbs_getText=function(rowIndex,columnName){let column=this.tbs_getColumn(columnName);let val=this.tbs_getValue(rowIndex,columnName);return this.tbs_getFormatText(column,val)};TbsGrid.prototype.tbs_getTextByIndex=function(rowIndex,colIndex){let columnName=this.tbs_getColumnName(colIndex);return this.tbs_getText(rowIndex,columnName)};TbsGrid.prototype.tbs_getSourceText=function(rowIndex,columnName){let val=this.data_table[rowIndex][columnName];let column=this.getColumn(columnName);return this.tbs_getFormatText(column,val)};TbsGrid.prototype.tbs_setValue=function(rowIndex,id,value){let selector="#"+this.gridId;let grid=this;this.tbs_setDataValue(rowIndex,id,value)};TbsGrid.prototype.tbs_setValueByIndex=function(rowIndex,cellIndex,value){rowIndex=parseInt(rowIndex);cellIndex=parseInt(cellIndex);let id=this.tbs_getColumnName(cellIndex);this.tbs_setValue(rowIndex,id,value)};TbsGrid.prototype.tbs_setDataValue=function(rowIndex,id,value){let selector="#"+this.gridId;let grid=this;let cellIndex=this.tbs_getColumnIndex(id);let oldValue=this.data_view[rowIndex][id];let mode=this.data_view[rowIndex][grid.code_mode];let result=this.tbs_getFormat(this.columns[cellIndex],value);if(mode=="I"){if(oldValue!=result.value){this.data_view[rowIndex][id]=result.value;let rowId=this.data_view[rowIndex][grid.code_rowId];for(let i=0;i<this.data_table.length;i++){if(rowId==this.data_table[i][grid.code_rowId]){this.data_table[i][id]=result.value;this.data_table[i][grid.code_mode]="I";break}}}}else{if(oldValue!=result.value){this.data_view[rowIndex][id]=result.value;this.data_view[rowIndex][grid.code_mode]="U";let rowId=this.data_view[rowIndex][grid.code_rowId];for(let i=0;i<this.data_table.length;i++){if(rowId==this.data_table[i][grid.code_rowId]){this.data_table[i][id]=result.value;this.data_table[i][grid.code_mode]="U";break}}}}};TbsGrid.prototype.tbs_setDataByIndex=function(rowIndex,cellIndex,value){rowIndex=parseInt(rowIndex);cellIndex=parseInt(cellIndex);let id=this.tbs_getColumnName(cellIndex);this.tbs_setDataValue(rowIndex,id,value)};TbsGrid.prototype.tbs_createEmptyRow=function(rowId){let selector="#"+this.gridId;let grid=this;let columns=grid.columns;let row={};row[grid.code_rowId]=rowId;row[grid.code_mode]="";for(let i=0,len=columns.length;i<len;i++){let column=columns[i];let columnName=column[grid.column_name];row[columnName]=this.null(row[columnName])?null:row[columnName]}return row};TbsGrid.prototype.tbs_createRow=function(row){let selector="#"+this.gridId;let grid=this;let columns=this.columns;this.maxRowId=this.maxRowId+1;let rowId=this.maxRowId;let source={};source[grid.code_rowId]=rowId;source[grid.code_mode]="I";let data30={};data30[grid.code_rowId]=rowId;data30[grid.code_mode]="I";for(let i=0,len=columns.length;i<len;i++){let column=columns[i];let id=column[grid.column_name];source[id]=this.null(row[id])?null:row[id];data30[id]=this.null(row[id])?null:row[id]}return{source:source,data30:data30}};TbsGrid.prototype.tbs_getRowCount=function(){return this.data_view.length};TbsGrid.prototype.tbs_getRow=function(rowIndex){let grid=this;if(rowIndex<0||rowIndex>=grid.data_view.length)return null;return grid.tbs_copyJson(grid.data_view[rowIndex])};TbsGrid.prototype.tbs_getRows=function(startRowIndex=0,endRowIndex=-1){let grid=this;let result=[];let rows=this.data_view;if(arguments.length==0){rows.map(row=>result.push(grid.tbs_copyJson(row)))}else{if(endRowIndex==-1)endRowIndex=rows.length-1;for(let i=startRowIndex;i<=endRowIndex;i++){let row=rows[i];result.push(grid.tbs_copyJson(row))}}return result};TbsGrid.prototype.tbs_getTempRowByRowId=function(rowId){let result={};let grid=this;for(let i=0,len=this.data_temp.length;i<len;i++){if(this.data_temp[i][grid.code_rowId]==rowId){result=grid.tbs_copyJson(this.data_temp[i]);break}}return result};TbsGrid.prototype.tbs_getSourceRowByRowId=function(rowId){let result={};let grid=this;for(let i=0,len=this.data_table.length;i<len;i++){if(this.data_table[i][grid.code_rowId]==rowId){result=grid.tbs_copyJson(this.data_table[i]);break}}return result};TbsGrid.prototype.tbs_getRowByRowId=function(rowId){let result={};let grid=this;for(let i=0,len=this.data_view.length;i<len;i++){if(this.data_view[i][grid.code_rowId]==rowId){result=grid.tbs_copyJson(this.data_view[i]);break}}return result};TbsGrid.prototype.tbs_getRowIndexByRowId=function(rowId){let result={};let grid=this;for(let i=0,len=this.data_view.length;i<len;i++){if(this.data_view[i][grid.code_rowId]==rowId){result=i;break}}return result};TbsGrid.prototype.tbs_getSelectedRow=function(){let data=this.tbs_getSelectedRows();return data.length>0?data[0]:null};TbsGrid.prototype.tbs_getSelectedRows=function(){let selector="#"+this.gridId;let grid=this;let result=[];let len=grid.data_view.length;for(rowIndex=0;rowIndex<len;rowIndex++){let item={};item[grid.code_rowId]=grid.data_view[rowIndex][grid.code_rowId];item[grid.code_mode]=grid.data_view[rowIndex][grid.code_mode];item.rowIndex=rowIndex;item=grid.tbs_copyJson(grid.data_view[rowIndex]);if(this.tbs_isSelectedCell31(rowIndex,0)==1)result.push(item)}return result};TbsGrid.prototype.tbs_getCheckedRows=function(){let selector="#"+this.gridId;let grid=this;let result=[];for(let i=0,len=this.data_view.length;i<len;i++){let row=this.data_view[i];if(row.check){result.push(JSON.parse(JSON.stringify(row)))}}return result};TbsGrid.prototype.tbs_validateTopRowIndex=function(panelName,topRowIndex){let selector="#"+this.gridId;let grid=this;if(panelName=="panel30"||panelName=="panel31"){if(this.fixedRowIndex!=-1){let topRowIndex2=topRowIndex-(this.fixedRowIndex+1);let rowCount=this.tbs_getRowCount()-(this.fixedRowIndex+1);if(this.pageRowCount>this.pageIntRowCount){if(topRowIndex2>rowCount-this.pageRowCount+1){topRowIndex2=rowCount-this.pageRowCount;if(topRowIndex2<0)topRowIndex2=0}}else{if(topRowIndex2>rowCount-this.pageRowCount){topRowIndex2=rowCount-this.pageRowCount;if(topRowIndex2<0)topRowIndex2=0}}if(topRowIndex2<0)topRowIndex2=0;topRowIndex=topRowIndex2+(this.fixedRowIndex+1)}else{let rowCount=this.tbs_getRowCount();if(this.pageRowCount>this.pageIntRowCount){if(topRowIndex>rowCount-this.pageRowCount+1){topRowIndex=rowCount-this.pageRowCount;if(topRowIndex<0)topRowIndex=0}}else{if(topRowIndex>rowCount-this.pageRowCount){topRowIndex=rowCount-this.pageRowCount;if(topRowIndex<0)topRowIndex=0}}if(topRowIndex<0)topRowIndex=0}}else if(panelName=="panel60"){let rowCount=this.fixedRowCount;if(topRowIndex>rowCount-this.fixedRowCount){topRowIndex=rowCount-this.fixedRowCount;if(topRowIndex<0)topRowIndex=0}if(topRowIndex<0)topRowIndex=0}return topRowIndex};TbsGrid.prototype.tbs_validateBottomRowIndex=function(panelName,topRowIndex){let selector="#"+this.gridId;let grid=this;let bottomRowIndex=0;if(this.fixedRowIndex!=-1){if(panelName=="panel31"||panelName=="panel32"||panelName=="panel30"){let rowCount=this.tbs_getRowCount()-(this.fixedRowIndex+1);let displayTopRowIndex=topRowIndex-(this.fixedRowIndex+1);bottomRowIndex=displayTopRowIndex+this.tbs_getPageRowCount(panelName)-1;if(bottomRowIndex>rowCount-1)bottomRowIndex=rowCount-1;bottomRowIndex=bottomRowIndex+(this.fixedRowIndex+1)}else if(panelName=="panel61"||panelName=="panel62"||panelName=="panel60"){bottomRowIndex=topRowIndex+this.fixedRowCount-1;if(bottomRowIndex>this.fixedRowCount-1)bottomRowIndex=this.fixedRowCount-1}}else{bottomRowIndex=topRowIndex+this.pageRowCount-1;if(bottomRowIndex>this.tbs_getRowCount()-1)bottomRowIndex=this.tbs_getRowCount()-1}return bottomRowIndex};TbsGrid.prototype.tbs_getPageRowCount=function(panelName){let selector="#"+this.gridId;let grid=this;if(panelName=="panel61"||panelName=="panel62"||panelName=="panel60"){return this.fixedRowCount}else{return this.pageRowCount}};TbsGrid.prototype.tbs_getChangedRowsData_ref=function(){let grid=this;let d=this.data_table;let c=d.length;let result=[];for(let i=0;i<c;i++){let r=d[i];if(r[grid.code_mode]!="U"&&r[grid.code_mode]!="I")continue;if(r[grid.code_mode]=="U"){let column=this.columns;for(let key in r){for(let x=0;x<column.length;x++){let c=column[x];if(key==c[grid.column_name]&&c[grid.column_required]==true&&c[grid.column_autoWidth]!=true){let value=r[key].replace(/ /gi,"");if(value==""){alert("input required values");return}}}}}if(r.mode=="I"){let column=this.columns;let colCheckCount=0;let colCount=0;for(let key in r){for(let x=0;x<column.length;x++){let c=column[x];if(key==c[grid.column_name]){if(c[grid.column_required]==true&&c[grid.column_autoWidth]!=true){colCount+=1;let value=r[key].replace(/ /gi,"");if(value!="")colCheckCount+=1}}}}if(colCount>colCheckCount){alert("input required values");return}}let item=JSON.parse(JSON.stringify(d[i]));result.push(item)}return result};TbsGrid.prototype.tbs_getChangedRowsData=function(){let result=[];let rows=this.tbs_getDeletedRowsData();for(let i=0,len=rows.length;i<len;i++){result.push(rows[i])}rows=this.tbs_getUpdatedRowsData();for(let i=0,len=rows.length;i<len;i++){result.push(rows[i])}rows=this.tbs_getInsertedRowsData();for(let i=0,len=rows.length;i<len;i++){result.push(rows[i])}return result};TbsGrid.prototype.tbs_getDeletedRowsData=function(){let rows=this.data_delete;let result=[];for(let i=0,len=rows.length;i<len;i++){let row=rows[i];let item=JSON.parse(JSON.stringify(row));item[grid.code_rowId]=row[grid.code_rowId];item[grid.code_mode]=row[grid.code_mode];result.push(item)}return result};TbsGrid.prototype.tbs_getUpdatedRowsData=function(){let rows=this.data_table;let result=[];for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(row.mode=="U"){let item=JSON.parse(JSON.stringify(row));item[grid.code_rowId]=row[grid.code_rowId];item[grid.code_mode]=row[grid.code_mode];result.push(item)}}return result};TbsGrid.prototype.tbs_getInsertedRowsData=function(){let rows=this.data_table;let result=[];for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(row[grid.code_mode]=="I"){let item=JSON.parse(JSON.stringify(row));item[this.code_rowId]=row[grid.code_rowId];item[this.code_mode]=row[grid.code_mode];result.push(item)}}return result};TbsGrid.prototype.tbs_addRow=function(row,type="bottom"){let selector="#"+this.gridId;let grid=this;let columns=this.columns;let rowId=this.maxRowId+1;this.maxRowId=rowId;let json=this.tbs_createRow(row);let source=json.source;let data30=json.data30;let rowIndexList=this.tbs_getSelectedRowIndex();if(rowIndexList.length==0)type="bottom";if(type=="top"){this.data_table.unshift(source);this.data_view.unshift(data30);let topRowIndex=0;this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_setBarPosition(grid.code_vertical,topRowIndex);this.tbs_removeRange(0,-1);this.tbs_selectRange(topRowIndex,topRowIndex);this.tbs_displayPanel30(topRowIndex);return}if(type=="bottom"){this.data_table.push(source);this.data_view.push(data30);let dataLength=this.data_view.length;let topRowIndex=this.tbs_getFirstRowIndex();topRowIndex=dataLength-this.pageRowCount;if(topRowIndex<0)topRowIndex=0;if(this.pageRowCount>this.pageIntRowCount){topRowIndex=topRowIndex+1}this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_setBarPosition(grid.code_vertical,topRowIndex);this.tbs_removeRange(0,-1);this.tbs_selectRange(dataLength-1,dataLength-1);return}if(type=="up"){let minRowIndex=rowIndexList[0];this.data_table.splice(minRowIndex,0,source);this.data_view.splice(minRowIndex,0,data30);let lastRowIndex=this.data_view.length-1;let topRowIndex=this.tbs_getFirstRowIndex();this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_setBarPosition(grid.code_vertical,topRowIndex);this.tbs_removeRange(0,-1);this.tbs_selectRange(minRowIndex,minRowIndex);return}if(type=="down"){let minRowIndex=rowIndexList[0];let addRowIndex=minRowIndex+1;if(minRowIndex==this.data_view.length-1){this.data_table.push(source);this.data_view.push(data30);addRowIndex=minRowIndex+1}else{this.data_table.splice(addRowIndex,0,source);this.data_view.splice(addRowIndex,0,data30)}this.tbs_removeRange(0,-1);this.tbs_selectRange(addRowIndex,addRowIndex);if(this.pageRowCount>this.pageIntRowCount){if(addRowIndex==this.tbs_getLastRowIndex()){this.tbs_moveCell("down");this.tbs_removeRange(0,-1);this.tbs_selectRange(addRowIndex,addRowIndex);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_setBarPosition(grid.code_vertical,grid.tbs_getFirstRowIndex())}}}};TbsGrid.prototype.tbs_removeRows=function(rows){let selector="#"+this.gridId;let grid=this;if(this.null(rows)||rows.length==0)return;let data=this.data_view;let prevRowId=-1;let nextRowId=-1;let nextRowIndex=-1;for(let i=0;i<data.length;i++){if(data[i][grid.code_rowId]==rows[rows.length-1][grid.code_rowId]){nextRowIndex=i+1;break}}nextRowIndex=nextRowIndex>data.length-1?nextRowIndex-1:nextRowIndex;nextRowId=data[nextRowIndex][grid.code_rowId];data=this.data_table;for(let i=data.length-1;i>=0;i--){for(let x=rows.length-1;x>=0;x--){if(data[i][grid.code_rowId]==rows[x][grid.code_rowId]){data.splice(i,1);break}}}data=this.data_view;for(let i=data.length-1;i>=0;i--){for(let x=rows.length-1;x>=0;x--){if(data[i][grid.code_rowId]==rows[x][grid.code_rowId]){data.splice(i,1);break}}}data=this.data_delete;for(let i=data.length-1;i>=0;i--){for(let x=rows.length-1;x>=0;x--){if(data[i][grid.code_rowId]==rows[x][grid.code_rowId]){data.splice(i,1);break}}}for(let i=0;i<rows.length;i++){if(rows[i][grid.code_mode]==""||rows[i][grid.code_mode]=="U"){rows[i][grid.code_mode]="D";data.push(rows[i])}}let deleteFirstRowIndex=rows[0].rowIndex;let topRowIndex=this.tbs_getFirstRowIndex();this.tbs_refreshRefData();data=this.data_view;let realStartRowIndex=deleteFirstRowIndex;if(realStartRowIndex<0)realStartRowIndex=0;if(realStartRowIndex>this.data_view.length-1){realStartRowIndex=this.data_view.length-1}grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_removeRange(0,-1);grid.tbs_selectRange(realStartRowIndex,realStartRowIndex,0,0);grid.tbs_setBarPosition(grid.code_vertical,grid.tbs_getFirstRowIndex());if(grid.pageRowCount>grid.pageIntRowCount){let lastRowIndex=grid.tbs_getLastRowIndex();if(realStartRowIndex==lastRowIndex){grid.tbs_setBarPositionByDirection("down");grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_setBarPosition(grid.code_vertical,grid.tbs_getFirstRowIndex())}}};TbsGrid.prototype.tbs_getFirstDisplayRowIndex=function(panelName=""){let selector="#"+this.gridId;let grid=this;if(this.data_view.length==0)return-1;let trList=document.querySelectorAll(selector+" .tbs-grid-panel31 .tbs-grid-table tbody tr");let displayRowIndex=parseInt(trList[0].childNodes[0].dataset.displayRowIndex);if(isNaN(displayRowIndex))displayRowIndex=0;return displayRowIndex};TbsGrid.prototype.tbs_getFirstRowIndex=function(panelName=""){let selector="#"+this.gridId;let grid=this;if(this.data_view.length==0)return-1;let trList=document.querySelectorAll(selector+" .tbs-grid-panel31 .tbs-grid-table tbody tr");let topRowIndex=parseInt(trList[0].childNodes[0].dataset.rowIndex);if(panelName==""){if(grid.fixedRowIndex!=-1){if(isNaN(topRowIndex))topRowIndex=grid.fixedRowIndex+1;return topRowIndex}else{if(isNaN(topRowIndex))topRowIndex=0;return topRowIndex}}};TbsGrid.prototype.tbs_getLastRowIndex=function(){let selector="#"+this.gridId;let grid=this;if(this.data_view.length==0)return-1;let trList=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');let topRowIndex=this.tbs_getFirstRowIndex();return topRowIndex+trList.length-1};TbsGrid.prototype.tbs_getLastTableRowIndex=function(){let selector="#"+this.gridId;let grid=this;let trList=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');return parseInt(trList.length)-1};TbsGrid.prototype.tbs_getSelectedRowIndex=function(){let result=[];for(rowIndex=0,len=this.data_view.length;rowIndex<len;rowIndex++){if(this.tbs_isSelectedCell31(rowIndex,0)==1)result.push(rowIndex)}return result};TbsGrid.prototype.tbs_removeRow=function(rowToDelete){let selector="#"+this.gridId;let grid=this;grid.tbs_removeRowInPanel30(rowToDelete);grid.tbs_removeRowInSource(rowToDelete);grid.data_select_panel30=[];grid.data_select_panel31=[]};TbsGrid.prototype.tbs_removeRowInPanel30=function(rowToDelete){let selector="#"+this.gridId;let grid=this;let dataRows=grid.data_view;for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];if(rowToDelete[grid.code_rowId]==dataRow[grid.code_rowId]){dataRows.splice(i,1);break}}};TbsGrid.prototype.tbs_removeRowInSource=function(rowToDelete){let selector="#"+this.gridId;let grid=this;let dataRows=grid.data_table;for(let i=0,len=dataRows.length;i<len;i++){let dataRow=dataRows[i];if(rowToDelete[grid.code_rowId]==dataRow[grid.code_rowId]){dataRows.splice(i,1);break}}};TbsGrid.prototype.tbs_setComboData=function(keyName,valueName,comboData){let selector="#"+this.gridId;let grid=this;let item={};item["key"]=keyName;item["val"]=valueName;item["data"]=comboData;return item};TbsGrid.prototype.tbs_applyData=function(){this.tbs_displayPanel30(this.tbs_getFirstRowIndex())};TbsGrid.prototype.tbs_displayPanel10=function(){let selector="#"+this.gridId;let grid=this};TbsGrid.prototype.tbs_displayPanel20=function(){let selector="#"+this.gridId;let grid=this;this.tbs_setDataTable({panelName:"panel20"});grid.horizontalScroll.tbs_setScroll(grid.code_horizontal)};TbsGrid.prototype.tbs_displayPanel30=function(topRowIndex){let selector="#"+this.gridId;let grid=this;grid.tbs_updateTableRows30();grid.tbs_removePanelRange("panel30");grid.tbs_setPageData();grid.tbs_setDataTable({panelName:"panel31",topRowIndex:topRowIndex});grid.tbs_setDataTable({panelName:"panel30",topRowIndex:topRowIndex});grid.tbs_setDataTable({panelName:"panel32",topRowIndex:topRowIndex});grid.tbs_displayPanel60(0);grid.tbs_displaySelectedLine()};TbsGrid.prototype.tbs_displayPanel40=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_removePanelRange("panel40");this.tbs_setDataTable({panelName:"panel41",summaryColumns:grid.topColumns});this.tbs_setDataTable({panelName:"panel40",summaryColumns:grid.topColumns});this.tbs_setDataTable({panelName:"panel42",summaryColumns:grid.topColumns})};TbsGrid.prototype.tbs_displayPanel50=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_removePanelRange("panel50");this.tbs_setDataTable({panelName:"panel51",summaryColumns:grid.footerColumns});this.tbs_setDataTable({panelName:"panel50",summaryColumns:grid.footerColumns});this.tbs_setDataTable({panelName:"panel52",summaryColumns:grid.footerColumns})};TbsGrid.prototype.tbs_displayPanel60=function(topRowIndex){let selector="#"+this.gridId;let grid=this;this.tbs_removePanelRange("panel60");this.tbs_setDataTable({panelName:"panel61",topRowIndex:topRowIndex});this.tbs_setDataTable({panelName:"panel60",topRowIndex:topRowIndex});this.tbs_setDataTable({panelName:"panel62",topRowIndex:topRowIndex})};TbsGrid.prototype.tbs_displayPanel70=function(panel){let selector="#"+this.gridId;let grid=this;this.tbs_setDataTable({panelName:"panel70"})};TbsGrid.prototype.tbs_getFirstSelectedTableCell=function(panelName){let selector="#"+this.gridId;let grid=this;let startCell;let startRowIndex=grid._startRowIndex;if(grid.fixedRowIndex!=-1){let panel;if(startRowIndex<=grid.fixedRowIndex)panel="panel61";else{panel="panel31";let rowIndex1=grid.tbs_getFirstRowIndex();let rowIndex2=grid.tbs_getLastRowIndex();if(startRowIndex<rowIndex1)startRowIndex=rowIndex1}let tableRows31=document.querySelectorAll(selector+" .tbs-grid-"+panel+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');Loop1:for(let i=0,len=tableRows31.length;i<len;i++){let tableRow31=tableRows31[i];let tableRow=tableRows[i];let rowIndex=tableRow31.childNodes[0].dataset.rowIndex;if(rowIndex==startRowIndex){for(let x=0;x<this.columns.length;x++){let tableCell=tableRow.childNodes[x];if(tableCell.classList.contains("tbs-grid-cell-start")||tableCell.classList.contains("tbs-grid-cell-select")){startCell=tableCell;break Loop1}}}}}else{let rowIndex1=grid.tbs_getFirstRowIndex();let rowIndex2=grid.tbs_getLastRowIndex();if(startRowIndex<rowIndex1)startRowIndex=rowIndex1;let tableRows31=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+'  .tbs-grid-table tbody tr:not([style*="display: none"])');Loop1:for(let i=0,len=tableRows31.length;i<len;i++){let tableRow31=tableRows31[i];let tableRow=tableRows[i];let rowIndex=tableRow31.childNodes[0].dataset.rowIndex;if(rowIndex==startRowIndex){for(let x=0;x<this.columns.length;x++){let tableCell=tableRow.childNodes[x];if(tableCell.classList.contains("tbs-grid-cell-start")||tableCell.classList.contains("tbs-grid-cell-select")){startCell=tableCell;break Loop1}}}}}return startCell};TbsGrid.prototype.tbs_getLastSelectedTableCell=function(panelName){let selector="#"+this.gridId;let grid=this;let lastCell;let lastRowIndex=this._lastRowIndex;if(grid.fixedRowIndex!=-1){let panel;if(lastRowIndex<=grid.fixedRowIndex)panel="panel61";else{panel="panel31";let rowIndex1=grid.tbs_getFirstRowIndex();let rowIndex2=grid.tbs_getLastRowIndex();if(lastRowIndex>rowIndex2)lastRowIndex=rowIndex2}let tableRows31=document.querySelectorAll(selector+" .tbs-grid-"+panel+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=tableRows31.length-1;i>=0;i--){if(lastCell!=undefined)break;let tableRow31=tableRows31[i];let tableRow30=tableRows[i];let rowIndex=tableRow31.childNodes[0].dataset.rowIndex;if(rowIndex==lastRowIndex){for(let x=this.columns.length-1;x>=0;x--){let tableCell=tableRow30.childNodes[x];if(tableCell.classList.contains("tbs-grid-cell-start")||tableCell.classList.contains("tbs-grid-cell-select")){lastCell=tableCell;break}}}}return lastCell}else{let rowIndex1=grid.tbs_getFirstRowIndex();let rowIndex2=grid.tbs_getLastRowIndex();if(lastRowIndex>rowIndex2)lastRowIndex=rowIndex2;let tableRows31=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+'  .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=tableRows31.length-1;i>=0;i--){if(lastCell!=undefined)break;let tableRow31=tableRows31[i];let tableRow30=tableRows[i];let rowIndex=tableRow31.childNodes[0].dataset.rowIndex;if(rowIndex==lastRowIndex){for(let x=this.columns.length-1;x>=0;x--){let tableCell=tableRow30.childNodes[x];if(tableCell.classList.contains("tbs-grid-cell-start")||tableCell.classList.contains("tbs-grid-cell-select")){lastCell=tableCell;break}}}}return lastCell}};TbsGrid.prototype.tbs_clearSelectedLine=function(){this.topLineDiv.style="width :0px;top:0px;left:0px;";this.leftLineDiv.style="height:0px;top:0px;left:0px;";this.bottomLineDiv.style="width :0px;top:0px;left:0px;";this.rightLineDiv.style="height:0px;top:0px;left:0px;"};TbsGrid.prototype.tbs_setSelectedLine=function(lineWidth,lineHeight,rectTop,rectBottom,rectLeft,rectRight){this.topLineDiv.style="width:"+lineWidth+"px;top:"+rectTop+"px;left:"+rectLeft+"px;";this.leftLineDiv.style="height:"+lineHeight+"px;top:"+rectTop+"px;left:"+rectLeft+"px;";this.rightLineDiv.style="height:"+(lineHeight+1)+"px;top:"+rectTop+"px;left:"+rectRight+"px;";this.bottomLineDiv.style="width:"+lineWidth+"px;top:"+rectBottom+"px;left:"+rectLeft+"px;"};TbsGrid.prototype.tbs_displaySelectedLine=function(){let selector="#"+this.gridId;let grid=this;if(grid.fixedRowIndex!=-1){let tableRows30=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');if(grid.tbs_getRowCount()==0)return;let fixedColumnIndex=this.fixedColumnIndex;let startCell,lastCell;if(grid._startRowIndex<=grid.fixedRowIndex)startCell=grid.tbs_getFirstSelectedTableCell("panel60");else startCell=grid.tbs_getFirstSelectedTableCell("panel30");if(grid._lastRowIndex<=grid.fixedRowIndex)lastCell=grid.tbs_getLastSelectedTableCell("panel60");else lastCell=grid.tbs_getLastSelectedTableCell("panel30");if(startCell==undefined||lastCell==undefined){grid.tbs_clearSelectedLine();return}let startCellIndex=grid._startCellIndex;let lastCellIndex=grid._lastCellIndex;let rectMain=document.querySelector(selector+" .tbs-grid-main").getBoundingClientRect();let rectTable31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").getBoundingClientRect();let rectWrap=document.querySelector(selector+" .tbs-grid-wrap").getBoundingClientRect();let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let startRect=startCell.getBoundingClientRect();let lastRect=lastCell.getBoundingClientRect();let beforeLeft=rectTable31.left;let rectTop=startRect.top-rectMain.top;let rectBottom=lastRect.top-rectMain.top+lastRect.height;let rectLeft=startRect.left-beforeLeft;let rectRight=lastRect.left-beforeLeft+lastRect.width;let rectPanelLeft=startCellIndex<=fixedColumnIndex?rectLeft:rectPanel30.left-rectTable31.left;let rectPanelBottom=rectPanel30.top-rectMain.top+rectPanel30.height;let rectPanelRight=rectPanel30.left-rectTable31.left+rectPanel30.width;if(rectLeft<=rectPanelLeft)rectLeft=rectPanelLeft;if(rectBottom>=rectPanelBottom)rectBottom=rectPanelBottom-2;if(rectRight>=rectPanelRight)rectRight=rectPanelRight;let lineHeight=rectBottom-rectTop;let lineWidth=rectRight-rectLeft;grid.tbs_setSelectedLine(lineWidth,lineHeight,rectTop,rectBottom,rectLeft,rectRight)}else if(grid.fixedColumnIndex!=-1){let tableRows30=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');if(grid.tbs_getRowCount()==0)return;let fixedColumnIndex=this.fixedColumnIndex;let startCell,lastCell;if(grid._startCellIndex<=grid.fixedColumnIndex)startCell=grid.tbs_getFirstSelectedTableCell("panel32");else startCell=grid.tbs_getFirstSelectedTableCell("panel30");if(grid._lastCellIndex<=grid.fixedColumnIndex)lastCell=grid.tbs_getLastSelectedTableCell("panel32");else lastCell=grid.tbs_getLastSelectedTableCell("panel30");if(startCell==undefined||lastCell==undefined){grid.tbs_clearSelectedLine();return}let startCellIndex=startCell.cellIndex;let lastCellIndex=lastCell.cellIndex;let rectMain=document.querySelector(selector+" .tbs-grid-main").getBoundingClientRect();let rectTable31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").getBoundingClientRect();let rectWrap=document.querySelector(selector+" .tbs-grid-wrap").getBoundingClientRect();let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let startRect=startCell.getBoundingClientRect();let lastRect=lastCell.getBoundingClientRect();let beforeLeft=rectTable31.left;let rectTop=startRect.top-rectMain.top;let rectBottom=lastRect.top-rectMain.top+lastRect.height;let rectLeft=startRect.left-beforeLeft;let rectRight=lastRect.left-beforeLeft+lastRect.width;let rectPanelLeft=startCellIndex<=fixedColumnIndex?rectLeft:rectPanel30.left-rectTable31.left;let rectPanelBottom=rectPanel30.top-rectMain.top+rectPanel30.height;let rectPanelRight=rectPanel30.left-rectTable31.left+rectPanel30.width;if(rectLeft<=rectPanelLeft)rectLeft=rectPanelLeft;if(rectBottom>=rectPanelBottom)rectBottom=rectPanelBottom-2;if(rectRight>=rectPanelRight)rectRight=rectPanelRight;let lineHeight=rectBottom-rectTop;let lineWidth=rectRight-rectLeft;grid.tbs_setSelectedLine(lineWidth,lineHeight,rectTop,rectBottom,rectLeft,rectRight)}else{let tableRows30=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');if(grid.tbs_getRowCount()==0)return;let startCell=grid.tbs_getFirstSelectedTableCell("panel30");let lastCell=grid.tbs_getLastSelectedTableCell("panel30");if(startCell==undefined||lastCell==undefined){grid.tbs_clearSelectedLine();return}let rectMain=document.querySelector(selector+" .tbs-grid-main").getBoundingClientRect();let rectTable31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").getBoundingClientRect();let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let startRect=startCell.getBoundingClientRect();let lastRect=lastCell.getBoundingClientRect();let rectTop=startRect.top-rectMain.top;let rectLeft=startRect.left-rectTable31.left;let rectBottom=lastRect.top-rectMain.top+lastRect.height;let rectRight=lastRect.left-rectTable31.left+lastRect.width;let rectPanelLeft=rectPanel30.left-rectTable31.left;let rectPanelBottom=rectPanel30.top-rectMain.top+rectPanel30.height;let rectPanelRight=rectPanel30.left-rectTable31.left+rectPanel30.width;if(rectLeft<=rectPanelLeft)rectLeft=rectPanelLeft;if(rectBottom>=rectPanelBottom)rectBottom=rectPanelBottom-2;if(rectRight>=rectPanelRight)rectRight=rectPanelRight;let lineHeight=rectBottom-rectTop;let lineWidth=rectRight-rectLeft;grid.tbs_setSelectedLine(lineWidth,lineHeight,rectTop,rectBottom,rectLeft,rectRight)}};TbsGrid.prototype.tbs_displayOneSelection=function(startRowIndex,startRowIndex,startCellIndex,startCellIndex){let selector="#"+this.gridId;let grid=this;let column=this.columns;this.startRowIndex=startRowIndex;this.lastRowIndex=startRowIndex;this.startCellIndex=startCellIndex;this.lastCellIndex=startCellIndex;this._startRowIndex=startRowIndex;this._lastRowIndex=startRowIndex;this._startCellIndex=startCellIndex;this._lastCellIndex=startCellIndex;this.tbs_setRangeValue(startRowIndex,startRowIndex,startCellIndex,startCellIndex);let count=this.data_view.length;let topRowIndex=this.tbs_getFirstRowIndex();let trLeftList=document.querySelectorAll(selector+" .tbs-grid-panel31  .tbs-grid-table tbody tr");let trFixLeftList=document.querySelectorAll(selector+" .tbs-grid-panel61   .tbs-grid-table tbody tr");let trContentList=document.querySelectorAll(selector+" .tbs-grid-panel30   .tbs-grid-table tbody tr");let trFixBottomtList=document.querySelectorAll(selector+" .tbs-grid-panel32 .tbs-grid-table tbody tr");let trFixRightList=document.querySelectorAll(selector+" .tbs-grid-panel60  .tbs-grid-table tbody tr");count=topRowIndex+this.pageRowCount;let contentRect=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let contentTableRect=document.querySelector(selector+" .tbs-grid-panel30 > table").getBoundingClientRect();let contentTableLeft=parseInt(document.querySelector(selector+" .tbs-grid-panel30 > table").style.left,10);let startColumnIndex=0;let lastColumnIndex=column.length-1;let accWidth=0;for(let i=0,len=column.length;i<len;i++){accWidth+=parseInt(column[i].width);if(accWidth+contentTableLeft>0){startColumnIndex=i;break}}accWidth=contentTableRect.width;for(let i=column.length-1;i>=0;i--){accWidth-=parseInt(column[i].width);if(accWidth+contentTableLeft<contentRect.width){lastColumnIndex=i;break}}let viewCount=this.data_view.length;let i=0;for(let ri=topRowIndex;ri<count;ri++){if(ri>viewCount-1)break;let trLeft=trLeftList[i];let trContent=trContentList[i];let trFixBottom=trFixBottomtList[i];let row=this.data_view[ri];leftTd=trLeft.childNodes[0];let selectedValue=this.tbs_isSelectedCell31(ri,0);if(selectedValue==1)leftTd.classList.add("tbs-grid-cell-select");for(let x=startColumnIndex;x<=lastColumnIndex;x++){let td=trContent.childNodes[x];let selectedValue=this.tbs_isSelectedCell30(ri,x);if(selectedValue==1){if(this.startRowIndex==ri&&this.startCellIndex==x){td.classList.add("tbs-grid-cell-start")}}}if(this.fixedColumnIndex!=-1){for(let x=0;x<=this.fixedColumnIndex;x++){let td=trFixBottom.childNodes[x];let selectedValue=this.tbs_isSelectedCell30(ri,x);if(selectedValue==1){if(this.startRowIndex==ri&&this.startCellIndex==x){td.classList.add("tbs-grid-cell-start")}}}}i+=1}if(this.fixedRowIndex!=-1){let i=0;for(let ri=0;ri<=this.fixedRowIndex;ri++){if(ri>viewCount-1)break;let trLeft=trFixLeftList[i];let trContent=trFixRightList[i];let row=this.data_view[ri];leftTd=trLeft.childNodes[0];leftTd.dataset.rowIndex=ri;let selectedValue=this.tbs_isSelectedCell31(ri,0);if(selectedValue==1)leftTd.classList.add("tbs-grid-cell-select");for(let x=startColumnIndex;x<=lastColumnIndex;x++){let td=trContent.childNodes[x];let selectedValue=this.tbs_isSelectedCell30(ri,x);if(selectedValue==1){if(this.startRowIndex==ri&&this.startCellIndex==x){td.classList.add("tbs-grid-cell-start")}}}}i+=1}this.tbs_displaySelectedLine()};TbsGrid.prototype.tbs_setDataTable1=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(panelName=="panel61"){if(grid.fixedRowIndex==-1)return}if(grid.fixedRowIndex!=-1){let topRowIndex=this.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=this.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=this.tbs_getPageRowCount(panelName);let rowHeight=this.rowHeight;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=this.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){if(i>this.tbs_getRowCount()-1)break;let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;let row=this.tbs_getRow(i);if(tableRow.style.display=="none")tableRow.style.display="";if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";this.tbs_setAlternativeRowColor(panelName,tableRow,i);let tableCell=tableRow.childNodes[0];tableCell.dataset.rowIndex=i;tableCell.dataset.displayRowIndex=i-(grid.fixedRowIndex+1);let selectedValue=this.tbs_isSelectedCell(panelName,i,0);if(selectedValue==1)tableCell.classList.add("tbs-grid-cell-select");if(tableCell.childNodes[0].textContent!=(i+1).toString())tableCell.childNodes[0].textContent=(i+1).toString();if(this.options[grid.option_rowMode])tableRow.childNodes[1].childNodes[0].textContent=row[grid.code_mode]!=""&&row[grid.code_mode]!="S"?row[grid.code_mode]:"";if(this.options[grid.option_checkbox])tableRow.childNodes[2].childNodes[0].childNodes[0].checked=row["check"]==undefined?false:row["check"];tableRowIndex+=1}this.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,this.pageRowCount)}else{let topRowIndex=this.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=this.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=this.tbs_getPageRowCount(panelName);let rowHeight=this.rowHeight;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=this.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){if(i>this.tbs_getRowCount()-1)break;let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;let row=this.tbs_getRow(i);if(tableRow.style.display=="none")tableRow.style.display="";if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";this.tbs_setAlternativeRowColor(panelName,tableRow,i);let tableCell=tableRow.childNodes[0];tableCell.dataset.rowIndex=i;tableCell.dataset.displayRowIndex=i;tableRow.childNodes[0].dataset.cellType="number";let selectedValue=this.tbs_isSelectedCell(panelName,i,0);if(selectedValue==1)tableCell.classList.add("tbs-grid-cell-select");if(grid.grid_mode==grid.module_paging){tableCell.childNodes[0].textContent=grid.classPage.startRowIndex+i+1}else{if(tableCell.childNodes[0].textContent!=(i+1).toString())tableCell.childNodes[0].textContent=(i+1).toString()}if(this.options[grid.option_rowMode]){tableRow.childNodes[1].childNodes[0].textContent=row[grid.code_mode]!=""&&row[grid.code_mode]!="S"?row[grid.code_mode]:"";tableRow.childNodes[1].dataset.cellType="mode"}if(this.options[grid.option_checkbox]){tableRow.childNodes[2].childNodes[0].childNodes[0].checked=row["check"]==undefined?false:row["check"];tableRow.childNodes[2].dataset.cellType="checkbox"}tableRowIndex+=1}this.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,this.pageRowCount)}};TbsGrid.prototype.tbs_setDataTable2=function(param){let selector="#"+this.gridId;let grid=this;if(this.fixedColumnIndex==-1)return;let panelName=param.panelName;let topRowIndex=this.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=this.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=this.tbs_getPageRowCount(panelName);let rowHeight=this.rowHeight;let columns=this.columns;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=this.tbs_getDisplayedHeaderColumn(panelName);let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;grid.tbs_setTableHead(panelName);let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){if(i>this.tbs_getRowCount()-1)break;let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;this.tbs_setAlternativeRowColor(panelName,tableRow,i);if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";let selectedValue=this.tbs_isSelectedCell(panelName,i,0);if(tableRow.style.display=="none")tableRow.style.display="";tableRow.dataset.rowIndex=i;for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(x>this.fixedColumnIndex&&x<startColumnIndex)continue;if(x<=this.fixedColumnIndex)tableCell=tableRow.childNodes[x];let column=this.columns[x];let columnName=column[grid.column_name];let colValue=this.tbs_getText(i,columnName);if(tableCell.style.textAlign!=column[grid.column_align])tableCell.style.textAlign=column[grid.column_align];if(tableCell.style.width!=column[grid.column_width]+"px")tableCell.style.width=column[grid.column_width]+"px";if(tableCell.style.backgroundImage!="")tableCell.style.backgroundImage="";if(tableCell.style.display!="")tableCell.style.display="";if(tableCell.rowSpan!="1")tableCell.rowSpan="1";tableCell.style.display=column[grid.column_visible]==true?"":"none";tableCell.rowSpan="1";let selectedValue=this.tbs_isSelectedCell(panelName,i,x);if(selectedValue==1){if(this.startRowIndex==i&&this.startCellIndex==x)tableCell.classList.add("tbs-grid-cell-start");else tableCell.classList.add("tbs-grid-cell-select")}if(tableCell.childNodes[0].textContent!=colValue)tableCell.childNodes[0].textContent=colValue}tableRowIndex+=1}this.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,this.pageRowCount)};TbsGrid.prototype.tbs_setDataTable3=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(panelName=="panel60"){if(grid.fixedRowIndex==-1)return}let topRowIndex=this.tbs_validateTopRowIndex(panelName,param.topRowIndex);let bottomRowIndex=this.tbs_validateBottomRowIndex(panelName,topRowIndex);let pageRowCount=this.tbs_getPageRowCount(panelName);let rowHeight=this.rowHeight;let columns=this.columns;grid.tbs_setTableHead(panelName);let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");let result=this.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;grid.tbs_setTableHead(panelName);let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";this.tbs_setAlternativeRowColor(panelName,tableRow,i);if(tableRow.style.display=="none")tableRow.style.display="";for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(this.fixedColumnIndex!=-1){if(x>this.fixedColumnIndex&&x<startColumnIndex)continue}else{if(x<startColumnIndex)continue}let column=grid.columns[x];let columnName=column[grid.column_name];let val=grid.tbs_getValue(i,columnName);let colValue=grid.tbs_getText(i,columnName);let className=grid.tbs_getColumnProperty(columnName,grid.column_className);if(grid.notNull(className))tableCell.classList.add(className);grid.tbs_setCellStyle(tableCell,"textAlign",column[grid.column_align]);grid.tbs_setCellStyle(tableCell,"width",column[grid.column_width]+"px");grid.tbs_setCellStyle(tableCell,"backgroundImage","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setCell(tableCell,"rowSpan","1");grid.tbs_setSelectedCell(panelName,tableCell,i,x);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",colValue)}for(let x=0;x<=lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];if(this.fixedColumnIndex!=-1&&x<=this.fixedColumnIndex)grid.tbs_setCellStyle(tableCell,"display","none")}tableRowIndex+=1}this.tbs_hiddenTableRows(panelName,tableRows,tableRowIndex,this.pageRowCount);if(param.panelName=="panel30"){let rowCount=this.tbs_getRowCount();if(grid.grid_mode==grid.module_paging)rowCount=grid.data_page.length;document.querySelector(selector+" .tbs-grid-panel21 td div").textContent=rowCount}};TbsGrid.prototype.tbs_setDataHeaderTable1=function(param){};TbsGrid.prototype.tbs_setDataHeaderTable2=function(param){};TbsGrid.prototype.tbs_setDataHeaderTable3=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;grid.tbs_setTableHead(panelName);let tablesRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");if(grid.fixedColumnIndex!=-1){for(let i=0,rowLen=tablesRows.length;i<rowLen;i++){let tableRow=tablesRows[i];tableRow.style.height=grid.headerRowHeight+"px";for(let x=0,colLen=grid.columns.length;x<colLen;x++){let header=grid.headerColumnTable[i][x];let cell=tableRow.childNodes[x];cell.style.textAlign=header[grid.column_align];cell.dataset.name=header[grid.column_kind]=="column"?header[grid.column_name]:"";cell.childNodes[0].childNodes[0].textContent=header[grid.column_text];if(x<=grid.fixedColumnIndex){cell.colSpan=header[grid.column_colSpan];cell.rowSpan=header[grid.column_rowSpan];cell.style.display="none"}else if(x==grid.fixedColumnIndex+1){cell.colSpan=header[grid.column_subColSpan];cell.rowSpan=header[grid.column_subRowSpan];cell.style.display=""}else{cell.colSpan=header[grid.column_colSpan];cell.rowSpan=header[grid.column_rowSpan];cell.style.display=header[grid.column_visible]==true?"":"none"}}}}else{for(let i=0,rowLen=tablesRows.length;i<rowLen;i++){let tableRow=tablesRows[i];tableRow.style.height=grid.headerRowHeight+"px";for(let x=0,colLen=grid.columns.length;x<colLen;x++){let column=grid.columns[x];let header=grid.headerColumnTable[i][x];let tableCell=tableRow.childNodes[x];let selectedValue=grid.tbs_isSelectedHeaderCell(panelName,x);if(selectedValue==1)tableCell.classList.add("tbs-grid-cell-select");let columnName=header[grid.column_name];tableCell.style.textAlign=header[grid.column_align];tableCell.dataset.name=header[grid.column_kind]=="column"?columnName:"";tableCell.colSpan=header[grid.column_colSpan];tableCell.rowSpan=header[grid.column_rowSpan];tableCell.style.display=header[grid.column_visible]==true?"":"none";if(header[grid.column_kind]=="column"){let className=grid.tbs_getHeaderProperty(columnName,grid.column_className);if(grid.notNull(className))tableCell.classList.add(className);tableCell.style.display=column[grid.column_visible]==true?"":"none"}tableCell.querySelector(".tbs-grid-cell-span-sort").textContent="";if(grid.tbs_isSortColumnName(columnName)&&header[grid.column_kind]=="column"){let sortColumn=grid.tbs_getSortColumn(columnName);let sortSymbol="";if(sortColumn["order"]=="desc")sortSymbol="â–¼";else if(sortColumn["order"]=="asc")sortSymbol="â–²";tableCell.querySelector(".tbs-grid-cell-span-sort").textContent=sortSymbol}tableCell.childNodes[0].childNodes[0].textContent=header[grid.column_text]}}}};TbsGrid.prototype.tbs_setDataTopTable1=function(){let selector="#"+this.gridId;let grid=this;let panelName="panel41";if(grid.topColumns.length==0)return;let topRowIndex=0;let bottomRowIndex=0;let pageRowCount=1;let rowHeight=this.rowHeight;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");if(tableRows.length==0)return;let result=this.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;if(tableRow.style.display=="none")tableRow.style.display="";if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";let tableCell=tableRow.childNodes[0];tableCell.dataset.rowIndex=i;tableCell.dataset.displayRowIndex=i;tableRow.childNodes[0].dataset.cellType="number";grid.tbs_setSelectedCell(panelName,tableCell,0,i)}};TbsGrid.prototype.tbs_setDataTopTable2=function(){let selector="#"+this.gridId;let grid=this;if(grid.topColumns.length==0)return;let panelName="panel42";let topColumns=grid.topColumns;let topRow=grid.data_top[0];let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableCells=document.querySelectorAll(selector+` .tbs-grid-panel42 .tbs-grid-cell`);let colList=document.querySelectorAll(selector+` .tbs-grid-panel42 thead th`);if(tableCells.length==0)return;for(let i=0;i<=lastColumnIndex;i++){let column=grid.columns[i];let columnName=column[grid.column_name];let tableCell=tableCells[i];colList[i].style.width=column[grid.column_width]+"px";grid.tbs_setSelectedCell(panelName,tableCell,0,i);for(let x=0,len2=topColumns.length;x<len2;x++){let topColumn=topColumns[x];if(columnName==topColumn[grid.column_name]){grid.tbs_addUserClass(tableCell,topColumn[grid.column_className]);grid.tbs_setCellStyle(tableCell,"textAlign",topColumn[grid.column_align]);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",grid.tbs_getTopText(0,columnName))}}}};TbsGrid.prototype.tbs_setDataTopTable3=function(){let selector="#"+this.gridId;let grid=this;if(grid.topColumns.length==0)return;let panelName="panel40";let topColumns=grid.topColumns;let topRow=grid.data_top[0];let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableCells=document.querySelectorAll(selector+` .tbs-grid-panel40 .tbs-grid-cell`);grid.tbs_setTableHead(panelName);for(let i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];let columnName=column[grid.column_name];let tableCell=tableCells[i];if(grid.fixedColumnIndex!=-1){if(i>grid.fixedColumnIndex&&i<startColumnIndex)continue}else{if(i<startColumnIndex)continue}grid.tbs_setSelectedCell(panelName,tableCell,0,i);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");for(let x=0,len2=topColumns.length;x<len2;x++){let topColumn=topColumns[x];if(columnName==topColumn[grid.column_name]){grid.tbs_addUserClass(tableCell,topColumn[grid.column_className]);grid.tbs_setCellStyle(tableCell,"textAlign",topColumn[grid.column_align]);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",grid.tbs_getTopText(0,columnName))}}}};TbsGrid.prototype.tbs_setDataFooterTable1=function(){let selector="#"+this.gridId;let grid=this;let panelName="panel51";if(grid.topColumns.length==0)return;let topRowIndex=0;let bottomRowIndex=0;let pageRowCount=1;let rowHeight=this.rowHeight;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table tbody tr");if(tableRows.length==0)return;let result=this.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableRowIndex=0;for(let i=topRowIndex;i<bottomRowIndex+1;i++){let tableRow=tableRows[tableRowIndex];tableRow.dataset.rowIndex=i;if(tableRow.style.display=="none")tableRow.style.display="";if(tableRow.style.height!=this.rowHeight+"px")tableRow.style.height=rowHeight+"px";let tableCell=tableRow.childNodes[0];tableCell.dataset.rowIndex=i;tableCell.dataset.displayRowIndex=i;tableRow.childNodes[0].dataset.cellType="number";grid.tbs_setSelectedCell(panelName,tableCell,0,i)}};TbsGrid.prototype.tbs_setDataFooterTable2=function(){let selector="#"+this.gridId;let grid=this;if(grid.topColumns.length==0)return;let panelName="panel52";let topColumns=grid.footerColumns;let topRow=grid.data_footer[0];let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableCells=document.querySelectorAll(selector+` .tbs-grid-panel52 .tbs-grid-cell`);let colList=document.querySelectorAll(selector+` .tbs-grid-panel52 thead th`);if(tableCells.length==0)return;for(let i=0;i<=lastColumnIndex;i++){let column=grid.columns[i];let columnName=column[grid.column_name];let tableCell=tableCells[i];colList[i].style.width=column[grid.column_width]+"px";grid.tbs_setSelectedCell(panelName,tableCell,0,i);for(let x=0,len2=topColumns.length;x<len2;x++){let topColumn=topColumns[x];if(columnName==topColumn[grid.column_name]){grid.tbs_addUserClass(tableCell,topColumn[grid.column_className]);grid.tbs_setCellStyle(tableCell,"textAlign",topColumn[grid.column_align]);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",grid.tbs_getTopText(0,columnName))}}}};TbsGrid.prototype.tbs_setDataFooterTable3=function(){let selector="#"+this.gridId;let grid=this;if(grid.footerColumns.length==0)return;let panelName="panel50";let footerColumns=grid.footerColumns;let footerRow=grid.data_footer[0];grid.tbs_setTableHead(panelName);let result=grid.tbs_getDisplayedHeaderColumn();let startColumnIndex=result.startColumnIndex;let lastColumnIndex=result.lastColumnIndex;let tableCells=document.querySelectorAll(selector+` .tbs-grid-panel50 .tbs-grid-cell`);grid.tbs_setTableHead(panelName);for(let i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];let columnName=column[grid.column_name];let tableCell=tableCells[i];if(grid.fixedColumnIndex!=-1){if(i>grid.fixedColumnIndex&&i<startColumnIndex)continue}else{if(i<startColumnIndex)continue}grid.tbs_setSelectedCell(panelName,tableCell,0,i);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent","");grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");for(let x=0,len2=footerColumns.length;x<len2;x++){let footerColumn=footerColumns[x];if(columnName==footerColumn[grid.column_name]){grid.tbs_addUserClass(tableCell,footerColumn[grid.column_className]);grid.tbs_setCellStyle(tableCell,"textAlign",footerColumn[grid.column_align]);let spanText=tableCell.querySelector(".tbs-grid-cell-div-text");grid.tbs_setCell(spanText,"textContent",grid.tbs_getFooterText(0,columnName))}}}};TbsGrid.prototype.tbs_setDataFilterTable=function(param){let selector="#"+this.gridId;let grid=this;grid.tbs_setDataFilterTableRow2(param)};TbsGrid.prototype.tbs_setDataFilterTableRow1=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(grid.options[grid.option_filterVisible]!=true)return;let tableCells=document.querySelectorAll(selector+` .tbs-grid-${panelName} .tbs-grid-cell`);let tableHeaders=document.querySelectorAll(selector+` .tbs-grid-${panelName} thead th`);for(let i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];let columnName=column[grid.column_name];let columnWidth=column[grid.column_width];tableHeaders[i].style.width=columnWidth+"px";let tableCell=tableCells[i];tableCell.childNodes[0].innerHTML="";let text=document.createElement("div");text.classList.add("tbs-grid-cell-filter-text");text.dataset.name=columnName;let input=document.createElement("input");input.classList.add("tbs-grid-cell-filter-input");input.dataset.name=columnName;input.style.width="100%";text.append(input);let icon=document.createElement("div");icon.classList.add("tbs-grid-cell-filter-icon");icon.style["backgroundImage"]="url("+grid.options[grid.option_imageRoot]+"filter_find.png)";icon.dataset.name=columnName;let cellDiv=tableCell.childNodes[0];cellDiv.append(text);cellDiv.append(icon)}grid.panel70_select()};TbsGrid.prototype.tbs_setDataFilterTableRow2=function(param){let selector="#"+this.gridId;let grid=this;let panelName=param.panelName;if(grid.options[grid.option_filterVisible]!=true)return;let tableRows=document.querySelectorAll(selector+` .tbs-grid-${panelName} .tbs-grid-table tbody tr`);let tableHeaders=document.querySelectorAll(selector+` .tbs-grid-${panelName} thead th`);grid.tbs_setTableHead(panelName);let tableCells=tableRows[0].querySelectorAll(".tbs-grid-cell");for(let x=0,len=grid.columns.length;x<len;x++){let column=grid.columns[x];let columnName=column[grid.column_name];let columnWidth=column[grid.column_width];tableHeaders[x].style.width=columnWidth+"px";let tableCell=tableCells[x];tableCell.childNodes[0].innerHTML="";grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");let combo=grid.tbs_createFilterCombo(column);combo.classList.add("tbs-grid-cell-filter-combo");combo.dataset.name=columnName;combo.style.width="100%";if(grid.tbs_isFilterColumnName(columnName)){let filterColumn=grid.tbs_getFilterColumn(columnName);combo.value=filterColumn[grid.const_filterType]}tableCell.childNodes[0].append(combo)}tableCells=tableRows[1].querySelectorAll(".tbs-grid-cell");for(let x=0,len=grid.columns.length;x<len;x++){let column=grid.columns[x];let columnName=column[grid.column_name];let columnWidth=column[grid.column_width];tableHeaders[x].style.width=columnWidth+"px";let tableCell=tableCells[x];tableCell.childNodes[0].innerHTML="";grid.tbs_setCellStyle(tableCell,"display",column[grid.column_visible]==true?"":"none");let input=document.createElement("input");input.classList.add("tbs-grid-cell-filter-input");input.dataset.name=columnName;input.style.width="100%";if(grid.tbs_isFilterColumnName(columnName)){let filterColumn=grid.tbs_getFilterColumn(columnName);input.value=filterColumn[grid.const_filterValue]}let cellDiv=tableCell.childNodes[0].append(input)}grid.panel70_select()};TbsGrid.prototype.tbs_setTableHead=function(panelName){let selector="#"+this.gridId;let grid=this;var tableHeads=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table thead th");for(var i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];if(grid.fixedColumnIndex!=-1){if(i<=grid.fixColIndex){grid.tbs_setCellStyle(tableCell,"width","0px");grid.tbs_setCellStyle(tableCell,"display","none")}}else{let tableHead=tableHeads[i];grid.tbs_setCellStyle(tableHead,"width",column[grid.column_visible]==true?parseInt(column[grid.column_width])+"px":"0px");grid.tbs_setCellStyle(tableHead,"display",column[grid.column_visible]==true?"":"none")}}};TbsGrid.prototype.tbs_setAlternativeRowColor=function(panelName,tableRow,rowIndex){return;tableRow.classList.remove("tbs-grid-tr-bg","tbs-grid-tr-bg2");if(rowIndex%2)tableRow.classList.add("tbs-grid-tr-bg2");else tableRow.classList.add("tbs-grid-tr-bg")};TbsGrid.prototype.tbs_hiddenTableRows=function(panelName,tableRows,fromRowIndex,toRowIndex){for(let i=fromRowIndex,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];if(tableRow){if(tableRow.style.display!="none")tableRow.style.display="none"}}};TbsGrid.prototype.tbs_setDataTableCellLine=function(panelName,tableCell,param,rowIndex,cellIndex){let selector="#"+this.gridId;let grid=this;let tableCellDiv=tableCell.childNodes[0];tableCellDiv.classList.remove(".tbs-grid-cell-line-top");tableCellDiv.classList.remove(".tbs-grid-cell-line-bottom");tableCellDiv.classList.remove(".tbs-grid-cell-line-left");tableCellDiv.classList.remove(".tbs-grid-cell-line-right");let selectedValueBefore=this.tbs_isSelectedCell(panelName,i,x);let selectedValue=this.tbs_isSelectedCell(panelName,i,x);let selectedValueAfter=this.tbs_isSelectedCell(panelName,i,x);if(selectedValue==1){if(rowIndex==this.startRowIndex&&cellIndex==this.startCellIndex)tableCell.classList.add("tbs-grid-cell-start");grid.tbs_isSelectedCell(panelName,i,x);tableCellDiv.classList.add(".tbs-grid-cell-line-top");tableCellDiv.classList.add(".tbs-grid-cell-line-bottom");tableCellDiv.classList.add(".tbs-grid-cell-line-left");tableCellDiv.classList.add(".tbs-grid-cell-line-right")}};TbsGrid.prototype.tbs_setSelectedCell=function(panelName,tableCell,rowIndex,cellIndex){let value=this.tbs_isSelectedCell(panelName,rowIndex,cellIndex);if(value==1){if(this.startRowIndex==rowIndex&&this.startCellIndex==cellIndex)tableCell.classList.add("tbs-grid-cell-start");else tableCell.classList.add("tbs-grid-cell-select")}};TbsGrid.prototype.tbs_setCell=function(tableCell,property,value){if(tableCell[property]!=value)tableCell[property]=value};TbsGrid.prototype.tbs_setCellStyle=function(tableCell,property,value){if(tableCell.style[property]!=value)tableCell.style[property]=value};TbsGrid.prototype.tbs_addUserClass=function(tableCell,className){this.tbs_removeUserClass(tableCell);if(this.notNull(className))tableCell.classList.add(className)};TbsGrid.prototype.tbs_removeUserClass=function(tableCell,className){let classNames=[];for(let i=0,len=tableCell.classList.length;i<len;i++){if(tableCell.classList[i].startsWith("tbs-"))continue;else result.push(tableCell.classList[i])}for(let i=0,len=classNames.length;i<len;i++)tableCell.classList.remove(className)};TbsGrid.prototype.tbs_createElementCellDiv=function(){let element=document.createElement("div");element.classList.add("tbs-grid-cell-div");return element};TbsGrid.prototype.tbs_createElementCellIcon=function(){let element=document.createElement("span");element.classList.add("tbs-grid-cell-div-icon");return element};TbsGrid.prototype.tbs_createElementCellImg=function(){let element=document.createElement("span");element.classList.add("tbs-grid-cell-div-img");return element};TbsGrid.prototype.tbs_createElementCellText=function(){let element=document.createElement("span");element.classList.add("tbs-grid-cell-div-text");element.textContent="";return element};TbsGrid.prototype.tbs_prependIcon=function(element,childElement){let el=element.querySelector(".tbs-grid-cell-div-icon");if(el==undefined)element.childNodes[0].prepend(childElement)};TbsGrid.prototype.tbs_prependImg=function(element,childElement){let el=element.querySelector(".tbs-grid-cell-div-img");if(el==undefined)element.childNodes[0].prepend(childElement)};TbsGrid.prototype.tbs_setValueInIcon=function(element,value){let el=element.querySelector(".tbs-grid-cell-div-icon");if(el==undefined){}};TbsGrid.prototype.tbs_setValueInImg=function(element,value){let el=element.querySelector(".tbs-grid-cell-div-img");if(el==undefined){}};TbsGrid.prototype.tbs_setValueInText=function(element,value){let el=element.querySelector(".tbs-grid-cell-div-text");if(el==undefined)el.textContent=value};TbsGrid.prototype.tbs_addEventAll=function(){let selector="#"+this.gridId;let grid=this;this.event_mobileTouchDrag();this.panel20_select();this.panel21_select();this.panel30_select("panel30");this.panel31_select("panel31");this.panel30_select("panel32");this.panel30_select("panel60");this.panel31_select("panel61");this.panel40_select("panel40");this.panel41_select("panel41");this.panel40_select("panel42");this.panel40_select("panel50");this.panel41_select("panel51");this.panel40_select("panel52");this.panel70_select();this.panel80_select();this.panel90_select();this.event_wheel();this.event_scrollButton();this.event_railClick();this.event_dragScrollBar();this.event_columnResize("panel20");this.event_columnResize("panel22");this.event_input();this.event_input_icon();this.event_checkBox();this.panel10_init();document.addEventListener("scroll",function(e){let panelInputList=document.querySelectorAll(selector+" .tbs-grid-panel-input");let inputList=document.querySelectorAll(selector+" .tbs-grid-input");let inputIconList=document.querySelectorAll(selector+" .tbs-grid-panel-input-icon");let inputPanelList=document.querySelectorAll(selector+" .tbs-grid-input-panel");for(let i=0;i<inputList.length;i++){let panelInput=panelInputList[i];let input=inputList[i];let input_icon=inputIconList[i];let input_panel=inputPanelList[i];input.value="";panelInput.style.left="30000px";panelInput.style.width="0px";input.dataset.rowIndex=-1;input.dataset.cellIndex=-1;input.dataset.mode="";input.dataset.type="";input_icon.style.display="none";input_icon.dataset.rowIndex=-1;input_icon.dataset.cellIndex=-1;input_icon.dataset.mode="";input_icon.dataset.type="";input_panel.innerHTML="";input_panel.style.width="0px";input_panel.style.left="30000px";input_panel.dataset.rowIndex=-1;input_panel.dataset.cellIndex=-1;input_panel.dataset.mode="";input_panel.dataset.type=""}});const bodyMouseDownEvent=function(e){let name=e.target.className;console.log("body: "+name);if(name.indexOf("tbs-grid-panel10-filter-input")==-1&&name.indexOf("tbs-grid-cell-filter-input")==-1&&name.indexOf("tbs-grid-input")==-1&&name.indexOf("tbs-grid-cell-filter-input")==-1&&(name.indexOf("tbs-grid-date")==-1&&name.indexOf("tbs-grid-combo")==-1)){let input=document.querySelector(selector+" .tbs-grid-input");grid.popupActive=0}};document.body.addEventListener("mousedown",bodyMouseDownEvent);const mouseDownGridEvent=function(e){let name=e.target.className;console.log("gird: "+name);e.stopPropagation();if(name.indexOf("tbs-grid-panel10-filter-input")!=-1||name.indexOf("tbs-grid-cell-filter-input")!=-1||name.indexOf("tbs-grid-layer")!=-1||name.indexOf("tbs-grid-cell-filter-input")!=-1){}else{document.querySelector(selector+" .tbs-grid-layer").style.width="0px";document.querySelector(selector+" .tbs-grid-layer").style.height="0px";document.querySelector(selector+" .tbs-grid-layer").style.left="30000px";document.querySelector(selector+" .tbs-grid-layer").style.display="none";grid.input_focus()}};document.querySelector(selector).addEventListener("mousedown",mouseDownGridEvent);const windowResizeEvent=function(e){e.stopPropagation();grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.verticalScroll.tbs_setScroll(grid.code_vertical);document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table").style.left=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").style.left;grid.tbs_removeRange(0,-1,0,-1);let topRowIndex=grid.tbs_getFirstRowIndex();grid.tbs_setRange(0,0,0,0);grid.tbs_displayPanel30(topRowIndex)};window.addEventListener("resize",windowResizeEvent)};TbsGrid.prototype.event_columnSort=function(cell){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(cell.dataset.name);let columnName=cell.dataset.name;if(cell==undefined)return false;let isSortable=grid.tbs_isSortableColumn(cell.dataset.name);if(!isSortable)return false;let sortDiv=cell.querySelector(".tbs-grid-cell-span-sort");let sortKind="";if(sortDiv.textContent=="â–¼"){sortKind=""}else if(sortDiv.textContent=="â–²"){sortKind="desc"}else{sortKind="asc"}if(sortKind=="asc"){sortDiv.textContent="â–²"}else if(sortKind=="desc"){sortDiv.textContent="â–¼"}else{sortDiv.textContent=""}if(grid.tbs_isSortColumnName(columnName)){let sortColumn=grid.tbs_getSortColumn(columnName);sortColumn[grid.column_order]=sortKind}else{let item={};item[grid.column_name]=columnName;item[grid.column_order]=sortKind;grid.classSort.sortColumns.push(item)}for(let i=grid.classSort.sortColumns.length-1;i>=0;i--){if(grid.classSort.sortColumns[i]["order"]==""){grid.classSort.sortColumns.splice(i,1)}}if(grid.classSort.sortColumns.length==0){grid.tbs_initSortData()}if(grid.options[grid.option_filterVisible])grid.tbs_filters();if(grid.grid_mode==grid.code_group){grid.tbs_setData(grid.data_view,null,false)}else{if(grid.tbs_isSortableColumn()){grid.tbs_setSortData(grid.data_view,grid.classSort.sortColumns);grid.tbs_removeRange(0,-1);grid.tbs_displayPanel30(0)}}};TbsGrid.prototype.event_mobileTouchDrag=function(){let selector="#"+this.gridId;let grid=this;let xWrap=document.querySelector(selector+" .tbs-grid-horizontal-scroll-wrap");let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let xPos={left:0,x:0};let yBar=document.querySelector(selector+" .tbs-grid-vertical-scroll-bar");let yPos={top:0,y:0};let actveTopRowIndex=-1;const touchStartEvent=function(e){e.preventDefault();document.body.style.overflow="hidden";actveTopRowIndex=-1;let col;if(e.target.tagName=="DIV"){col=e.target.parentNode}else if(e.target.tagName=="SPAN"){col=e.target.parentNode.parentNode}else{col=e.target}let rowIndex=grid.tbs_getRowIndexInTable(col.parentNode.rowIndex);yPos.top=Number(yBar.style.top.replace("px",""));yPos.y=e.changedTouches[0].clientY;xPos.left=Number(xBar.style.left.replace("px",""));xPos.x=e.changedTouches[0].clientX;document.querySelector(selector+" .tbs-grid-panel30").addEventListener("touchmove",touchMoveEvent);document.querySelector(selector+" .tbs-grid-panel30").addEventListener("touchend",touchEndEvent)};const touchMoveEvent=function(e){let xMove=e.changedTouches[0].clientX-xPos.x;let yMove=e.changedTouches[0].clientY-yPos.y;if(Math.abs(xMove)>Math.abs(yMove)){let left=xPos.left-xMove;let xRailWidth=xWrap.clientWidth-xBar.clientWidth;if(left<0)left=0;if(left>xRailWidth)left=xRailWidth;xBar.style.left=left.toString()+"px";let header=document.querySelector(selector+" .tbs-grid-panel20");let ratio=(header.childNodes[0].clientWidth-header.clientWidth)/xRailWidth;let nLeft=(left*-1*ratio).toString();grid.tbs_setContentPanelLeft(nLeft);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}else if(Math.abs(xMove)<Math.abs(yMove)){let yBarTop=yPos.top-yMove;if(yBarTop<0)yBarTop=0;if(yBarTop>this.verticalScroll.railSize)yBarTop=this.verticalScroll.railSize;let trTopIndex=Math.floor(yBarTop*this.verticalScroll.moveCount);actveTopRowIndex=trTopIndex;setTimeout(function(){if(actveTopRowIndex==trTopIndex)grid.tbs_setBarPosition(grid.code_vertical,trTopIndex)},1);setTimeout(function(){if(actveTopRowIndex==trTopIndex)grid.tbs_displayPanel30(trTopIndex)},5)}};const touchEndEvent=function(e){document.querySelector(selector+" .tbs-grid-panel30").removeEventListener("touchmove",touchMoveEvent);document.querySelector(selector+" .tbs-grid-panel30").removeEventListener("touchend",touchEndEvent);document.body.style.overflow="auto"}};TbsGrid.prototype.event_columnResize=function(panelName){let selector="#"+this.gridId;let grid=this;const createResizableColumn=function(tableCell,resizer){let startX=0;let movedWidth=0;let cellWidth=0;let tableWidth=0;let initWidth=[];let childList=[];let eventDetail=0;const mouseDownEvent=function(e){eventDetail=e.detail;if(eventDetail==1){e.stopPropagation();let isResizable=grid.tbs_isResizableColumn(tableCell.dataset.name);if(!isResizable)return;startX=window.pageXOffset+e.clientX;const style=window.getComputedStyle(tableCell);cellWidth=parseInt(style.width,10);tableWidth=parseInt(document.querySelector(selector+" .tbs-grid-"+panelName+" .tbs-grid-table").getBoundingClientRect().width);resizer.classList.add(".tbs-grid-cell-resizing");if(tableCell.dataset.name==""){let cellIndex=tableCell.cellIndex;let lastCellIndex=cellIndex+tableCell.colSpan;childList=[];initWidth=[];let thCells=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table thead th");for(let i=cellIndex;i<lastCellIndex;i++){let thCell=thCells[i];let width=parseInt(thCell.style.width,10);childList.push(i);initWidth.push(width)}}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)}else if(eventDetail==2){e.stopPropagation();if(grid.tbs_isClassName(e.target,"tbs-grid-cell-resize")!=true)return;let cell=e.target.parentElement;let columnName=grid.tbs_getColumnName(cell.cellIndex);let isAutoResizable=grid.tbs_isAutoResizableColumn(columnName);if(isAutoResizable!=true)return;let colIndex=cell.cellIndex+parseInt(cell.colSpan)-1;let column=grid.tbs_getColumn(columnName);let firstWidth=parseInt(column[grid.column_width]);let maxWidth=0;let canvas=document.querySelector(selector+" .tbs-grid-canvas").childNodes[0];let fontSize=grid.gridConfig.font.fontSize;let fontFamilty=grid.gridConfig.font.fontFamily;for(let i=0,len=grid.headerColumnTable.length;i<len;i++){let headerColumn=grid.headerColumnTable[i];if(headerColumn[colIndex][grid.column_kind]=="column"){let width=parseInt(grid.getTextWidth(canvas,headerColumn[colIndex][grid.column_text],fontSize,fontFamilty));if(width>=maxWidth)maxWidth=width}}for(let i=0,len=grid.data_view.length;i<len;i++){let val=grid.tbs_getText(i,columnName);let width=parseInt(grid.getTextWidth(canvas,val,fontSize,fontFamilty));if(width>=maxWidth)maxWidth=width}grid.tbs_setColumnWidth(colIndex,maxWidth+20);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}};const mouseMoveEvent=function(e){if(eventDetail==1){e.stopPropagation();movedWidth=e.clientX-startX;if(tableCell.dataset.name==""){let count=childList.length;let moveWidth=parseInt(movedWidth/count);for(let i=0,len=childList.length;i<len;i++){let cellIndex=childList[i];let nWidth=initWidth[i]+moveWidth<10?10:initWidth[i]+moveWidth+"px";grid.tbs_setColumnWidth(cellIndex,nWidth)}grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}else{let cellIndex=tableCell.cellIndex;let nWidth=(cellWidth+movedWidth<10?10:cellWidth+movedWidth)+"px";grid.tbs_setColumnWidth(cellIndex,nWidth);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}}};const mouseUpEvent=function(e){if(eventDetail==1){e.stopPropagation();resizer.classList.remove(".tbs-grid-cell-resizing");document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}};resizer.addEventListener("mousedown",mouseDownEvent,false)};const tablesCells=document.querySelectorAll(selector+" .tbs-grid-"+panelName+" .tbs-grid-table td");[].forEach.call(tablesCells,function(tableCell){let resizer=tableCell.querySelector(".tbs-grid-cell-resize");if(resizer)createResizableColumn(tableCell,resizer)})};TbsGrid.prototype.event_checkBox=function(){let selector="#"+this.gridId;let grid=this;const checkDowntEvent=function(e){if(e.target.tagName=="INPUT"){let tr=e.target.parentNode.parentNode.parentNode;let rowIndex=parseInt(tr.childNodes[0].childNodes[0].textContent)-1;if(e.target.checked)grid.data_view[rowIndex].check=false;else grid.data_view[rowIndex].check=true}};document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").addEventListener("mousedown",checkDowntEvent,false)};TbsGrid.prototype.tbs_moveCellLine=function(cell,rowIndex,cellIndex){let selector="#"+this.gridId;let grid=this;let input=document.querySelector(selector+" .tbs-grid-input");let cellRect=cell.getBoundingClientRect();let content=document.querySelector(selector+" .tbs-grid-panel30");let contentRect=content.getBoundingClientRect();let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");if(cellRect.left<contentRect.left){grid.value=contentRect.left-cellRect.left;grid.tbs_setContentPanelLeftMove(value);grid.tbs_setBarPosition(grid.code_horizontal)}else if(cellRect.right>contentRect.right){let value=contentRect.right-cellRect.right;grid.tbs_setContentPanelLeftMove(value);grid.tbs_setBarPosition(grid.code_horizontal)}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(rowIndex,rowIndex,cellIndex,cellIndex)};TbsGrid.prototype.tbs_clickPageFirst=function(e,grid,pageIndex,selectedPageCount,userFunction){let val=userFunction(e,grid,pageIndex,selectedPageCount);return val};TbsGrid.prototype.tbs_clickPagePrev=function(e,grid,pageIndex,selectedPageCount,userFunction){let val=userFunction(e,grid,pageIndex,selectedPageCount);return val};TbsGrid.prototype.tbs_clickPageIndex=function(e,grid,pageIndex,selectedPageCount,userFunction){let val=userFunction(e,grid,pageIndex,selectedPageCount);return val};TbsGrid.prototype.tbs_clickPageNext=function(e,grid,pageIndex,selectedPageCount,userFunction){let val=userFunction(e,grid,pageIndex,selectedPageCount);return val};TbsGrid.prototype.tbs_clickPageLast=function(e,grid,pageIndex,selectedPageCount,userFunction){let val=userFunction(e,grid,pageIndex,selectedPageCount);return val};TbsGrid.prototype.tbs_isMovedPositionInConstRange=function(startX,startY,lastX,lastY){let movedX=Math.abs(startX-lastX);let movedY=Math.abs(startY-lastY);return movedX<this.grid_mousePointRange&&movedY<this.grid_mousePointRange};TbsGrid.prototype.tbs_executeEvent=function(isUserFunction,eventType,param){let selector="#"+this.gridId;let grid=this;let e=param.e;let mode=param.mode;let rowIndex=param.rowIndex;let cellIndex=param.cellIndex;let column=grid.tbs_getColumnByIndex(cellIndex);let columnName=grid.tbs_getColumnName(cellIndex);let value=grid.tbs_getValue(rowIndex,columnName);let text=grid.tbs_getText(rowIndex,columnName);let eventData={};let eventRow=grid.tbs_getRow(rowIndex);eventRow.rowIndex=rowIndex;eventRow.columnIndex=cellIndex;eventRow.columnName=columnName;eventRow.value=value;eventRow.text=text;eventRow.data=eventRow;if(isUserFunction){if(eventType=="click"){if(grid.notNull(grid.user_click)){let flag=grid.tbs_click(e,grid,eventRow,grid.user_click)}}else if(eventType=="dblclick"){if(grid.notNull(grid.user_dblclick)){let flag=grid.tbs_dblclick(e,grid,eventRow,grid.user_dblclick)}}}};TbsGrid.prototype.tbs_getMaxRowIndexByMouseMove=function(){let selector="#"+this.gridId;let grid=this;let maxRowIndex;const rowIndexArray=[];let num;if(grid.fixedRowIndex!=-1&&grid.fixedColumnIndex!=-1){num=grid.tbs_getMaxRowIndexByMouseMove2("panel62");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxRowIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxRowIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxRowIndex=Math.max(...rowIndexArray)}else if(grid.fixedRowIndex!=-1){num=grid.tbs_getMaxRowIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxRowIndex=Math.max(...rowIndexArray)}else if(grid.fixedColumnIndex!=-1){num=grid.tbs_getMaxRowIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxRowIndex=Math.max(...rowIndexArray)}else{maxRowIndex=grid.tbs_getMaxRowIndexByMouseMove2("panel30")}return maxRowIndex};TbsGrid.prototype.tbs_getMinRowIndexByMouseMove=function(){let selector="#"+this.gridId;let grid=this;let minRowIndex;const rowIndexArray=[];let num;if(grid.fixedRowIndex!=-1&&grid.fixedColumnIndex!=-1){num=grid.tbs_getMinRowIndexByMouseMove2("panel62");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinRowIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinRowIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);minRowIndex=Math.min(...rowIndexArray)}else if(grid.fixedRowIndex!=-1){num=grid.tbs_getMinRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinRowIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);minRowIndex=Math.min(...rowIndexArray)}else if(grid.fixedColumnIndex!=-1){num=grid.tbs_getMinRowIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinRowIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);minRowIndex=Math.min(...rowIndexArray)}else{minRowIndex=grid.tbs_getMinRowIndexByMouseMove2("panel30")}return minRowIndex};TbsGrid.prototype.tbs_getMaxCellIndexByMouseMove=function(){let selector="#"+this.gridId;let grid=this;let maxCellIndex,num;const rowIndexArray=[];if(grid.fixedRowIndex!=-1&&grid.fixedColumnIndex!=-1){num=grid.tbs_getMaxCellIndexByMouseMove2("panel62");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxCellIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxCellIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxCellIndex=Math.max(...rowIndexArray)}else if(grid.fixedRowIndex!=-1){num=grid.tbs_getMaxCellIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxCellIndex=Math.max(...rowIndexArray)}else if(grid.fixedColumnIndex!=-1){num=grid.tbs_getMaxCellIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMaxCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);maxCellIndex=Math.max(...rowIndexArray)}else{maxCellIndex=grid.tbs_getMaxCellIndexByMouseMove2("panel30")}return maxCellIndex};TbsGrid.prototype.tbs_getMinCellIndexByMouseMove=function(){let selector="#"+this.gridId;let grid=this;let minCellIndex;const rowIndexArray=[];if(grid.fixedRowIndex!=-1&&grid.fixedColumnIndex!=-1){num=grid.tbs_getMinCellIndexByMouseMove2("panel62");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinCellIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinCellIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else if(grid.fixedRowIndex!=-1){num=grid.tbs_getMinCellIndexByMouseMove2("panel60");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else if(grid.fixedColumnIndex!=-1){num=grid.tbs_getMinCellIndexByMouseMove2("panel30");if(num!=undefined)rowIndexArray.push(num);num=grid.tbs_getMinCellIndexByMouseMove2("panel32");if(num!=undefined)rowIndexArray.push(num);minCellIndex=Math.min(...rowIndexArray)}else{minCellIndex=grid.tbs_getMinCellIndexByMouseMove2("panel30")}return minCellIndex};TbsGrid.prototype.tbs_getMaxRowIndexByMouseMove2=function(panelName){let selector="#"+this.gridId;let grid=this;let lastY=this.lastY;let maxRowIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let len=tableRows?tableRows.length:0;let startRowIndex,lastRowIndex;if(grid.fixedRowIndex!=-1){if(panelName=="panel60"){startRowIndex=0;lastRowIndex=this.fixedRowIndex}else if(panelName=="panel30"){startRowIndex=0;lastRowIndex=len-1}}else{startRowIndex=0;lastRowIndex=len-1}for(let i=startRowIndex;i<lastRowIndex+1;i++){let tableRow=tableRows[i];let tableRowIndex=i+1;let rect=grid.tbs_getOffset(tableRow);let top=rect.top;if(lastY>top)maxRowIndex=grid.tbs_getRowIndexInTable(tableRowIndex,panelName)}return maxRowIndex};TbsGrid.prototype.tbs_getMinRowIndexByMouseMove2=function(panelName){let selector="#"+this.gridId;let grid=this;let lastY=this.lastY;let minRowIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let len=tableRows?tableRows.length:0;let startRowIndex,lastRowIndex;if(grid.fixedRowIndex!=-1){if(panelName=="panel60"){startRowIndex=0;lastRowIndex=this.fixedRowIndex}else if(panelName=="panel30"){startRowIndex=0;lastRowIndex=len-1}}else{startRowIndex=0;lastRowIndex=len-1}for(let i=lastRowIndex;i>=startRowIndex;i--){let tableRow=tableRows[i];let tableRowIndex=i+1;let rect=grid.tbs_getOffset(tableRow);let bottom=rect.top+tableRow.getBoundingClientRect().height;if(lastY<bottom)minRowIndex=grid.tbs_getRowIndexInTable(tableRowIndex,panelName)}return minRowIndex};TbsGrid.prototype.tbs_getMaxCellIndexByMouseMove2=function(panelName){let selector="#"+this.gridId;let grid=this;let lastX=this.lastX;let maxCellIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRow=tableRows[0];let len=tableRow&&tableRow.childNodes?tableRow.childNodes.length:0;let startColumnIndex,lastColumnIndex;if(grid.fixedColumnIndex!=-1){if(panelName=="panel32"){startColumnIndex=0;lastColumnIndex=this.fixedColumnIndex+1}else if(panelName=="panel30"){startColumnIndex=this.fixedColumnIndex+1;lastColumnIndex=len}}else{startColumnIndex=0;lastColumnIndex=len}for(let x=startColumnIndex;x<lastColumnIndex;x++){let tableCell=tableRow.childNodes[x];let column=grid.columns[x];if(column[grid.column_visible]==false)continue;let rect=grid.tbs_getOffset(tableCell);let rectLeft=rect.left;if(lastX>rectLeft)maxCellIndex=tableCell.cellIndex}return maxCellIndex};TbsGrid.prototype.tbs_getMinCellIndexByMouseMove2=function(panelName){let selector="#"+this.gridId;let grid=this;let lastX=this.lastX;let minCellIndex;let tableRows=document.querySelectorAll(selector+" .tbs-grid-"+panelName+' .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRow=tableRows[0];let len=tableRow&&tableRow.childNodes?tableRow.childNodes.length:0;let startColumnIndex,lastColumnIndex;if(grid.fixedColumnIndex!=-1){if(panelName=="panel32"){startColumnIndex=0;lastColumnIndex=this.fixedColumnIndex}else if(panelName=="panel30"){startColumnIndex=this.fixedColumnIndex+1;lastColumnIndex=len-1}}else{startColumnIndex=0;lastColumnIndex=len-1}for(let x=lastColumnIndex;x>=startColumnIndex;x--){let tableCell=tableRow.childNodes[x];let column=grid.columns[x];if(column[grid.column_visible]==false)continue;let rect=grid.tbs_getOffset(tableCell);let rectRight=rect.left+tableCell.getBoundingClientRect().width;if(lastX<rectRight)minCellIndex=tableCell.cellIndex}return minCellIndex};TbsGrid.prototype.tbs_getOffset=function(el){let _x=0;let _y=0;while(el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop)){_x+=el.offsetLeft-el.scrollLeft;_y+=el.offsetTop-el.scrollTop;el=el.offsetParent}return{top:_y,left:_x}};TbsGrid.prototype.tbs_moveNextRowCell=function(type){let selector="#"+this.gridId;let grid=this;let rowIndex=-1;let cellIndex=-1;let trList=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display:"])');let td=document.querySelector(selector+" .tbs-grid-cell-start");if(td==null)return;let tableRowIndex=parseInt(td.parentNode.rowIndex);let dataRowIndex=this.tbs_getRowIndexInTable(tableRowIndex);cellIndex=td.cellIndex;if(cellIndex==this.columns.length-1&&dataRowIndex<this.data_view.length-1){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex+1,dataRowIndex+1,0,0);let topRowIndex=this.tbs_getFirstRowIndex();let lastRowIndex=this.tbs_getLastRowIndex();let movedLeft=grid.tbs_getContentPanelLeft(0);grid.tbs_setContentPanelLeft(movedLeft);if(dataRowIndex==lastRowIndex-1)this.tbs_displayPanel30(topRowIndex+1);let input=document.querySelector(selector+" .tbs-grid-input");this.input_focus()}else{this.tbs_moveCell(type);let topRowIndex=this.tbs_getFirstRowIndex();let movedLeft=grid.tbs_getContentPanelLeft(0);grid.tbs_setContentPanelLeft(movedLeft);grid.tbs_setBarPosition(grid.code_vertical,topRowIndex);let input=document.querySelector(selector+" .tbs-grid-input");this.input_focus()}};TbsGrid.prototype.tbs_moveCell=function(type){let selector="#"+this.gridId;let grid=this;let cellIndex=-1;let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableRowIndex,dataRowIndex;let tableCell=document.querySelector(selector+" .tbs-grid-cell-start");if(grid.null(tableCell))return;tableRowIndex=parseInt(tableCell.parentNode.rowIndex);dataRowIndex=parseInt(tableCell.parentNode.dataset.rowIndex);cellIndex=tableCell.cellIndex;if(type=="left"){let startCellIndex=cellIndex;cellIndex=cellIndex-1;for(let i=cellIndex;i>=0;i--){let column=this.columns[i];if(column[grid.column_visible]==false)cellIndex-=1;else break}if(cellIndex<0||this.columns[cellIndex][grid.column_visible]==false){grid.tbs_removeRange(0,-1);grid.tbs_selectRange(dataRowIndex,dataRowIndex,startCellIndex,startCellIndex);return}let tableRow=tableRows[tableRowIndex-1];let left1=window.pageYOffset+tableRow.childNodes[cellIndex].getBoundingClientRect().left;let divContent=document.querySelector(selector+" .tbs-grid-panel30");let left2=window.pageYOffset+divContent.getBoundingClientRect().left;if(left1<left2){let moveWidth=left2-left1;let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let table30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let hiddenSize=this.horizontalScroll.hiddenSize;let curLeft=Math.abs(parseInt(table20.style.left.replace("px","")));let sLeft;if(curLeft-moveWidth<0)sLeft=0+"px";else sLeft=-1*curLeft+moveWidth+"px";grid.tbs_setContentPanelLeft(sLeft);grid.tbs_setBarPosition(grid.code_horizontal)}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else if(type=="right"){let startCellIndex=cellIndex;cellIndex=cellIndex+1;for(let i=cellIndex,len=this.columns.length;i<len;i++){let column=this.columns[i];if(column[grid.column_visible]==false)cellIndex+=1;else break}if(cellIndex>=this.columns.length)cellIndex=startCellIndex;let tableRow=tableRows[tableRowIndex-1];let right1=window.pageYOffset+tableRow.childNodes[cellIndex].getBoundingClientRect().right;let panel30=document.querySelector(selector+" .tbs-grid-panel30");let right2=window.pageYOffset+panel30.getBoundingClientRect().right;if(right1>right2){let moveWidth=right1-right2;let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let hiddenSize=this.horizontalScroll.hiddenSize;let curLeft=Math.abs(parseInt(table20.style.left.replace("px","")));let sLeft;if(curLeft+moveWidth>hiddenSize)sLeft=-1*hiddenSize+"px";else sLeft=table20.style.left.replace("px","")-moveWidth+"px";grid.tbs_setContentPanelLeft(sLeft);grid.tbs_setBarPosition(grid.code_horizontal)}this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else if(type=="up"){if(this.fixedRowIndex!=-1){dataRowIndex-=1;let topRowIndex=this.tbs_getFirstRowIndex();if(dataRowIndex<=this.fixedRowIndex)topRowIndex=this.fixedRowIndex+1;if(topRowIndex<0)topRowIndex=0;if(dataRowIndex<0)dataRowIndex=0;if(dataRowIndex>=topRowIndex){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else if(dataRowIndex<topRowIndex&&dataRowIndex==topRowIndex-1){this.tbs_removeRange(0,-1);let rowIndex=this.tbs_setBarPositionByDirection("up");this.tbs_displayOneSelection(rowIndex,rowIndex,cellIndex,cellIndex)}else{this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}else{dataRowIndex-=1;let topRowIndex=this.tbs_getFirstRowIndex();if(topRowIndex<0)topRowIndex=0;if(dataRowIndex<0)dataRowIndex=0;if(topRowIndex<=dataRowIndex){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{this.tbs_removeRange(0,-1);let rowIndex=this.tbs_setBarPositionByDirection("up");this.tbs_displayOneSelection(rowIndex,rowIndex,cellIndex,cellIndex)}}}else if(type=="down"){let topRowIndex=this.tbs_getFirstRowIndex();let lastRowIndex=this.tbs_getLastRowIndex();if(grid.fixedRowIndex!=-1&&dataRowIndex==grid.fixedRowIndex){dataRowIndex+=1;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex,dataRowIndex);grid.tbs_setBarPosition(grid.code_vertical,dataRowIndex);return}if(this.pageRowCount>this.pageIntRowCount){if(tableRows.length==this.pageRowCount){if(dataRowIndex==lastRowIndex){if(dataRowIndex==this.data_view.length-1){this.tbs_removeRange(0,-1);this.tbs_setBarPositionByDirection("down",topRowIndex+1);this.tbs_displayOneSelection(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_setBarPositionByDirection("down",topRowIndex+2);this.tbs_displayOneSelection(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}else if(dataRowIndex==lastRowIndex-1){dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_setBarPositionByDirection("down",topRowIndex+1);this.tbs_displayOneSelection(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}else{if(dataRowIndex==lastRowIndex){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}}else{if(tableRows.length==this.pageRowCount){if(dataRowIndex==lastRowIndex){if(dataRowIndex==this.data_view.length-1){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_setBarPositionByDirection("down");this.tbs_displayOneSelection(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}else{if(dataRowIndex==lastRowIndex){this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}else{dataRowIndex+=1;this.tbs_removeRange(0,-1);this.tbs_selectRange(dataRowIndex,dataRowIndex,cellIndex,cellIndex)}}}}};TbsGrid.prototype.event_wheel=function(){let selector="#"+this.gridId;let grid=this;let xScroll=document.querySelector(selector+" .tbs-grid-horizontal-scroll");let yScroll=document.querySelector(selector+" .tbs-grid-vertical-scroll");const mouseWheelEvent=function(e){grid.tbs_editEnd();if(yScroll.style.display==""){if(e.deltaY>0){e.preventDefault();e.returnValue=false;grid.tbs_setBarPositionByDirection("down")}if(e.deltaY<0){e.preventDefault();e.returnValue=false;grid.tbs_setBarPositionByDirection("up")}}else if(xScroll.style.display==""){if(e.deltaY>0){e.preventDefault();e.returnValue=false}if(e.deltaY<0){e.preventDefault();e.returnValue=false}}};document.querySelector(selector).addEventListener("wheel",mouseWheelEvent)};TbsGrid.prototype.event_scrollButton=function(){let selector="#"+this.gridId;let grid=this;let leftButton=document.querySelector(selector+" .tbs-grid-horizontal-scroll .tbs-grid-horizontal-scroll-left");let rightButton=document.querySelector(selector+" .tbs-grid-horizontal-scroll .tbs-grid-horizontal-scroll-right");let upButton=document.querySelector(selector+" .tbs-grid-vertical-scroll .tbs-grid-vertical-scroll-up");let downButton=document.querySelector(selector+" .tbs-grid-vertical-scroll .tbs-grid-vertical-scroll-down");let flag=false;const leftButtonMouseDownEvent=function(e){document.addEventListener("mouseup",leftButtonMouseUpEvent);flag=true;doInterval("left")};const leftButtonMouseUpEvent=function(e){flag=false;document.removeEventListener("mouseup",leftButtonMouseUpEvent)};const rightButtonMouseDownEvent=function(e){document.addEventListener("mouseup",rightButtonMouseUpEvent);flag=true;doInterval("right")};const rightButtonMouseUpEvent=function(e){flag=false;document.removeEventListener("mouseup",rightButtonMouseUpEvent)};const upButtonMouseDownEvent=function(e){document.addEventListener("mouseup",upButtonMouseUpEvent);flag=true;doInterval("up")};const upButtonMouseUpEvent=function(e){flag=false;document.removeEventListener("mouseup",upButtonMouseUpEvent)};const downButtonMouseDownEvent=function(e){document.addEventListener("mouseup",downButtonMouseUpEvent);flag=true;doInterval("down")};const downButtonMouseUpEvent=function(e){flag=false;document.removeEventListener("mouseup",downButtonMouseUpEvent)};leftButton.addEventListener("mousedown",leftButtonMouseDownEvent);rightButton.addEventListener("mousedown",rightButtonMouseDownEvent);upButton.addEventListener("mousedown",upButtonMouseDownEvent);downButton.addEventListener("mousedown",downButtonMouseDownEvent);function doInterval(type){if(flag){setTimeout(function(){doInterval(type)},500);grid.tbs_setBarPositionByDirection(type)}}};TbsGrid.prototype.event_railClick=function(){let selector="#"+this.gridId;let grid=this;const xWrapClickEvent=function(e){let bar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let left=parseInt(bar.style.left.replace("px",""));if(isNaN(left))left=0;let barSize=grid.horizontalScroll.barSize;if(e.offsetX>=left&&e.offsetX<=left+barSize)return;if(e.target.className!="tbs-grid-horizontal-scroll-bar"){if(e.offsetX>left){let move=e.offsetX-(left+barSize);bar.style.left=left+move+"px"}if(e.offsetX<left){let move=e.offsetX;bar.style.left=e.offsetX+"px"}let movedLeft=grid.tbs_getContentPanelLeft(bar.style.left);grid.tbs_setContentPanelLeft(movedLeft);grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}};const yWrapClickEvent=function(e){let bar=document.querySelector(selector+" .tbs-grid-vertical-scroll-bar");let top=bar.style.top!=""?parseInt(bar.style.top,10):0;let barSize=grid.verticalScroll.barSize;if(e.offsetY>=top&&e.offsetY<=top+barSize)return;if(e.target.className!="tbs-grid-vertical-scroll-bar"){if(e.offsetY>top){let move=e.offsetY-(top+barSize);bar.style.top=top+move+"px"}else if(e.offsetY<top){let move=e.offsetY;bar.style.top=e.offsetY+"px"}e=null;let moveCount=grid.verticalScroll.moveCount;let trTopIndex=Math.ceil(parseInt(bar.style.top,10)*moveCount);bar=null;grid.tbs_displayPanel30(trTopIndex)}};document.querySelector(selector+" .tbs-grid-horizontal-scroll .tbs-grid-horizontal-scroll-wrap").addEventListener("click",xWrapClickEvent);document.querySelector(selector+" .tbs-grid-vertical-scroll   .tbs-grid-vertical-scroll-wrap").addEventListener("click",yWrapClickEvent)};TbsGrid.prototype.event_dragScrollBar=function(){let selector="#"+this.gridId;let grid=this;let xWrap=document.querySelector(selector+" .tbs-grid-horizontal-scroll-wrap");let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let xPos={left:0,x:0};const xMouseDownEvent=function(e){grid.tbs_editEnd();e.stopPropagation();if(e.target.className!="tbs-grid-horizontal-scroll-bar")return;xPos.left=Number(xBar.style.left.replace("px",""));xPos.x=e.clientX;document.addEventListener("mousemove",xMouseMoveEvent);document.addEventListener("mouseup",xMouseUpEvent)};const xMouseMoveEvent=function(e){let xMove=e.clientX-xPos.x;let left=xPos.left+xMove;let xRailWidth=xWrap.clientWidth-xBar.clientWidth;if(left<0)left=0;if(left>xRailWidth)left=xRailWidth;xBar.style.left=left.toString()+"px";let header=document.querySelector(selector+" .tbs-grid-panel20");let content=document.querySelector(selector+" .tbs-grid-panel30");let sum=document.querySelector(selector+" .tbs-grid-panel40");let footer=document.querySelector(selector+" .tbs-grid-panel50");let ratio=(header.childNodes[0].clientWidth-header.clientWidth)/xRailWidth;grid.tbs_setContentPanelLeft((left*-1*ratio).toString());grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())};const xMouseUpEvent=function(e){document.removeEventListener("mousemove",xMouseMoveEvent);document.removeEventListener("mouseup",xMouseUpEvent)};xBar.addEventListener("mousedown",xMouseDownEvent,false);let yBar=document.querySelector(selector+" .tbs-grid-vertical-scroll-bar");let yPos={top:0,y:0};let actveTopRowIndex=-1;const yMouseDownEvent=function(e){grid.tbs_editEnd();e.stopPropagation();actveTopRowIndex=-1;if(e.target.className!="tbs-grid-vertical-scroll-bar")return;yPos.top=Number(yBar.style.top.replace("px",""));yPos.y=e.clientY;document.addEventListener("mousemove",yMouseMoveEvent);document.addEventListener("mouseup",yMouseUpEvent)};const yMouseMoveEvent=function(e){let yBarTop=yPos.top+e.clientY-yPos.y;if(yBarTop<0)yBarTop=0;if(yBarTop>grid.verticalScroll.railSize)yBarTop=grid.verticalScroll.railSize;let displayTopRowIndex=Math.floor(yBarTop*grid.verticalScroll.moveCount);actveTopRowIndex=displayTopRowIndex;let topRowIndex=displayTopRowIndex;if(grid.fixedRowIndex!=-1)topRowIndex=displayTopRowIndex+grid.fixedRowIndex+1;setTimeout(function(){grid.tbs_setBarPosition(grid.code_vertical,displayTopRowIndex)},1);setTimeout(function(){grid.tbs_displayPanel30(topRowIndex)},5)};const yMouseUpEvent=function(e){e.stopPropagation();document.removeEventListener("mousemove",yMouseMoveEvent);document.removeEventListener("mouseup",yMouseUpEvent)};yBar.addEventListener("mousedown",yMouseDownEvent,false)};TbsGrid.prototype.panel10_init=function(){let selector="#"+this.gridId;let grid=this;const showFilterPanelEvent=function(e){e.stopPropagation();if(grid.options[grid.option_filterVisible]==false){grid.tbs_showFilterPanel()}else{grid.tbs_hideFilterPanel()}};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-filter"))document.querySelector(selector+" .tbs-grid-panel10-buttons-filter").addEventListener("mousedown",showFilterPanelEvent);const resetFilterPanelEvent=function(e){e.stopPropagation();grid.tbs_initFilterData()};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-filter-reset"))document.querySelector(selector+" .tbs-grid-panel10-buttons-filter-reset").addEventListener("mousedown",resetFilterPanelEvent);const showSortPanelEvent=function(e){e.stopPropagation();if(grid.options[grid.option_sortVisible]==false){grid.tbs_showSortPanel()}else{grid.tbs_hideSortPanel()}};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-sort"))document.querySelector(selector+" .tbs-grid-panel10-buttons-sort").addEventListener("mousedown",showSortPanelEvent);const resetSortPanelEvent=function(e){e.stopPropagation();grid.tbs_initSortData()};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-sort-reset"))document.querySelector(selector+" .tbs-grid-panel10-buttons-sort-reset").addEventListener("mousedown",resetSortPanelEvent);const showGroupPanelEvent=function(e){e.stopPropagation();if(grid.grid_mode!=grid.code_group){grid.tbs_allowGroupMode()}else{if(grid.options[grid.option_groupVisible]==true)grid.tbs_denyGroupMode();else grid.tbs_allowGroupMode()}};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-group"))document.querySelector(selector+" .tbs-grid-panel10-buttons-group").addEventListener("mousedown",showGroupPanelEvent);const resetGroupPanelEvent=function(e){e.stopPropagation();if(grid.grid_mode==grid.code_group){grid.tbs_initGroupData()}};if(document.querySelector(selector+" .tbs-grid-panel10-buttons-group-reset"))document.querySelector(selector+" .tbs-grid-panel10-buttons-group-reset").addEventListener("mousedown",resetGroupPanelEvent);const setTotalFilterEvent=function(e){e.stopPropagation();grid.totalFilterSearch(this.value)};if(document.querySelector(selector+" .tbs-grid-panel10-filter-input"))document.querySelector(selector+" .tbs-grid-panel10-filter-input").addEventListener("keyup",setTotalFilterEvent);const firstEvent=function(e){e.stopPropagation();grid.classPage.pageIndex=1;grid.tbs_displayPanel30(0)};if(document.querySelector(selector+" .tbs-grid-panel10-page-first"))document.querySelector(selector+" .tbs-grid-panel10-page-first").addEventListener("mousedown",firstEvent);const prevEvent=function(e){e.stopPropagation();grid.classPage.pageIndex-=1;grid.tbs_displayPanel30(0)};if(document.querySelector(selector+" .tbs-grid-panel10-page-prev"))document.querySelector(selector+" .tbs-grid-panel10-page-prev").addEventListener("mousedown",prevEvent);const curEvent=function(e){e.stopPropagation();grid.tbs_displayPanel30(0)};if(document.querySelector(selector+" .tbs-grid-panel10-page-select"))document.querySelector(selector+" .tbs-grid-panel10-page-select").addEventListener("mousedown",curEvent);const nextEvent=function(e){e.stopPropagation();grid.classPage.pageIndex+=1;grid.tbs_displayPanel30(0)};if(document.querySelector(selector+" .tbs-grid-panel10-page-next"))document.querySelector(selector+" .tbs-grid-panel10-page-next").addEventListener("mousedown",nextEvent);const lastEvent=function(e){e.stopPropagation();grid.classPage.pageIndex=grid.classPage.pageCount;grid.tbs_displayPanel30(0)};if(document.querySelector(selector+" .tbs-grid-panel10-page-last"))document.querySelector(selector+" .tbs-grid-panel10-page-last").addEventListener("mousedown",lastEvent)};TbsGrid.prototype.panel20_select=function(){let selector="#"+this.gridId;let grid=this;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let moveCell;let moveCellLeft;let moveCellTop;let moveCellIndex;let moveCellRowIndex;let table=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");const mouseDownEvent=function(e){let col=e.target.closest(".tbs-grid-cell");grid.startX=startX=window.pageXOffset+e.clientX;grid.startY=startY=window.pageYOffset+e.clientY;grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;startCellIndex=col.cellIndex;lastCellIndex=col.cellIndex;if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCell(e,table)}else if(window.event.shiftKey){selectCellShift(e,table)}}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){e.preventDefault();e.stopPropagation();if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCellMove(e,table)}}};const mouseUpEvent=function(e){grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let isInPanel80=grid.tbs_isInPanel(e,"panel80",lastX,lastY);let isInPanel90=grid.tbs_isInPanel(e,"panel90",lastX,lastY);if(isInPanel80){if(grid.options[grid.option_groupVisible]==true&&document.querySelectorAll(" .tbs-grid-move").length>0){let moveElement=document.querySelector(".tbs-grid-move");let rectPanel80=document.querySelector(selector+" .tbs-grid-panel80").getBoundingClientRect();let rectMoveCell=moveElement.getBoundingClientRect();let columnIndex=moveElement.dataset.columnIndex;let rowIndex=moveElement.dataset.rowIndex;let column=grid.tbs_getColumnByIndex(columnIndex);let name=column[grid.column_name];let text=column[grid.column_text];let order="asc";let buttons=document.querySelectorAll(selector+" .tbs-grid-panel-bar .tbs-grid-panel-button");let targetButton;let targetIndex;let moveLeft=grid.tbs_getOffset(moveElement).left;for(let i=buttons.length+1;i>=0;i--){let button=buttons[i];let buttonLeft=grid.tbs_getOffset(button).left;if(moveLeft<buttonLeft){targetButton=button;targetIndex=i}}if(grid.null(targetIndex)){targetButton=null;targetIndex=null}if(name!="group_column")grid.tbs_addGroupButton(name,text,order,targetIndex);flagLeft=false;flagRight=false;flagUp=false;flagDown=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove()}flagLeft=false;flagRight=false;flagUp=false;flagDown=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}else if(isInPanel90){if(grid.options[grid.option_sortVisible]==true&&document.querySelectorAll(" .tbs-grid-move").length>0){let moveElement=document.querySelector(".tbs-grid-move");let rectPanel80=document.querySelector(selector+" .tbs-grid-panel80").getBoundingClientRect();let rectMoveCell=moveElement.getBoundingClientRect();let columnIndex=moveElement.dataset.columnIndex;let rowIndex=moveElement.dataset.rowIndex;let column=grid.tbs_getColumnByIndex(columnIndex);let name=column[grid.column_name];let text=column[grid.column_text];let order="asc";let buttons=document.querySelectorAll(selector+" .tbs-grid-panel-bar .tbs-grid-panel-button");let targetButton;let targetIndex;let moveLeft=grid.tbs_getOffset(moveElement).left;for(let i=buttons.length+1;i>=0;i--){let button=buttons[i];let buttonLeft=grid.tbs_getOffset(button).left;if(moveLeft<buttonLeft){targetButton=button;targetIndex=i}}if(grid.null(targetIndex)){targetButton=null;targetIndex=null}if(name!="group_column")grid.tbs_addSortButton(name,text,order,targetIndex);flagLeft=false;flagRight=false;flagUp=false;flagDown=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove()}flagLeft=false;flagRight=false;flagUp=false;flagDown=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}else{if(mouseButton==0&&startX>lastX-grid.grid_mousePointRange&&startX<lastX+grid.grid_mousePointRange&&startY>lastY-grid.grid_mousePointRange&&startY<lastY+grid.grid_mousePointRange){let element=e.target.closest(".tbs-grid-cell");let name=element.dataset.name;if(e.detail==1){if(grid.tbs_isColumnName(name))grid.event_columnSort(e.target.closest(".tbs-grid-cell"));if(grid.options[grid.option_sortVisible]==true)grid.tbs_getSortButtonList()}}else{const changeColumnOrder=function(){let trList=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table tbody tr");let columns=grid.columns;let rowLen=trList.length;let colLen=columns.length;let arr=[];for(let x=0;x<colLen;x++){for(let i=0;i<rowLen;i++){let cell=trList[i].childNodes[x];if(cell.dataset.name=="")continue;arr.push(cell.dataset.name)}}let colList=[];for(let i=0,len=arr.length;i<len;i++){for(let x=0;x<colLen;x++){if(arr[i]==columns[x][grid.column_name]){colList.push(JSON.parse(JSON.stringify(columns[x])));break}}}grid.columns=JSON.parse(JSON.stringify(colList))};const changeHeaderColumnOrder=function(moveCell,targetCell,direction){const splice=function(arr,copyArr,selectIndex,targetIndex,direction){if(direction=="after")targetIndex+=1;arr.splice(targetIndex,0,JSON.parse(JSON.stringify(copyArr[selectIndex])));for(let x=0,colLen=arr.length;x<colLen;x++){arr[x].colIndex=x}};let headerColumns=grid.headerColumnTable;let movingHeaderColumn=headerColumns[moveCell.parentNode.rowIndex-1][moveCell.cellIndex];let startRowIndex=movingHeaderColumn[grid.column_rowIndex];let lastRowIndex=grid.headerColumnTable.length-1;let startColIndex=movingHeaderColumn[grid.column_colIndex];let lastColIndex=startColIndex+moveCell.colSpan-1;let targetColIndex=direction=="after"?targetCell.cellIndex+targetCell.colSpan-1:targetCell.cellIndex;let copyHeaderColumns=JSON.parse(JSON.stringify(grid.headerColumnTable));for(let i=startRowIndex;i<=lastRowIndex;i++){for(let x=lastColIndex;x>=startColIndex;x--){splice(headerColumns[i],copyHeaderColumns[i],x,targetColIndex,direction)}}for(let i=startRowIndex;i<=lastRowIndex;i++){let delIndex=targetColIndex<startColIndex?startColIndex+moveCell.colSpan:startColIndex;headerColumns[i].splice(delIndex,moveCell.colSpan);for(let x=0,colLen=grid.columns.length;x<colLen;x++){grid.headerColumnTable[i][x][grid.column_colIndex]=x}}};if(document.querySelectorAll(".tbs-grid-move").length>0){let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let rectMoveCell=document.querySelector(".tbs-grid-move").getBoundingClientRect();let headerColumns=grid.headerColumnTable;let movingColumn=headerColumns[moveCellRowIndex-1][moveCellIndex];let targetCol;let tdList20=document.querySelectorAll(selector+' .tbs-grid-panel20 tbody td:not([style*="display :none"]');let fixedWidth=50;for(let x=0,len=tdList20.length;x<len;x++){let cell=tdList20[x];targetCol=headerColumns[cell.parentNode.rowIndex-1][cell.cellIndex];if(lastX-startX>0){if(lastX-fixedWidth<=cell.getBoundingClientRect().right&&lastX+fixedWidth>=cell.getBoundingClientRect().right&&movingColumn[grid.column_rowIndex]==targetCol[grid.column_rowIndex]&&movingColumn[grid.column_parentNum]==targetCol[grid.column_parentNum]&&moveCell.cellIndex!=cell.cellIndex){changeHeaderColumnOrder(moveCell,cell,"after");direction="after";break}}else{if(lastX-fixedWidth<=cell.getBoundingClientRect().left&&lastX+fixedWidth>=cell.getBoundingClientRect().left&&movingColumn[grid.column_rowIndex]==targetCol[grid.column_rowIndex]&&movingColumn[grid.column_parentNum]==targetCol[grid.column_parentNum]&&moveCell.cellIndex!=cell.cellIndex){changeHeaderColumnOrder(moveCell,cell,"before");direction="before";break}}}grid.tbs_displayPanel20();changeColumnOrder();if(grid.topColumns.length>0)grid.tbs_displayPanel40();if(grid.footerColumns.length>0)grid.tbs_displayPanel50();let columns=grid.columns;let tableRows20=document.querySelectorAll(selector+" .tbs-grid-panel20  thead th");let tableRows30=document.querySelectorAll(selector+" .tbs-grid-panel30  thead th");for(let i=0,len=columns.length;i<len;i++){let column=columns[i];let styleWidth=column[grid.column_width]+"px";tableRows20[i].style.width=styleWidth;tableRows30[i].style.width=styleWidth}grid.classControl.after_changeColumnOrder()}document.querySelector(".tbs-grid-move").remove();flagLeft=false;flagRight=false}document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus()}};const selectCell=function(e,table){let col=e.target.closest(".tbs-grid-cell");let column=grid.tbs_getColumnByIndex(col.cellIndex);let columnName=column[grid.column_name];let isMovable=grid.tbs_isMovableColumn(columnName);if(isMovable){let moveDiv;if(document.querySelectorAll(".tbs-grid-move").length==0){moveDiv=document.createElement("div");moveDiv.classList.add("tbs-grid-move");let table=document.createElement("table");table.classList.add("tbs-grid-table");let tr=document.createElement("tr");let td=document.createElement("td");td.classList.add("tbs-grid-cell");let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");div.appendChild(span);td.appendChild(div);tr.appendChild(td);table.appendChild(tr);moveDiv.appendChild(table);document.body.appendChild(moveDiv)}moveDiv=document.querySelector(".tbs-grid-move");moveDiv.style.display="none";moveDiv.querySelector(".tbs-grid-cell-span").textContent=col.querySelector(".tbs-grid-cell-span").innerText;moveDiv=document.querySelector(".tbs-grid-move");let colRect=col.getBoundingClientRect();moveCell=col;moveCellLeft=window.pageXOffset+e.clientX-colRect.left;moveCellTop=window.pageYOffset+e.clientY-colRect.top;moveCellIndex=col.cellIndex;moveCellRowIndex=col.parentNode.rowIndex;let nWidth=colRect.width+2+"px";let nHeight=colRect.height+2+"px";moveDiv.style.width=nWidth;moveDiv.style.height=nHeight;moveDiv.childNodes[0].style.width=nWidth;moveDiv.childNodes[0].style.height=nHeight;moveDiv.style.left="30000px";moveDiv.style.top="0px";moveDiv.dataset.columnIndex=col.cellIndex;moveDiv.dataset.rowIndex=col.parentNode.rowIndex}grid.tbs_removeRange(0,-1)};const selectCellMove=function(e,table){let col=e.target.closest(".tbs-grid-cell");flagLeft=false;flagRight=false;startX=grid.startX;startY=grid.startY;grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let moveY=lastY-startY;let moveX=lastX-startX;let isMovable=grid.tbs_isMovableColumn();if(isMovable){let moveDiv=document.querySelector(".tbs-grid-move");if(moveDiv){moveDiv.style.left=lastX-moveCellLeft+"px";moveDiv.style.top=lastY-moveCellTop+"px";if(Math.abs(moveX)>20||Math.abs(moveY)>20){moveDiv.style.display=""}}}else{select(startCellIndex,moveX,moveY,lastX,lastY)}let rect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let rectLeft=window.pageXOffset+rect.left;let rectRight=window.pageXOffset+rect.right;let type="";if(lastX<rectLeft){flagLeft=true;type="left";doInterval(type,lastX,lastY)}if(lastX>rectRight){flagRight=true;type="right";doInterval(type,lastX,lastY)}};const selectCellShift=function(e,table){};const select=function(startCellIndex,moveX,moveY,lastX,lastY){let tableRect=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").getBoundingClientRect();let top=window.pageYOffset+tableRect.top;let bottom=window.pageYOffset+tableRect.bottom;let sumRect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let right=window.pageXOffset+sumRect.right;let left=window.pageXOffset+sumRect.left;let arr=document.querySelectorAll(selector+' .tbs-grid-panel20 .tbs-grid-table td:not([data-name=""])');let tdList=Array.from(arr).sort(function(a,b){a=a.cellIndex;b=b.cellIndex;if(a>b)return 1;if(a<b)return-1;return 0});if(moveX>0){let maxCellIndex;for(let x=0,len=tdList.length;x<len;x++){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let left=window.pageXOffset+cell.getBoundingClientRect().left;if(lastX>left)maxCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,maxCellIndex)}if(moveX<0){let minCellIndex;for(let x=tdList.length-1;x>=0;x--){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let right=window.pageXOffset+cell.getBoundingClientRect().right;if(lastX<right)minCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,minCellIndex)}};const selectRefresh=function(type,lastX,lastY){let content=document.querySelector(selector+" .tbs-grid-panel30");let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");trContent=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display:"])');let startRowIndex=grid.startRowIndex;let lastRowIndex=grid.lastRowIndex;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let trCount=trContent.length;let tdCount=trContent.length>0?trContent[0].childNodes.length:0;let minRowIndex,maxRowIndex,maxCellIndex,minCellIndex;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false}else{grid.tbs_setBarPositionByDirection("right")}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false}else{grid.tbs_setBarPositionByDirection("left")}}else if(type=="down"){}else if(type=="up"){}};const doInterval=function(type,lastX,lastY){if(flagLeft){flagRight=false;setTimeout(function(){doInterval("left",lastX,lastY)},5);selectRefresh("left",lastX,lastY)}if(flagRight){flagLeft=false;setTimeout(function(){doInterval("right",lastX,lastY)},5);selectRefresh("right",lastX,lastY)}};table.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel21_select=function(){let selector="#"+this.gridId;let grid=this;let table=document.querySelector(selector+" .tbs-grid-panel21 .tbs-grid-table");const mouseDownEvent=function(e){let col=e.target.closest(".tbs-grid-cell");if(col.cellIndex==0){let fromCellIndex=grid.tbs_getFirstVisibleColumnIndex();let toCellIndex=grid.tbs_getLastVisibleColumnIndex();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,fromCellIndex,toCellIndex)}document.addEventListener("mouseup",mouseUpEvent)};const mouseUpEvent=function(e){document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus()};table.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel30_select=function(eventPanelName){let selector="#"+this.gridId;let grid=this;let targetName;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let eventPanel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);const mouseDownEvent=function(e){startX=grid.startX=window.pageXOffset+e.clientX;startY=grid.startY=window.pageYOffset+e.clientY;lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;mouseButton=window.event.button;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=-1;startCellIndex=tableCell.cellIndex;lastCellIndex=tableCell.cellIndex;if(window.event.ctrlKey)selectCellCtrl(e);else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){if(targetName=="icon"){if(grid.grid_mode==grid.code_tree){grid.tbs_setTreeFolding(tableCell);selectCell(e)}else if(grid.grid_mode==grid.code_group){grid.tbs_setGroupFolding(tableCell);selectCell(e)}}else selectCell(e)}else if(window.event.shiftKey)selectCellShift(e)}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;e.preventDefault();e.stopPropagation();if(grid.options[grid.option_selectMode]=="cell")return;if(window.event.ctrlKey)selectCellCtrlMove(e);else if(window.event.shiftKey){selectCellShiftMove(e)}else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey)selectCellMove(e)}return false};const mouseUpEvent=function(e){e.preventDefault();e.stopPropagation();lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;flagUp=false;flagDown=false;flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus();let isInArea=grid.tbs_isInPanel(e,eventPanelName,lastX,lastY);if(isInArea){if(mouseButton==0&&grid.tbs_isMovedPositionInConstRange(startX,startY,lastX,lastY)){let param={e:e,rowIndex:startRowIndex,cellIndex:startCellIndex,mode:"mouse"};if(e.detail==1){let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");if(panelInput.style.left!="30000px"){grid.tbs_editEnd();grid.input_focus()}else grid.tbs_executeEvent(true,"click",param)}else if(e.detail==2){let isEditable=grid.columns[startCellIndex][grid.column_editable];if(isEditable){if(grid.notNull(grid.user_edit)){grid.tbs_editStart(e,"mouse")}else{grid.input_show(e,"mouse")}}else grid.tbs_executeEvent(true,"dblclick",param)}}}};const selectCell=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;startCellIndex=tableCell.cellIndex;lastCellIndex=startCellIndex;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=startRowIndex;if(eventPanelName=="panel60"){if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel61 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}else{if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,startRowIndex,startCellIndex,lastCellIndex)};const selectCellMove=function(e){flagUp=false;flagDown=false;flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedRowIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);if(eventPanelName=="panel60"){panel=document.querySelector(selector+" .tbs-grid-group30")}let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect30.top+rect30.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else if(grid.fixedColumnIndex!=-1){if(eventPanelName=="panel32"){let panel32=document.querySelector(selector+" .tbs-grid-panel32");let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect32=panel32.getBoundingClientRect();let rect30=panel30.getBoundingClientRect();let panelTop=rect32.top;let panelBottom=rect32.top+rect32.height;let panelLeft=rect32.left;let panelRight32=rect30.left;let panelRight=rect30.left+rect30.width;if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX<panelRight32&&document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar").style.left!="0px"){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}select(moveX,moveY)}else{let panel32=document.querySelector(selector+" .tbs-grid-panel32");let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect32=panel32.getBoundingClientRect();let rect30=panel30.getBoundingClientRect();let panelTop=rect30.top;let panelBottom=rect30.top+rect30.height;let panelLeft=rect30.left;let panelRight=rect30.left+rect30.width;if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}select(moveX,moveY)}}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const selectCellCtrl=function(e){};const selectCellCtrlMove=function(e){};const selectCellShift=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;grid.startCellIndex=startCellIndex=startCellIndex==-1?tableCell.cellIndex:grid.startCellIndex;grid.lastCellIndex=lastCellIndex=tableCell.cellIndex;grid.startRowIndex=startRowIndex=startRowIndex==-1?tableCell.parentNode.dataset.rowIndex:grid.startRowIndex;grid.lastRowIndex=lastRowIndex=tableCell.parentNode.dataset.rowIndex;if(eventPanelName=="panel60"){if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel61 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}else{if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex)};const selectCellShiftMove=function(e){flagUp=false;flagDown=false;flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedRowIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);if(eventPanelName=="panel60"){panel=document.querySelector(selector+" .tbs-grid-group30")}let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect30.top+rect30.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const select=function(moveX,moveY){if(moveY>0&&moveX>0){let maxRowIndex,maxCellIndex;maxRowIndex=grid.tbs_getMaxRowIndexByMouseMove();maxCellIndex=grid.tbs_getMaxCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,maxRowIndex,startCellIndex,maxCellIndex)}if(moveY>0&&moveX<0){let maxRowIndex,minCellIndex;maxRowIndex=grid.tbs_getMaxRowIndexByMouseMove();minCellIndex=grid.tbs_getMinCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,maxRowIndex,startCellIndex,minCellIndex)}if(moveY<0&&moveX>0){let minRowIndex,maxCellIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();maxCellIndex=grid.tbs_getMaxCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,startCellIndex,maxCellIndex)}if(moveY<0&&moveX<0){let minRowIndex,minCellIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();minCellIndex=grid.tbs_getMinCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,startCellIndex,minCellIndex)}};const setPanelMove=function(type){let startRowIndex=grid.startRowIndex;let lastRowIndex=grid.lastRowIndex;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let minRowIndex,maxRowIndex,maxCellIndex,minCellIndex;let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableCellCount=tableRows.length>0?tableRows[0].childNodes.length:0;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,-1)}else{grid.tbs_setBarPositionByDirection("right");maxCellIndex=grid.tbs_getMaxCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,maxCellIndex)}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex)}else{grid.tbs_setBarPositionByDirection("left");minCellIndex=grid.tbs_getMinCellIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,minCellIndex)}}else if(type=="down"){grid.tbs_setBarPositionByDirection("down");if(lastRowIndex<grid.data_view.length-1){lastRowIndex+=1;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex)}else flagDown=false}else if(type=="up"){grid.tbs_setBarPositionByDirection("up");if(grid.fixedRowIndex!=-1){if(lastRowIndex!=0){let minRowIndex=lastRowIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,startCellIndex,lastCellIndex)}else flagUp=false}else{if(lastRowIndex!=0){let minRowIndex=lastRowIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,startCellIndex,lastCellIndex)}else flagUp=false}}};const doInterval=function(type){if(type==grid.code_left||type==grid.code_right){if(flagLeft){flagRight=false;setTimeout(()=>doInterval("left"),15);setPanelMove("left")}if(flagRight){flagLeft=false;setTimeout(()=>doInterval("right"),15);setPanelMove("right")}}else{if(flagUp){flagDown=false;setTimeout(()=>doInterval("up"),15);setPanelMove("up")}if(flagDown){flagUp=false;setTimeout(()=>doInterval("down"),15);setPanelMove("down")}}};eventPanel.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel31_select=function(eventPanelName){let selector="#"+this.gridId;let grid=this;let targetName;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let eventPanel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);const mouseDownEvent=function(e){startX=grid.startX=window.pageXOffset+e.clientX;startY=grid.startY=window.pageYOffset+e.clientY;lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;let tableCell;if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;if(tableCell.dataset.cellType!="number")return;mouseButton=window.event.button;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=-1;startCellIndex=tableCell.cellIndex;lastCellIndex=tableCell.cellIndex;if(window.event.ctrlKey)selectCellCtrl(e);else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCell(e)}else if(window.event.shiftKey)selectCellShift(e)}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;e.preventDefault();e.stopPropagation();if(grid.options[grid.option_selectMode]=="cell")return;if(window.event.ctrlKey)selectCellCtrlMove(e);else if(window.event.shiftKey){selectCellShiftMove(e)}else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey)selectCellMove(e)}return false};const mouseUpEvent=function(e){e.preventDefault();e.stopPropagation();lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;flagUp=false;flagDown=false;flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus();let isInArea=grid.tbs_isInPanel(e,eventPanelName,lastX,lastY);if(isInArea){if(mouseButton==0&&grid.tbs_isMovedPositionInConstRange(startX,startY,lastX,lastY)){let param={e:e,rowIndex:startRowIndex,cellIndex:startCellIndex,mode:"mouse"};if(e.detail==1)grid.tbs_executeEvent(true,"click",param);else if(e.detail==2){let isEditable=grid.columns[startCellIndex][grid.column_editable];if(isEditable){if(grid.notNull(grid.user_edit)){grid.tbs_editStart(e,"mouse")}else{grid.input_show(e,"mouse")}}else grid.tbs_executeEvent(true,"dblclick",param)}}}};const selectCell=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;if(tableCell.dataset.cellType!="number")return;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=startRowIndex;if(eventPanelName=="panel61"){if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel61 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}else{if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}let fromCellIndex=grid.tbs_getFirstVisibleColumnIndex();let toCellIndex=grid.tbs_getLastVisibleColumnIndex();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,startRowIndex,fromCellIndex,toCellIndex)};const selectCellMove=function(e){flagUp=false;flagDown=false;flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedRowIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);if(eventPanelName=="panel60"){panel=document.querySelector(selector+" .tbs-grid-group30")}let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect30.top+rect30.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const selectCellCtrl=function(e){};const selectCellCtrlMove=function(e){};const selectCellShift=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;if(tableCell.dataset.cellType!="number")return;grid.startCellIndex=startCellIndex=startCellIndex==-1?tableCell.cellIndex:grid.startCellIndex;grid.lastCellIndex=lastCellIndex=tableCell.cellIndex;grid.startRowIndex=startRowIndex=startRowIndex==-1?tableCell.parentNode.dataset.rowIndex:grid.startRowIndex;grid.lastRowIndex=lastRowIndex=tableCell.parentNode.dataset.rowIndex;if(eventPanelName=="panel60"){if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel61 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}else{if(tableCell.rowSpan!=undefined&&tableCell.rowSpan>1){let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display: none"])');for(let i=0,len=tableRows.length;i<len;i++){let tableRow=tableRows[i];let rect=tableRow.childNodes[0].getBoundingClientRect();if(window.pageYOffset+rect.top<startY&&startY<window.pageYOffset+rect.bottom){startRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;lastRowIndex=parseInt(tableRow.childNodes[0].childNodes[0].textContent)-1;break}}}}let fromCellIndex=grid.tbs_getFirstVisibleColumnIndex();let toCellIndex=grid.tbs_getLastVisibleColumnIndex();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)};const selectCellShiftMove=function(e){flagUp=false;flagDown=false;flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedRowIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);if(eventPanelName=="panel60"){panel=document.querySelector(selector+" .tbs-grid-group30")}let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect30.top+rect30.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const select=function(moveX,moveY){let fromCellIndex=grid.tbs_getFirstVisibleColumnIndex();let toCellIndex=grid.tbs_getLastVisibleColumnIndex();if(moveY>0&&moveX>0){let maxRowIndex,maxCellIndex;maxRowIndex=grid.tbs_getMaxRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,maxRowIndex,fromCellIndex,toCellIndex)}if(moveY>0&&moveX<0){let maxRowIndex,minCellIndex;maxRowIndex=grid.tbs_getMaxRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,maxRowIndex,fromCellIndex,toCellIndex)}if(moveY<0&&moveX>0){let minRowIndex,maxCellIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,fromCellIndex,toCellIndex)}if(moveY<0&&moveX<0){let minRowIndex,minCellIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,fromCellIndex,toCellIndex)}};const setPanelMove=function(type){let startRowIndex=grid.startRowIndex;let lastRowIndex=grid.lastRowIndex;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let fromCellIndex=grid.tbs_getFirstVisibleColumnIndex();let toCellIndex=grid.tbs_getLastVisibleColumnIndex();let minRowIndex,maxRowIndex,maxCellIndex,minCellIndex;let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableCellCount=tableRows.length>0?tableRows[0].childNodes.length:0;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)}else{grid.tbs_setBarPositionByDirection("right");grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)}else{grid.tbs_setBarPositionByDirection("left");grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)}}else if(type=="down"){grid.tbs_setBarPositionByDirection("down");if(lastRowIndex<grid.data_view.length-1){lastRowIndex+=1;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,fromCellIndex,toCellIndex)}else flagDown=false}else if(type=="up"){grid.tbs_setBarPositionByDirection("up");if(grid.fixedRowIndex!=-1){if(lastRowIndex!=0){let minRowIndex=lastRowIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,fromCellIndex,toCellIndex)}else flagUp=false}else{if(lastRowIndex!=0){let minRowIndex=lastRowIndex;minRowIndex=grid.tbs_getMinRowIndexByMouseMove();grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,minRowIndex,fromCellIndex,toCellIndex)}else flagUp=false}}};const doInterval=function(type){if(flagLeft){flagUp=false;flagDown=false;flagRight=false;setTimeout(()=>doInterval("left"),15);setPanelMove("left")}if(flagRight){flagUp=false;flagDown=false;flagLeft=false;setTimeout(()=>doInterval("right"),15);setPanelMove("right")}if(flagUp){flagDown=false;flagLeft=false;flagRight=false;setTimeout(()=>doInterval("up"),5);setPanelMove("up")}if(flagDown){flagUp=false;flagLeft=false;flagRight=false;setTimeout(()=>doInterval("down"),5);setPanelMove("down")}};eventPanel.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel40_select=function(eventPanelName){let selector="#"+this.gridId;let grid=this;let classRange=eventPanelName=="panel40"||eventPanelName=="panel42"?grid.classRange40:grid.classRange50;let targetName;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let eventPanel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);const mouseDownEvent=function(e){startX=grid.startX=window.pageXOffset+e.clientX;startY=grid.startY=window.pageYOffset+e.clientY;lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;mouseButton=window.event.button;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=-1;startCellIndex=tableCell.cellIndex;lastCellIndex=tableCell.cellIndex;if(window.event.ctrlKey)selectCellCtrl(e);else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){if(targetName=="icon"){if(grid.grid_mode==grid.code_tree){grid.tbs_setTreeFolding(tableCell);selectCell(e)}else if(grid.grid_mode==grid.code_group){grid.tbs_setGroupFolding(tableCell);selectCell(e)}}else selectCell(e)}else if(window.event.shiftKey)selectCellShift(e)}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;e.preventDefault();e.stopPropagation();if(grid.options[grid.option_selectMode]=="cell")return;if(window.event.ctrlKey)selectCellCtrlMove(e);else if(window.event.shiftKey){selectCellShiftMove(e)}else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey)selectCellMove(e)}return false};const mouseUpEvent=function(e){e.preventDefault();e.stopPropagation();lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;flagUp=false;flagDown=false;flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus();let isInArea=grid.tbs_isInPanel(e,eventPanelName,lastX,lastY);if(isInArea){if(mouseButton==0&&grid.tbs_isMovedPositionInConstRange(startX,startY,lastX,lastY)){let param={e:e,rowIndex:startRowIndex,cellIndex:startCellIndex,mode:"mouse"};if(e.detail==1){let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");if(panelInput.style.left!="30000px"){grid.tbs_editEnd();grid.input_focus()}else grid.tbs_executeEvent(true,"click",param)}else if(e.detail==2){let isEditable=grid.columns[startCellIndex][grid.column_editable];if(isEditable){if(grid.notNull(grid.user_edit)){grid.tbs_editStart(e,"mouse")}else{grid.input_show(e,"mouse")}}else grid.tbs_executeEvent(true,"dblclick",param)}}}};const selectCell=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;startCellIndex=tableCell.cellIndex;lastCellIndex=startCellIndex;startRowIndex=0;lastRowIndex=0;classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,startRowIndex,startCellIndex,lastCellIndex)};const selectCellMove=function(e){flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-panel32");let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}else if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}else if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}}select(moveX,moveY)}};const selectCellCtrl=function(e){};const selectCellCtrlMove=function(e){};const selectCellShift=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div-icon")){targetName="icon";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-img")){targetName="img";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div-text")){targetName="text";tableCell=e.target.parentNode.parentNode}else if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;classRange.startCellIndex=startCellIndex=startCellIndex==-1?tableCell.cellIndex:classRange.startCellIndex;classRange.lastCellIndex=lastCellIndex=tableCell.cellIndex;classRange.startRowIndex=startRowIndex=0;classRange.lastRowIndex=lastRowIndex=0;classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex)};const selectCellShiftMove=function(e){flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const select=function(moveX,moveY){if(moveX>0){let maxRowIndex,maxCellIndex;maxRowIndex=0;maxCellIndex=classRange.class_getMaxCellIndexByMouseMove();classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,maxRowIndex,startCellIndex,maxCellIndex)}else if(moveX<0){let maxRowIndex,minCellIndex;maxRowIndex=0;minCellIndex=classRange.class_getMinCellIndexByMouseMove();classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,maxRowIndex,startCellIndex,minCellIndex)}};const setPanelMove=function(type){let startRowIndex=0;let lastRowIndex=0;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let maxCellIndex,minCellIndex;let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display: none"])');let tableCellCount=tableRows.length>0?tableRows[0].childNodes.length:0;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false;classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,lastRowIndex,startCellIndex,-1)}else{grid.tbs_setBarPositionByDirection("right");maxCellIndex=classRange.class_getMaxCellIndexByMouseMove();classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,lastRowIndex,startCellIndex,maxCellIndex)}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false;classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex)}else{grid.tbs_setBarPositionByDirection("left");minCellIndex=classRange.class_getMinCellIndexByMouseMove();classRange.class_removeRange(0,-1);classRange.class_selectRange(startRowIndex,lastRowIndex,startCellIndex,minCellIndex)}}};const doInterval=function(type){if(flagLeft){flagRight=false;setTimeout(()=>doInterval("left"),15);setPanelMove("left")}if(flagRight){flagLeft=false;setTimeout(()=>doInterval("right"),15);setPanelMove("right")}};eventPanel.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel41_select=function(eventPanelName){let selector="#"+this.gridId;let grid=this;let targetName;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let eventPanel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);const mouseDownEvent=function(e){startX=grid.startX=window.pageXOffset+e.clientX;startY=grid.startY=window.pageYOffset+e.clientY;lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;let tableCell;if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;if(tableCell.dataset.cellType!="number")return;mouseButton=window.event.button;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=-1;startCellIndex=tableCell.cellIndex;lastCellIndex=tableCell.cellIndex;if(window.event.ctrlKey)selectCellCtrl(e);else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCell(e)}else if(window.event.shiftKey)selectCellShift(e)}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;e.preventDefault();e.stopPropagation();if(grid.options[grid.option_selectMode]=="cell")return;if(window.event.ctrlKey)selectCellCtrlMove(e);else if(window.event.shiftKey){selectCellShiftMove(e)}else if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey)selectCellMove(e)}return false};const mouseUpEvent=function(e){e.preventDefault();e.stopPropagation();lastX=grid.lastX=window.pageXOffset+e.clientX;lastY=grid.lastY=window.pageYOffset+e.clientY;flagUp=false;flagDown=false;flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent);grid.input_focus();let isInArea=grid.tbs_isInPanel(e,eventPanelName,lastX,lastY);if(isInArea){if(mouseButton==0&&grid.tbs_isMovedPositionInConstRange(startX,startY,lastX,lastY)){let param={e:e,rowIndex:startRowIndex,cellIndex:startCellIndex,mode:"mouse"};if(e.detail==1)grid.tbs_executeEvent(true,"click",param);else if(e.detail==2){let isEditable=grid.columns[startCellIndex][grid.column_editable];if(isEditable){if(grid.notNull(grid.user_edit)){grid.tbs_editStart(e,"mouse")}else{grid.input_show(e,"mouse")}}else grid.tbs_executeEvent(true,"dblclick",param)}}}};const selectCell=function(e){let tableCell;if(e.target.classList.contains("tbs-grid-cell-div")){targetName="div";tableCell=e.target.parentNode}else if(e.target.classList.contains("tbs-grid-cell")){targetName="cell";tableCell=e.target}else return;if(tableCell.dataset.cellType!="number")return;startRowIndex=grid.tbs_getRowIndexInTable(tableCell.parentNode.rowIndex,eventPanelName);lastRowIndex=startRowIndex;let panelName=eventPanelName;if(panelName=="panel41"){grid.classRange40.class_removeRange(0,-1);grid.classRange40.class_selectRange(0,0)}else if(panelName=="panel51"){grid.classRange50.class_removeRange(0,-1);grid.classRange50.class_selectRange(0,0)}};const selectCellMove=function(e){flagUp=false;flagDown=false;flagLeft=false;flagRight=false;let moveY=grid.lastY-grid.startY;let moveX=grid.lastX-grid.startX;let lastX=grid.lastX;let lastY=grid.lastY;if(grid.fixedRowIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);if(eventPanelName=="panel60"){panel=document.querySelector(selector+" .tbs-grid-group30")}let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect30.top+rect30.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else if(grid.fixedColumnIndex!=-1){let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let panel30=document.querySelector(selector+" .tbs-grid-panel30");let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let rect30=panel30.getBoundingClientRect();let absRect30=grid.tbs_getOffset(panel30);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect30.left+rect30.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}else{let panel=document.querySelector(selector+" .tbs-grid-"+eventPanelName);let rect=panel.getBoundingClientRect();let absRect=grid.tbs_getOffset(panel);let panelTop=absRect.top;let panelBottom=absRect.top+rect.height;let panelLeft=absRect.left;let panelRight=absRect.left+rect.width;if(lastX<panelLeft||lastX>panelRight||lastY<panelTop||lastY>panelBottom){if(lastX<panelLeft){flagLeft=true;doInterval(grid.code_left)}if(lastX>panelRight){flagRight=true;doInterval(grid.code_right)}if(lastY<panelTop){flagUp=true;doInterval(grid.code_up)}if(lastY>panelBottom){flagDown=true;doInterval(grid.code_down)}}select(moveX,moveY)}};const selectCellCtrl=function(e){};const selectCellCtrlMove=function(e){};const selectCellShift=function(e){};const selectCellShiftMove=function(e){};const select=function(moveX,moveY){let panelName=eventPanelName;if(panelName=="panel41"){grid.classRange40.class_removeRange(0,-1);grid.classRange40.class_selectRange(0,0)}else if(panelName=="panel51"){grid.classRange50.class_removeRange(0,-1);grid.classRange50.class_selectRange(0,0)}};eventPanel.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel70_select=function(){let selector="#"+this.gridId;let grid=this;let element;let targetName;const changeEvent=function(e){let combo=e.target;let columnName=combo.dataset.name;let column=grid.tbs_getColumn(columnName);let columnIndex=grid.tbs_getColumnIndex(columnName);let columnType=column[grid.column_type];let filterType=combo.selectedOptions[0].value;let inputs=document.querySelectorAll(selector+" .tbs-grid-cell-filter-input");let input=inputs[columnIndex];let word=input.value;if(word!=""){let filterColumn=grid.tbs_getJsonRow(grid.filterColumns,grid.column_name,column[grid.column_name]);grid.tbs_setFilterColumn(column,filterType,word);grid.tbs_filters();if(grid.grid_mode==grid.code_group)grid.tbs_setData(grid.data_view,null,false);else grid.tbs_apply()}else{grid.tbs_removeFilterColumn(column);grid.tbs_filters();if(grid.grid_mode==grid.code_group)grid.tbs_setData(grid.data_view,null,false);else grid.tbs_apply()}};const keyupEvent=function(e){let input=e.target;if(e.keyCode==13||e.keyCode==9){let columnName=input.dataset.name;let column=grid.tbs_getColumn(columnName);let columnIndex=grid.tbs_getColumnIndex(columnName);let columnType=column[grid.column_type];let combos=document.querySelectorAll(selector+" .tbs-grid-cell-filter-combo");let combo=combos[columnIndex];let filterType=combo.selectedOptions[0].value;let word=input.value;if(word!=""){let filterColumn=grid.tbs_getJsonRow(grid.filterColumns,grid.column_name,column[grid.column_name]);grid.tbs_setFilterColumn(column,filterType,word);if(grid.grid_mode==grid.code_group){grid.tbs_setData(grid.data_view,null,false)}else{grid.tbs_filters();grid.tbs_apply()}}else{grid.tbs_removeFilterColumn(column);grid.tbs_filters();if(grid.grid_mode==grid.code_group)grid.tbs_setData(grid.data_view,null,false);else grid.tbs_apply()}}};const blurEvent=function(e){};let inputs=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-cell-filter-input");let combos=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-cell-filter-combo");for(let i=0,len=inputs.length;i<len;i++){inputs[i].addEventListener("keyup",keyupEvent);combos[i].addEventListener("change",changeEvent)}};TbsGrid.prototype.panel80_select=function(){let selector="#"+this.gridId;let grid=this;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let targetName;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let moveCell;let moveCellLeft;let moveCellTop;let moveCellIndex;let moveCellRowIndex;let panel80=document.querySelector(selector+" .tbs-grid-panel80");const mouseDownEvent=function(e){let element;if(e.target.classList.contains("tbs-grid-panel-button-icon")){targetName="icon";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button-text")){targetName="text";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button")){targetName="button";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-bar")){targetName="bar";element=e.target}else return;grid.startX=startX=window.scrollX+e.clientX;grid.startY=startY=window.scrollY+e.clientY;grid.lastX=lastX=window.scrollX+e.clientX;grid.lastY=lastY=window.scrollY+e.clientY;if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCell(e,panel80)}else if(window.event.shiftKey){selectCellShift(e,panel80)}}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){e.preventDefault();e.stopPropagation();if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCellMove(e,panel80)}}};const mouseUpEvent=function(e){grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let isInPanel80=grid.tbs_isInPanel(e,"panel80",lastX,lastY);if(isInPanel80){if(grid.options[grid.option_groupVisible]==true&&document.querySelectorAll(" .tbs-grid-move").length>0){let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let rectMoveCell=document.querySelector(".tbs-grid-move").getBoundingClientRect()}if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove();document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}else{if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove();flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}};const selectCell=function(e,table){let element;if(e.target.classList.contains("tbs-grid-panel-button-icon")){targetName="icon";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button-text")){targetName="text";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button")){targetName="button";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-bar")){targetName="bar";element=e.target}else return;if(targetName=="icon"){grid.tbs_removeGroupButton(element)}flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)};const selectCellMove=function(e,table){let col=e.target.closest(".tbs-grid-cell");flagLeft=false;flagRight=false;startX=grid.startX;startY=grid.startY;grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let moveY=lastY-startY;let moveX=lastX-startX;if(grid.options[grid.option_movable]){let moveDiv=document.querySelector(".tbs-grid-move");if(moveDiv){moveDiv.style.left=lastX-moveCellLeft+"px";moveDiv.style.top=lastY-moveCellTop+"px";if(Math.abs(moveX)>grid.grid_mousePointRange||Math.abs(moveY)>grid.grid_mousePointRange){moveDiv.style.display=""}}}else{select(startCellIndex,moveX,moveY,lastX,lastY)}let rect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let rectLeft=window.pageXOffset+rect.left;let rectRight=window.pageXOffset+rect.right;let type="";if(lastX<rectLeft){flagLeft=true;type="left";doInterval(type,lastX,lastY)}if(lastX>rectRight){flagRight=true;type="right";doInterval(type,lastX,lastY)}};const selectCellShift=function(e,table){};const select=function(startCellIndex,moveX,moveY,lastX,lastY){let tableRect=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").getBoundingClientRect();let top=window.pageYOffset+tableRect.top;let bottom=window.pageYOffset+tableRect.bottom;let sumRect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let right=window.pageXOffset+sumRect.right;let left=window.pageXOffset+sumRect.left;let arr=document.querySelectorAll(selector+' .tbs-grid-panel20 .tbs-grid-table td:not([data-name=""])');let tdList=Array.from(arr).sort(function(a,b){a=a.cellIndex;b=b.cellIndex;if(a>b)return 1;if(a<b)return-1;return 0});if(moveX>0){let maxCellIndex;for(let x=0,len=tdList.length;x<len;x++){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let left=window.pageXOffset+cell.getBoundingClientRect().left;if(lastX>left)maxCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,maxCellIndex)}if(moveX<0){let minCellIndex;for(let x=tdList.length-1;x>=0;x--){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let right=window.pageXOffset+cell.getBoundingClientRect().right;if(lastX<right)minCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,minCellIndex)}};const selectRefresh=function(type,lastX,lastY){let content=document.querySelector(selector+" .tbs-grid-panel30");let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");trContent=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display:"])');let startRowIndex=grid.startRowIndex;let lastRowIndex=grid.lastRowIndex;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let trCount=trContent.length;let tdCount=trContent.length>0?trContent[0].childNodes.length:0;let minRowIndex,maxRowIndex,maxCellIndex,minCellIndex;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,tdCount-1)}else{grid.tbs_setBarPositionByDirection("right");for(let trRowIndex=0;trRowIndex<trCount;trRowIndex++){for(let cellIndex=0;cellIndex<tdCount;cellIndex++){if(grid.columns[cellIndex][grid.column_visible]==false)continue;let left=window.pageXOffset+trContent[trRowIndex].childNodes[cellIndex].getBoundingClientRect().left;if(lastX>left)maxCellIndex=trContent[trRowIndex].childNodes[cellIndex].cellIndex}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,maxCellIndex)}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,0)}else{grid.tbs_setBarPositionByDirection("left");for(let rowIndex=0;rowIndex<trCount;rowIndex++){for(let cellIndex=tdCount-1;cellIndex>=0;cellIndex--){if(grid.columns[cellIndex][grid.column_visible]==false)continue;let right=window.pageXOffset+trContent[rowIndex].childNodes[cellIndex].getBoundingClientRect().right;if(lastX<right)minCellIndex=trContent[rowIndex].childNodes[cellIndex].cellIndex}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,minCellIndex)}}};const doInterval=function(type,lastX,lastY){if(flagLeft){flagRight=false;setTimeout(function(){doInterval("left",lastX,lastY)},5);selectRefresh("left",lastX,lastY)}if(flagRight){flagLeft=false;setTimeout(function(){doInterval("right",lastX,lastY)},5);selectRefresh("right",lastX,lastY)}};panel80.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.panel90_select=function(){let selector="#"+this.gridId;let grid=this;let startRowIndex,startCellIndex,startX,startY;let lastRowIndex,lastCellIndex,lastX,lastY;let targetName;let mouseButton=0;let flagUp=false;let flagDown=false;let flagLeft=false;let flagRight=false;let moveCell;let moveCellLeft;let moveCellTop;let moveCellIndex;let moveCellRowIndex;let panel90=document.querySelector(selector+" .tbs-grid-panel90");const mouseDownEvent=function(e){let element;if(e.target.classList.contains("tbs-grid-panel-button-icon")){targetName="icon";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button-text")){targetName="text";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button")){targetName="button";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-bar")){targetName="bar";element=e.target}else return;grid.startX=startX=window.scrollX+e.clientX;grid.startY=startY=window.scrollY+e.clientY;grid.lastX=lastX=window.scrollX+e.clientX;grid.lastY=lastY=window.scrollY+e.clientY;if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCell(e,panel90)}else if(window.event.shiftKey){selectCellShift(e,panel90)}}document.addEventListener("mousemove",mouseMoveEvent);document.addEventListener("mouseup",mouseUpEvent)};const mouseMoveEvent=function(e){e.preventDefault();e.stopPropagation();if(window.event.button===0){if(!window.event.ctrlKey&&!window.event.shiftKey){selectCellMove(e,panel90)}}};const mouseUpEvent=function(e){grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let isInPanel90=grid.tbs_isInPanel(e,"panel90",lastX,lastY);if(isInPanel90){if(grid.options[grid.option_sortVisible]==true&&document.querySelectorAll(" .tbs-grid-move").length>0){let rectPanel30=document.querySelector(selector+" .tbs-grid-panel30").getBoundingClientRect();let rectMoveCell=document.querySelector(".tbs-grid-move").getBoundingClientRect()}if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove();document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}else{if(document.querySelectorAll(".tbs-grid-move").length>0)document.querySelector(".tbs-grid-move").remove();flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)}};const selectCell=function(e,table){let element;if(e.target.classList.contains("tbs-grid-panel-button-icon")){targetName="icon";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button-text")){targetName="text";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-button")){targetName="button";element=e.target}else if(e.target.classList.contains("tbs-grid-panel-bar")){targetName="bar";element=e.target}else return;if(targetName=="icon"){grid.tbs_removeSortButton(element)}flagLeft=false;flagRight=false;document.removeEventListener("mousemove",mouseMoveEvent);document.removeEventListener("mouseup",mouseUpEvent)};const selectCellMove=function(e,table){let col=e.target.closest(".tbs-grid-cell");flagLeft=false;flagRight=false;startX=grid.startX;startY=grid.startY;grid.lastX=lastX=window.pageXOffset+e.clientX;grid.lastY=lastY=window.pageYOffset+e.clientY;let moveY=lastY-startY;let moveX=lastX-startX;if(grid.options[grid.option_movable]){let moveDiv=document.querySelector(".tbs-grid-move");if(moveDiv){moveDiv.style.left=lastX-moveCellLeft+"px";moveDiv.style.top=lastY-moveCellTop+"px";if(Math.abs(moveX)>grid.grid_mousePointRange||Math.abs(moveY)>grid.grid_mousePointRange){moveDiv.style.display=""}}}else{select(startCellIndex,moveX,moveY,lastX,lastY)}let rect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let rectLeft=window.pageXOffset+rect.left;let rectRight=window.pageXOffset+rect.right;let type="";if(lastX<rectLeft){flagLeft=true;type="left";doInterval(type,lastX,lastY)}if(lastX>rectRight){flagRight=true;type="right";doInterval(type,lastX,lastY)}};const selectCellShift=function(e,table){};const select=function(startCellIndex,moveX,moveY,lastX,lastY){let tableRect=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").getBoundingClientRect();let top=window.pageYOffset+tableRect.top;let bottom=window.pageYOffset+tableRect.bottom;let sumRect=document.querySelector(selector+" .tbs-grid-panel20").getBoundingClientRect();let right=window.pageXOffset+sumRect.right;let left=window.pageXOffset+sumRect.left;let arr=document.querySelectorAll(selector+' .tbs-grid-panel20 .tbs-grid-table td:not([data-name=""])');let tdList=Array.from(arr).sort(function(a,b){a=a.cellIndex;b=b.cellIndex;if(a>b)return 1;if(a<b)return-1;return 0});if(moveX>0){let maxCellIndex;for(let x=0,len=tdList.length;x<len;x++){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let left=window.pageXOffset+cell.getBoundingClientRect().left;if(lastX>left)maxCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,maxCellIndex)}if(moveX<0){let minCellIndex;for(let x=tdList.length-1;x>=0;x--){let cell=tdList[x];if(grid.columns[x][grid.column_visible]==false)continue;let right=window.pageXOffset+cell.getBoundingClientRect().right;if(lastX<right)minCellIndex=cell.cellIndex}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(0,-1,startCellIndex,minCellIndex)}};const selectRefresh=function(type,lastX,lastY){let content=document.querySelector(selector+" .tbs-grid-panel30");let table=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");trContent=document.querySelectorAll(selector+' .tbs-grid-panel30 .tbs-grid-table tbody tr:not([style*="display:"])');let startRowIndex=grid.startRowIndex;let lastRowIndex=grid.lastRowIndex;let startCellIndex=grid.startCellIndex;let lastCellIndex=grid.lastCellIndex;let trCount=trContent.length;let tdCount=trContent.length>0?trContent[0].childNodes.length:0;let minRowIndex,maxRowIndex,maxCellIndex,minCellIndex;if(type=="right"){if(table.style.left==-1*grid.horizontalScroll.hiddenSize+"px"){flagRight=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,tdCount-1)}else{grid.tbs_setBarPositionByDirection("right");for(let trRowIndex=0;trRowIndex<trCount;trRowIndex++){for(let cellIndex=0;cellIndex<tdCount;cellIndex++){if(grid.columns[cellIndex][grid.column_visible]==false)continue;let left=window.pageXOffset+trContent[trRowIndex].childNodes[cellIndex].getBoundingClientRect().left;if(lastX>left)maxCellIndex=trContent[trRowIndex].childNodes[cellIndex].cellIndex}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,maxCellIndex)}}else if(type=="left"){if(table.style.left=="0px"){flagLeft=false;grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,0)}else{grid.tbs_setBarPositionByDirection("left");for(let rowIndex=0;rowIndex<trCount;rowIndex++){for(let cellIndex=tdCount-1;cellIndex>=0;cellIndex--){if(grid.columns[cellIndex][grid.column_visible]==false)continue;let right=window.pageXOffset+trContent[rowIndex].childNodes[cellIndex].getBoundingClientRect().right;if(lastX<right)minCellIndex=trContent[rowIndex].childNodes[cellIndex].cellIndex}}grid.tbs_removeRange(0,-1);grid.tbs_selectRange(startRowIndex,lastRowIndex,startCellIndex,minCellIndex)}}};const doInterval=function(type,lastX,lastY){if(flagLeft){flagRight=false;setTimeout(function(){doInterval("left",lastX,lastY)},5);selectRefresh("left",lastX,lastY)}if(flagRight){flagLeft=false;setTimeout(function(){doInterval("right",lastX,lastY)},5);selectRefresh("right",lastX,lastY)}};panel90.addEventListener("mousedown",mouseDownEvent)};TbsGrid.prototype.tbs_removePanelRange=function(panelName=""){let selector="#"+this.gridId;let grid=this;if(panelName=="panel30"){document.querySelectorAll(selector+" .tbs-grid-cell-start").forEach(cell=>cell.classList.remove("tbs-grid-cell-start"));document.querySelectorAll(selector+" .tbs-grid-panel31 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel32 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel30 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"))}else if(panelName=="panel60"){document.querySelectorAll(selector+" .tbs-grid-panel61 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel62 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel60 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"))}else if(panelName=="panel40"){document.querySelectorAll(selector+" .tbs-grid-panel41 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel42 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel40 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"))}else if(panelName=="panel50"){document.querySelectorAll(selector+" .tbs-grid-panel51 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel52 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"));document.querySelectorAll(selector+" .tbs-grid-panel50 .tbs-grid-cell-select").forEach(cell=>cell.classList.remove("tbs-grid-cell-select"))}};TbsGrid.prototype.tbs_selectRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex){let selector="#"+this.gridId;let grid=this;if(arguments.length==2){startCellIndex=0;lastCellIndex=-1}if(lastRowIndex==-1){lastRowIndex=this.data_view.length-1}if(lastCellIndex==-1){lastCellIndex=this.columns.length-1}this.tbs_removePanelRange("panel40");this.tbs_removePanelRange("panel50");if(grid.topColumns.length>0)grid.classRange40.class_removeRange(0,-1,0,-1);if(grid.footerColumns.length>0)grid.classRange50.class_removeRange(0,-1,0,-1);this.tbs_setRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,"")};TbsGrid.prototype.tbs_setRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,type="add"){let selector="#"+this.gridId;let grid=this;this.startRowIndex=startRowIndex;this.startCellIndex=startCellIndex;this.lastRowIndex=lastRowIndex;this.lastCellIndex=lastCellIndex;let _startRowIndex=startRowIndex>lastRowIndex?lastRowIndex:startRowIndex;let _lastRowIndex=startRowIndex>lastRowIndex?startRowIndex:lastRowIndex;let _startCellIndex=startCellIndex>lastCellIndex?lastCellIndex:startCellIndex;let _lastCellIndex=startCellIndex>lastCellIndex?startCellIndex:lastCellIndex;this._startRowIndex=_startRowIndex;this._startCellIndex=_startCellIndex;this._lastRowIndex=_lastRowIndex;this._lastCellIndex=_lastCellIndex;if(type=="add"||this.selectRangeArray==0){let selectRange={};selectRange.startRowIndex=startRowIndex;selectRange.startCellIndex=startCellIndex;selectRange.lastRowIndex=lastRowIndex;selectRange.lastCellIndex=lastCellIndex;selectRange._startRowIndex=_startRowIndex;selectRange._startCellIndex=_startCellIndex;selectRange._lastRowIndex=_lastRowIndex;selectRange._lastCellIndex=_lastCellIndex;this.selectRangeArray.push(selectRange)}else{let selectRange=this.selectRangeArray[0];selectRange.startRowIndex=startRowIndex;selectRange.startCellIndex=startCellIndex;selectRange.lastRowIndex=lastRowIndex;selectRange.lastCellIndex=lastCellIndex;selectRange._startRowIndex=_startRowIndex;selectRange._startCellIndex=_startCellIndex;selectRange._lastRowIndex=_lastRowIndex;selectRange._lastCellIndex=_lastCellIndex}this.tbs_setRangeValue(_startRowIndex,_lastRowIndex,_startCellIndex,_lastCellIndex);if(this.fixedRowIndex==-1){topRowIndex=topRowIndex==undefined?this.tbs_getFirstRowIndex():this.fixedRowIndex+1}else{topRowIndex=topRowIndex==undefined?this.tbs_getFirstRowIndex():topRowIndex}this.tbs_displayPanel30(topRowIndex)};TbsGrid.prototype.tbs_setRangeValue=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex){let selector="#"+this.gridId;let grid=this;if(this.options[grid.option_selectMode]=="cell"){startRowIndex=startRowIndex;lastRowIndex=startRowIndex}let data=this.data_select_panel31;if(lastRowIndex==-1)lastRowIndex=data.length-1;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){let len=data.length;let bCount=false;for(let n=0;n<len;n++){if(rowIndex==data[n][0][0]){bCount=true;data[n][1][0]=1;break}}if(bCount==false){data.push([new Int32Array([rowIndex]),new Int8Array([1,0,0])])}}let column=this.columns;let columnLen=column.length;data=this.data_select_panel30;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){if(lastCellIndex==-1)lastCellIndex=column.length-1;let len=data.length;let bCount=false;for(let n=0;n<len;n++){if(rowIndex==data[n][0][0]){bCount=true;for(let colIndex=0;colIndex<columnLen;colIndex++){if(colIndex>=startCellIndex&&colIndex<=lastCellIndex){data[n][1][colIndex]=1}else{data[n][1][colIndex]=0}}break}}if(bCount==false){let array=[];for(let colIndex=0;colIndex<columnLen;colIndex++)array.push(0);let row=[new Int32Array([rowIndex]),new Int8Array(array)];for(let colIndex=0;colIndex<columnLen;colIndex++){if(colIndex>=startCellIndex&&colIndex<=lastCellIndex)row[1][colIndex]=1;else row[1][colIndex]=0}data.push(row)}}if(this.headerRowCount>1){function selectCell(trList,colIndex){for(let i=trList.length-1;i>=0;i--){let cell=trList[i].childNodes[colIndex];if(cell.style.display=="none")continue;else cell.classList.add("tbs-grid-cell-select")}}let trList=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table tbody tr");for(let x=startCellIndex;x<=lastCellIndex;x++)selectCell(trList,x);if(this.fixedColumnIndex!=-1){trList=document.querySelectorAll(selector+" .tbs-grid-panel22 .tbs-grid-table tbody tr");for(let x=startCellIndex;x<=lastCellIndex;x++)selectCell(trList,x)}}else{let tableCells=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table tbody tr:last-child td");for(let i=startCellIndex;i<=lastCellIndex;i++){tableCells[i].classList.add("tbs-grid-cell-select")}if(this.fixedColumnIndex!=-1){tableCells=document.querySelectorAll(selector+" .tbs-grid-panel22 .tbs-grid-table tbody tr:last-child td");for(let i=startCellIndex;i<=lastCellIndex;i++){tableCells[i].classList.add("tbs-grid-cell-select")}}}};TbsGrid.prototype.tbs_removeRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex){let selector="#"+this.gridId;let grid=this;if(this.startRowIndex!=-1)this.startRowIndex=-1;if(this.startCellIndex!=-1)this.startCellIndex=-1;if(this.lastRowIndex!=-1)this.lastRowIndex=-1;if(this.lastCellIndex!=-1)this.lastCellIndex=-1;if(this._startRowIndex!=-1)this._startRowIndex=-1;if(this._startCellIndex!=-1)this._startCellIndex=-1;if(this._lastRowIndex!=-1)this._lastRowIndex=-1;if(this._lastCellIndex!=-1)this._lastCellIndex=-1;if(this.topLineDiv.style.width!="0px")this.topLineDiv.style.width="0px";if(this.leftLineDiv.style.height!="0px")this.leftLineDiv.style.height="0px";if(this.bottomLineDiv.style.width!="0px")this.bottomLineDiv.style.width="0px";if(this.rightLineDiv.style.height!="0px")this.rightLineDiv.style.height="0px";this.data_select_panel30=[];this.data_select_panel31=[];this.selectRangeArray=[];document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table td").forEach(function(td){td.classList.remove("tbs-grid-cell-select")});if(this.fixedColumnIndex!=-1){document.querySelectorAll(selector+" .tbs-grid-panel22 .tbs-grid-table td").forEach(function(td){td.classList.remove("tbs-grid-cell-select")})}};TbsGrid.prototype.tbs_addRange=function(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex){let selector="#"+this.gridId;let grid=this;if(arguments.length==2){startCellIndex=0;lastCellIndex=-1}if(lastRowIndex==-1){lastRowIndex=this.data_view.length-1}if(lastCellIndex==-1){lastCellIndex=this.columns.length-1}this.tbs_setRange(startRowIndex,lastRowIndex,startCellIndex,lastCellIndex,topRowIndex,"add")};TbsGrid.prototype.excelExport=function(options){let selector="#"+this.gridId;let grid=this;let headerRowCount=this.headerRowCount;let headerColumns=this.headerColumnTable;let columns=this.columns;let rows=this.tbs_getRows();let table,thead,tbody,tr,th,td,input;table=document.createElement("table");table.style="border:1px solid #ccc;";thead=document.createElement("thead");tr=document.createElement("tr");let sumWidth=0;columns.map(column=>{th=document.createElement("th");th.style.width=column[grid.column_visible]==true?parseInt(column.width)+"px":"0px";th.style.display=column[grid.column_visible]==true?"":"none";sumWidth+=column[grid.column_visible]==true?parseInt(column.width):0;tr.appendChild(th)});thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");for(let i=0;i<headerColumns.length;i++){tr=document.createElement("tr");tr.style="height:"+this.rowHeight+"px";sumWidth=0;headerColumns[i].map(headerColumn=>{if(headerColumn[grid.column_name]){let td=document.createElement("td");if(i==0)td.rowSpan=headerRowCount;else if(i<len-1)td.rowSpan=headerRowCount-i;td.style="border:1px solid #ccc;background: #fcf1f4;";td.style.textAlign="center";let width=headerColumn["width"]!=""?headerColumn["width"]:"100";td.style.width=width+"px";sumWidth+=Number(width);let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.appendChild(div);let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");span.textContent=headerColumn[grid.column_text];div.appendChild(span);td.appendChild(div);tr.appendChild(td)}else if(headerColumn[grid.column_text]!=undefined){let td=document.createElement("td");td.colSpan=headerColumn[grid.column_colSpan];td.style="border:1px solid #ccc;background: #fcf1f4;";td.style.textAlign="center";let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");span.textContent=headerColumn[grid.column_text];div.appendChild(span);td.appendChild(div);tr.appendChild(td)}else{let td=document.createElement("td");td.style.display="none";td.classList.add("tbs-grid-cell");td.style.textAlign="center";let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");span.textContent=headerColumn[grid.column_text];div.appendChild(span);td.appendChild(div);tr.appendChild(td)}});tbody.appendChild(tr);rows.map(row=>{tr=document.createElement("tr");tr.style="height:"+this.rowHeight+"px";for(let x=0,len=columns.length;x<len;x++){let column=columns[x];let td=document.createElement("td");td.style="border:1px solid #ccc;";let width=column[grid.column_width]!=""?column[grid.column_width]:"100";td.style.width=width+"px";sumWidth+=Number(width);let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.appendChild(div);let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");span.textContent=row[column[grid.column_name]];div.appendChild(span);td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)})}table.appendChild(tbody);let type=options.type;let fileName=options.fileName;let blob=new Blob([table.outerHTML],{type:"application/vnd.ms-excel;charset=utf-8"});saveAs(blob,fileName)};TbsGrid.prototype.tbs_setFooterColumnDefaultValue=function(footerColumn){let selector="#"+this.gridId;let grid=this;let columnName=footerColumn[grid.column_name];footerColumn[grid.column_align]=grid.tbs_getColumnProperty(columnName,grid.column_align)};TbsGrid.prototype.tbs_setFooterColumns=function(columns){let selector="#"+this.id;let grid=this;grid.footerColumns=grid.tbs_copyJson(columns);for(let i=0,len=grid.footerColumns.length;i<len;i++){let footerColumn=grid.footerColumns[i];let columnName=footerColumn[grid.column_name];if(grid.null(footerColumn[grid.column_align]))footerColumn[grid.column_align]="center"}};TbsGrid.prototype.tbs_setFooterData=function(){let selector="#"+this.gridId;let grid=this;if(grid.footerColumns.length==0)return;let footerColumns=grid.footerColumns;grid.data_footer=[];let item={};item[grid.code_rowId]=grid.footerMaxRowId;grid.footerMaxRowId+=1;item[grid.code_mode]="";let columns=grid.columns;for(let colIndex=0,len=columns.length;colIndex<len;colIndex++){let column=columns[colIndex];let columnName=column[grid.column_name];item[columnName]=null}grid.data_footer.push(item);let footerRow=grid.data_footer[0];for(let i=0,colCount=footerColumns.length;i<colCount;i++){let footerColumn=footerColumns[i];let columnName=footerColumn[grid.column_name];if(grid.tbs_isColumnTypeNumber(columnName)==false)footerRow[columnName]=footerColumn[grid.column_name]}for(let rowIndex=0,len=grid.data_view.length;rowIndex<len;rowIndex++){let row=grid.data_view[rowIndex];for(let i=0,colCount=footerColumns.length;i<colCount;i++){let footerColumn=footerColumns[i];let columnName=footerColumn[grid.column_name];let sum=0;if(grid.tbs_isColumnTypeNumber(columnName)&&footerColumn[grid.column_summaryType]=="sum"){footerRow[columnName]+=parseFloat(row[columnName])}}}let rowCount=grid.tbs_getRowCount();for(let i=0,colCount=footerColumns.length;i<colCount;i++){let footerColumn=footerColumns[i];let columnName=footerColumn[grid.column_name];if(grid.tbs_isColumnTypeNumber(columnName)&&footerColumn[grid.column_summaryType]=="avg"){footerRow[columnName]=footerRow[columnName]/rowCount}}for(let i=0,len=grid.data_footer.length;i<len;i++){let row=grid.data_footer[0];for(let x=0,len2=grid.columns.length;x<len2;x++){let column=grid.columns[x];let columnName=grid.getColumnName(x);let value=grid.tbs_getFooterValue(i,columnName);grid.tbs_setFooterValue(i,columnName,value)}}};TbsGrid.prototype.tbs_getFooterValue=function(rowIndex,columnName){let column=this.tbs_getColumn(columnName);let columnType=column[this.column_type];let val=this.data_footer[rowIndex][columnName];if(columnType==this.code_number)return Number(val);else if(columnType==this.code_currency)return Number(val);else return val};TbsGrid.prototype.tbs_getFooterValueByIndex=function(rowIndex,colIndex){let columnName=this.tbs_getColumnName(colIndex);return this.tbs_getFooterValue(rowIndex,columnName)};TbsGrid.prototype.tbs_getFooterText=function(rowIndex,columnName){let grid=this;let column=grid.tbs_getColumn(columnName);let value=grid.tbs_getFooterValue(rowIndex,columnName);let result=grid.tbs_getFormat(column,value);return result.text};TbsGrid.prototype.tbs_setFooterValue=function(rowIndex,columnName,value){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(columnName);let result=grid.tbs_getFormat(column,value);grid.data_footer[rowIndex][columnName]=result.value};TbsGrid.prototype.tbs_setFooterValueByIndex=function(rowIndex,cellIndex,value){let columnName=this.tbs_getColumnName(cellIndex);this.tbs_setFooterValue(rowIndex,columnName,value)};TbsGrid.prototype.tbs_getFormatValue=function(col,value){let result=this.tbs_getFormat(col,value);return result.value};TbsGrid.prototype.tbs_getFormatText=function(col,value){let result=this.tbs_getFormat(col,value);return result.text};TbsGrid.prototype.tbs_getFormat=function(column,value){let grid=this;let result={};result.value=value;result.text=value;let colType=column[grid.column_type];let format=column[grid.column_format];if(colType==grid.code_number||colType==grid.code_currency){result=this.tbs_getFormatNumber(column,value);if(column[grid.column_visible]==false||column[grid.column_showZero]==false&&Number(result.value)==0){result.text=this.options[grid.option_zeroChar]}return result}else{if(this.null(value)){result.value="";result.text="";return result}if(colType==grid.code_combo){let data=column.renderer;let key=column.renderer.valueName;let val=column.renderer.labelName;for(let i=0,len=data.length;i<len;i++){if(data[i][key]==value){result.text=data[i][val];break}}return result}else if(colType=="date"){return this.tbs_getFormatDate(column,value)}else{result.text=value;return result}}};TbsGrid.prototype.tbs_getFormatNumber=function(column,value){let grid=this;const formatWon=function(n){let parts=n.toString().split(".");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return parts.join(".")};let result={};if(grid.null(value))result.value=null;else if(grid.tbs_trim(value)=="")result.value=null;else if(grid.tbs_substr(value.toString(),0,1)==".")result.value="0";else{value=value.toString().replace(grid.gridConfig.culture.currencyChar,"");result.value=value.toString().replace(/,/gi,"")}if(grid.null(result.value)){result.text=grid.options[grid.option_zeroChar];return result}result.text=result.value;let type=column[grid.column_type];let scale=column[grid.column_scale];let arr=scale.split(",");let decimalPoint=arr.length>1?this.tbs_trim(arr[1]):"0";if(decimalPoint=="")decimalPoint="0";let roundType=column[grid.column_roundType];let n=result.value==undefined||result.value==""?"0":result.value.toString();let dpLen=0;if(decimalPoint=="0"){dpLen=0;if(roundType=="round")n=parseFloat(this.tbs_round(n,dpLen));else if(roundType=="ceil")n=parseFloat(this.tbs_ceil(n,dpLen));else if(roundType=="floor")n=parseFloat(this.tbs_floor(n,dpLen));else parseFloat(this.tbs_round(n,dpLen));result.text=column[grid.column_commaUnit]=="0"?n:formatWon(n)}else if(decimalPoint!="0"){result.text=formatWon(parseFloat(n));if(column[grid.column_fixedScale]){dpLen=parseInt(decimalPoint);n=roundType=="ceil"?this.tbs_ceil(n,dpLen).toFixed(dpLen):roundType=="floor"?this.tbs_floor(n,dpLen).toFixed(dpLen):this.tbs_round(n,dpLen).toFixed(dpLen);result.text=column[grid.column_commaUnit]=="0"?n:formatWon(n)}else{dpLen=parseInt(decimalPoint);n=roundType=="ceil"?parseFloat(this.tbs_ceil(n,dpLen)):roundType=="floor"?parseFloat(this.tbs_floor(n,dpLen)):parseFloat(this.tbs_round(n,dpLen));result.text=column[grid.column_commaUnit]=="0"?n:formatWon(n)}}if(result.text=="0"){if(grid.options[grid.option_zeroChar]==false)result.text=grid.option_zeroChar}let regExp=new RegExp("","gi");result.text=result.text.replaceAll(",",column[grid.column_thousandChar]);result.text=result.text.replaceAll(".",column[grid.column_decimalChar]);if(type==grid.code_currency)result.text=column[grid.column_currencyChar]+result.text;return result};TbsGrid.prototype.tbs_getFormatDate=function(column,value){let grid=this;let result={};value=value.replace(/\./gi,"");value=value.replace(/\-/gi,"");value=value.replace(/\//gi,"");result.value=this.tbs_trim(value);result.text=result.value;if(result.value==""||result.value.length!=8){result.value="";result.text="";return result}let format=column[grid.column_format];let formatText=format.replace(/\./gi,"");formatText=formatText.replace(/\-/gi,"");formatText=formatText.replace(/\//gi,"");let dateText=result.text;let yyyy="";let MM="";let dd="";if(formatText=="yyyyMMdd"){yyyy=grid.tbs_substr(result.text,0,4);MM=grid.tbs_substr(result.text,4,2);dd=grid.tbs_substr(result.text,6,2)}else if(formatText=="ddMMyyyy"){yyyy=grid.tbs_substr(result.text,4,4);MM=grid.tbs_substr(result.text,2,2);dd=grid.tbs_substr(result.text,0,2)}else if(formatText=="MMddyyyy"){yyyy=grid.tbs_substr(result.text,4,4);MM=grid.tbs_substr(result.text,0,2);dd=grid.tbs_substr(result.text,2,2)}if(new Date(yyyy+"-"+MM+"-"+dd).toString()=="Invalid Date"){result.value="";result.text="";return result}format=format.replace("yyyy",yyyy);format=format.replace("MM",MM);format=format.replace("dd",dd);result.value=format;result.text=format;return result};TbsGrid.prototype.setGridConfig=function(tbsGridConfig){this.gridConfig=tbsGridConfig;this.options[this.option_zeroChar]=this.gridConfig.culture.zeroChar;this.options[this.option_imageRoot]=this.gridConfig.options.imageRoot};TbsGrid.prototype.tbs_click=function(e,grid,row,userFunction){let val=userFunction(e,grid,row);return val};TbsGrid.prototype.tbs_dblclick=function(e,grid,row,userFunction){let val=userFunction(e,grid,row);return val};TbsGrid.prototype.tbs_edit=function(e,grid,row,state,userFunction){let val=userFunction(e,grid,row,state);return val};TbsGrid.prototype.click=function(userFunction){this.user_click=userFunction};TbsGrid.prototype.dblclick=function(userFunction){this.user_dblclick=userFunction};TbsGrid.prototype.edit=function(userFunction){this.user_edit=userFunction};TbsGrid.prototype.editStart=function(userFunction){this.user_editStart=userFunction};TbsGrid.prototype.editing=function(userFunction){this.user_editing=userFunction};TbsGrid.prototype.editEnd=function(userFunction){this.user_editEnd=userFunction};TbsGrid.prototype.clickPageFirst=function(userFunction){this.user_clickPageFirst=userFunction};TbsGrid.prototype.clickPagePrev=function(userFunction){this.user_clickPagePrev=userFunction};TbsGrid.prototype.clickPageIndex=function(userFunction){this.user_clickPageIndex=userFunction};TbsGrid.prototype.clickPageNext=function(userFunction){this.user_clickPageNext=userFunction};TbsGrid.prototype.clickPageLast=function(userFunction){this.user_clickPageNext=userFunction};TbsGrid.prototype.setGridMode=function(gridMode){this.tbs_setGridMode(gridMode)};TbsGrid.prototype.apply=function(){this.tbs_apply()};TbsGrid.prototype.getHeaderColumn=function(rowIndex,columnIndex){return grid.tbs_getHeaderColumn(rowIndex,columnIndex)};TbsGrid.prototype.getHeaderColumnByNumber=function(num){return grid.tbs_getHeaderColumnByNumber(num)};TbsGrid.prototype.getColumn=function(columnName){return this.tbs_copyJson(this.tbs_getColumn(columnName))};TbsGrid.prototype.getColumnByIndex=function(columnIndex){return this.tbs_copyJson(this.tbs_getColumnByIndex(columnIndex))};TbsGrid.prototype.getColumns=function(){return this.tbs_copyJson(this.tbs_getColumns())};TbsGrid.prototype.getColumnName=function(columnIndex){return this.tbs_getColumnName(columnIndex)};TbsGrid.prototype.getColumnIndex=function(columnName){return this.tbs_getColumnIndex(columnName)};TbsGrid.prototype.setColumn=function(columnName,property,value){this.tbs_setColumn(columnName,property,value)};TbsGrid.prototype.setColumnByType=function(columnType,property,value){this.tbs_setColumnByType(columnType,property,value)};TbsGrid.prototype.addColumn=function(addColumn,targetRowIndex,targetColumnIndex,orderType){this.tbs_addColumn(addColumn,targetRowIndex,targetColumnIndex,orderType)};TbsGrid.prototype.removeColumn=function(targetRowIndex,targetColumnIndex){this.tbs_removeColumn(targetRowIndex,targetColumnIndex)};TbsGrid.prototype.setToolbar=function(toolbar){this.tbs_setToolbar(toolbar)};TbsGrid.prototype.setGrid=function(columns,options){this.tbs_setGrid(columns,options)};TbsGrid.prototype.setData=function(data,openDepth){this.tbs_setData(data,openDepth)};TbsGrid.prototype.getValue=function(rowIndex,columnName){return this.tbs_getValue(rowIndex,columnName)};TbsGrid.prototype.getValueByIndex=function(rowIndex,colIndex){return this.tbs_getValueByIndex(rowIndex,colIndex)};TbsGrid.prototype.getText=function(rowIndex,columnName){return this.tbs_getText(rowIndex,columnName)};TbsGrid.prototype.getTextByIndex=function(rowIndex,colIndex){return this.tbs_getTextByIndex(rowIndex,colIndex)};TbsGrid.prototype.setValue=function(rowIndex,columnName,value){this.tbs_setValue(rowIndex,columnName,value)};TbsGrid.prototype.setValueByIndex=function(rowIndex,colIndex,value){this.tbs_setValueByIndex(rowIndex,colIndex,value)};TbsGrid.prototype.setDataValue=function(rowIndex,columnName,value){this.tbs_setDataValue(rowIndex,columnName,value)};TbsGrid.prototype.applyData=function(){this.tbs_applyData()};TbsGrid.prototype.setComboData=function(keyName,valueName,comboData){return this.tbs_setComboData(keyName,valueName,comboData)};TbsGrid.prototype.getRowCount=function(){return this.tbs_getRowCount()};TbsGrid.prototype.getRow=function(rowIndex){return this.tbs_getRow(rowIndex)};TbsGrid.prototype.getRows=function(startRowIndex,endRowIndex){return this.tbs_getRows(startRowIndex,endRowIndex)};TbsGrid.prototype.getSelectedRow=function(){return this.tbs_getSelectedRow()};TbsGrid.prototype.getSelectedRows=function(){return this.tbs_getSelectedRows()};TbsGrid.prototype.setRange=function(rowIndex1,toRowIndex2,columnIndex1,columnIndex2){this.tbs_selectRange(rowIndex1,toRowIndex2,columnIndex1,columnIndex2)};TbsGrid.prototype.selectRange=function(rowIndex1,toRowIndex2,columnIndex1,columnIndex2){this.tbs_selectRange(rowIndex1,toRowIndex2,columnIndex1,columnIndex2)};TbsGrid.prototype.getCheckedRows=function(){return this.tbs_getCheckedRows()};TbsGrid.prototype.getChangedRowsData=function(){return this.tbs_getChangedRowsData()};TbsGrid.prototype.getDeletedRowsData=function(){return this.tbs_getDeletedRowsData()};TbsGrid.prototype.getUpdatedRowsData=function(){return this.tbs_getUpdatedRowsData()};TbsGrid.prototype.getInsertRowsData=function(){return this.tbs_getInsertedRowsData()};TbsGrid.prototype.addRow=function(row,type="bottom"){this.tbs_addRow(row,type)};TbsGrid.prototype.removeRows=function(rows){this.tbs_removeRows(rows)};TbsGrid.prototype.setColumn=function(columnName,columnProperty,value){this.tbs_setColumn(columnName,columnProperty,value)};TbsGrid.prototype.setColumnByType=function(columnType,columnProperty,value){this.tbs_setColumnByType(columnType,columnProperty,value)};TbsGrid.prototype.setTopColumns=function(topColumns){this.tbs_setTopColumns(topColumns)};TbsGrid.prototype.setFooterColumns=function(footerColumns){this.tbs_setFooterColumns(footerColumns)};TbsGrid.prototype.setFrozenColumn=function(fixedColumnIndex){this.tbs_setFrozenColumn(fixedColumnIndex)};TbsGrid.prototype.setFrozenRow=function(fixedRowIndex){let fixedRowCount=fixedRowIndex+1;this.tbs_setFrozenRow(fixedRowIndex,fixedRowCount)};TbsGrid.prototype.removeFrozenColumn=function(){this.tbs_removeFrozenColumn()};TbsGrid.prototype.removeFrozenRow=function(){this.tbs_removeFrozenRow()};TbsGrid.prototype.setOption=function(optionName,optionValue){this.tbs_setOption(optionName,optionValue)};TbsGrid.prototype.setOptions=function(options){this.tbs_setOptions(options)};TbsGrid.prototype.setTreeOption=function(optionName,optionValue){this.classTree.tbs_setTreeOption(optionName,optionValue)};TbsGrid.prototype.setTreeSortColumn=function(sortColumn){this.tbs_setTreeSortColumns(sortColumn)};TbsGrid.prototype.setPageOption=function(optionName,optionValue){this.classPage.tbs_setPageOption(optionName,optionValue)};TbsGrid.prototype.setGroupOption=function(optionName,optionValue){this.classGroup.tbs_setGroupOption(optionName,optionValue)};TbsGrid.prototype.setgroupColumns=function(groupColumns){this.tbs_setgroupColumns(groupColumns)};TbsGrid.prototype.tbs_createHeader=function(userColumns){let selector="#"+this.gridId;let grid=this;grid.tbs_setHeader(userColumns)};TbsGrid.prototype.tbs_setHeader=function(userColumns){let selector="#"+this.gridId;let grid=this;grid.tbs_createHeaderColumns(userColumns);grid.tbs_createHeaderColumnTable()};TbsGrid.prototype.tbs_createHeaderColumns=function(userColumns){let selector="#"+this.gridId;let grid=this;userColumns=grid.tbs_copyJson(userColumns);const getChildrenColumnCount=function(userColumn){let columnCount=0;const getCount=function(userColumn){if(userColumn[grid.column_children]){for(let i=0,len=userColumn[grid.column_children].length;i<len;i++){getCount(userColumn[grid.column_children][i])}}else columnCount+=1};getCount(userColumn);return columnCount};const getTreeDepth=function(userColumns,depth=0){let maxDepth=1;const getDepth=(userColumn,depth=1)=>{if(depth>maxDepth)maxDepth=depth;if(userColumn[grid.column_children]){for(let i=0,len=userColumn[grid.column_children].length;i<len;i++){getDepth(userColumn[grid.column_children][i],depth+1)}}};for(let i=0,len=userColumns.length;i<len;i++)getDepth(userColumns[i]);return maxDepth};const setNumber=function(userColumns,rowIndex,parentNum=0){userColumns.map(userColumn=>{userColumn[grid.column_num]=num=num+1;userColumn[grid.column_parentNum]=parentNum;userColumn[grid.column_rowIndex]=rowIndex;userColumn[grid.column_rowSpan]=userColumn[grid.column_children]?1:headerRowCount-rowIndex;userColumn[grid.column_colSpan]=getChildrenColumnCount(userColumn);if(userColumn[grid.column_children]){setNumber(userColumn[grid.column_children],rowIndex+1,num)}})};let num=0;let parentNum=0;let headerRowCount=grid.headerRowCount=getTreeDepth(userColumns);setNumber(userColumns,0);grid.headerColumns=userColumns;grid.tbs_createHeaderColumnTable()};TbsGrid.prototype.tbs_createHeaderColumnTable=function(){let selector="#"+this.gridId;let grid=this;const createHeaderColumns=function(userColumns){userColumns.map(userColumn=>{let headerColumn={};let kind=userColumn[grid.column_children]?"header":"column";if(kind=="column"){let columnName=userColumn[grid.column_name];let column=grid.tbs_getColumn(columnName);headerColumn[grid.column_name]=column[grid.column_name];headerColumn[grid.column_text]=column.header[grid.column_text];headerColumn[grid.column_align]=userColumn.header[grid.column_align]?userColumn.header[grid.column_align]:"center";headerColumn[grid.column_kind]=kind;headerColumn[grid.column_rowSpan]=userColumn[grid.column_rowSpan];headerColumn[grid.column_colSpan]=userColumn[grid.column_colSpan];headerColumn[grid.column_rowIndex]=userColumn[grid.column_rowIndex];headerColumn[grid.column_colIndex]=userColumn[grid.column_colIndex];headerColumn[grid.column_visible]=column[grid.column_visible]}else{headerColumn[grid.column_name]=userColumn[grid.column_name]?userColumn[grid.column_name]:"";headerColumn[grid.column_align]=userColumn[grid.column_align]?userColumn[grid.column_align]:"center";headerColumn[grid.column_children]=userColumn[grid.column_children];headerColumn[grid.column_text]=userColumn[grid.column_text];headerColumn[grid.column_kind]=kind;headerColumn[grid.column_rowSpan]=userColumn[grid.column_rowSpan];headerColumn[grid.column_colSpan]=userColumn[grid.column_colSpan];headerColumn[grid.column_rowIndex]=userColumn[grid.column_rowIndex];headerColumn[grid.column_colIndex]=userColumn[grid.column_colIndex];headerColumn[grid.column_fromcol]=userColumn[grid.column_fromcol];headerColumn[grid.column_tocol]=userColumn[grid.column_tocol];headerColumn[grid.column_visible]=userColumn[grid.column_visible];headerColumn[grid.column_subRowSpan]=1;headerColumn[grid.column_subColSpan]=1;headerColumn[grid.column_className]=userColumn[grid.column_className];if(grid.null(headerColumn[grid.column_visible]))headerColumn[grid.column_visible]=true}headerColumn[grid.column_num]=userColumn[grid.column_num];headerColumn[grid.column_parentNum]=userColumn[grid.column_parentNum];let rowIndex=headerColumn[grid.column_rowIndex];let childrenCount=headerColumn[grid.column_children]?headerColumn[grid.column_children].length:0;let columnCount=headerColumn[grid.column_colSpan];headerColumnRows[rowIndex].push(headerColumn);let blankColumn={};blankColumn[grid.column_text]=headerColumn[grid.column_text];blankColumn[grid.column_kind]="empty";blankColumn[grid.column_rowSpan]=1;blankColumn[grid.column_colSpan]=1;blankColumn[grid.column_rowIndex]=0;blankColumn[grid.column_colIndex]=0;blankColumn[grid.column_visible]=false;blankColumn[grid.column_align]="";blankColumn[grid.column_subRowSpan]=1;blankColumn[grid.column_subColSpan]=1;if(childrenCount==0){for(let i=rowIndex+1;i<headerRowCount;i++)headerColumnRows[i].push(blankColumn)}if(columnCount>1){for(let i=1;i<columnCount;i++)headerColumnRows[rowIndex].push(blankColumn)}if(userColumn[grid.column_children]){createHeaderColumns(userColumn[grid.column_children])}})};let headerColumnRows=[];let headerRowCount=grid.headerRowCount;for(let i=0;i<headerRowCount;i++)headerColumnRows[i]=[];createHeaderColumns(grid.headerColumns);headerColumnRows.map((columns,rowIndex)=>{columns.map((column,colIndex)=>{column[grid.column_rowIndex]=rowIndex;column[grid.column_colIndex]=colIndex;delete column[grid.column_children]})});grid.headerColumnTable=headerColumnRows};TbsGrid.prototype.tbs_getDisplayedHeaderColumn=function(panelName="panel30"){let selector="#"+this.gridId;let grid=this;let columns=this.columns;if(panelName=="panel32"||panelName=="panel42"||panelName=="panel52"||panelName=="panel62"){let startColumnIndex=0;let lastColumnIndex=this.fixedColumnIndex;return{startColumnIndex:startColumnIndex,lastColumnIndex:lastColumnIndex}}else{let startColumnIndex=0;let lastColumnIndex=columns.length-1;if(this.fixedColumnIndex!=-1)startColumnIndex=this.fixedColumnIndex+1;return{startColumnIndex:startColumnIndex,lastColumnIndex:lastColumnIndex}}};TbsGrid.prototype.tbs_getHeaderColumn=function(rowIndex,columnIndex){let selector="#"+this.gridId;let grid=this;return grid.headerColumnTable[rowIndex][columnIndex]==undefined?null:grid.headerColumnTable[rowIndex][columnIndex]};TbsGrid.prototype.tbs_getHeaderColumnByNumber=function(num){let selector="#"+this.gridId;let grid=this;let result;const getParentColumn=function(headerColumn){if(headerColumn[grid.column_num]==num){result=headerColumn;return}if(headerColumn[grid.column_children]){for(let i=0,len=headerColumn[grid.column_children].length;i<len;i++){getParentColumn(headerColumn[grid.column_children][i])}}};for(let i=0;i<grid.headerColumns.length;i++)getParentColumn(grid.headerColumns[i]);return result};TbsGrid.prototype.tbs_getHeaderPropertyByIndex=function(columnIndex,property){let grid=this;let column=grid.columns[columnIndex];let result=grid.null(column.header[property])?null:column.header[property];return result};TbsGrid.prototype.tbs_getHeaderProperty=function(columnName,property){let grid=this;let columnIndex=grid.tbs_getColumnIndex(columnName);return grid.tbs_getHeaderPropertyByIndex(columnIndex,property)};TbsGrid.prototype.event_input=function(){let selector="#"+this.gridId;let grid=this;let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let colType=input.dataset.type;const keydownEvent=function(e){let input=document.querySelector(selector+" .tbs-grid-input");let mode=input.dataset.mode;if(mode==undefined)mode="";if(e.ctrlKey){if(e.keyCode==37&&mode==""){if(!grid.options[grid.option_addRow])return;grid.tbs_editEnd();grid.tbs_addRow("up");grid.input_focus()}else if(e.keyCode==39&&mode==""){if(!grid.options[grid.option_addRow])return;grid.tbs_editEnd();grid.tbs_addRow("down");grid.input_focus()}else if(e.keyCode==38&&mode==""){if(!grid.options[grid.option_addRow])return;grid.tbs_editEnd();grid.tbs_addRow("first");grid.input_focus()}else if(e.keyCode==40&&mode==""){if(!grid.options[grid.option_addRow])return;grid.tbs_editEnd();grid.tbs_addRow("last");grid.input_focus()}else if(e.keyCode==46&&mode==""){if(!grid.options[grid.option_addRow])return;grid.tbs_editEnd();grid.tbs_removeRow();grid.input_focus()}}else{if(e.keyCode==37&&mode==""){grid.tbs_editEnd();grid.tbs_moveCell("left");grid.input_focus()}else if(e.keyCode==39&&mode==""){grid.tbs_editEnd();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==38&&mode==""){grid.tbs_editEnd();grid.tbs_moveCell("up");grid.input_focus()}else if(e.keyCode==40&&mode==""){grid.tbs_editEnd();grid.tbs_moveCell("down");grid.input_focus()}else if(e.keyCode==13&&mode==""){grid.tbs_editEnd();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==9&&mode==""){grid.tbs_editEnd();e.preventDefault();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==37&&mode=="key"){}else if(e.keyCode==39&&mode=="key"){}else if(e.keyCode==38&&mode=="key"){grid.tbs_editEnd();grid.tbs_moveCell("up");grid.input_focus()}else if(e.keyCode==40&&mode=="key"){grid.tbs_editEnd();grid.tbs_moveCell("down");grid.input_focus()}else if(e.keyCode==13&&mode=="key"){grid.tbs_editEnd();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==9&&mode=="key"){grid.tbs_editEnd();e.preventDefault();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==37&&mode=="mouse"){}else if(e.keyCode==39&&mode=="mouse"){}else if(e.keyCode==38&&mode=="mouse"){grid.tbs_editEnd();grid.tbs_moveCell("up");grid.input_focus()}else if(e.keyCode==40&&mode=="mouse"){grid.tbs_editEnd();grid.tbs_moveCell("down");grid.input_focus()}else if(e.keyCode==13&&mode=="mouse"){grid.tbs_editEnd();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode==9&&mode=="mouse"){grid.tbs_editEnd();e.preventDefault();grid.tbs_moveCell("right");grid.input_focus()}else if(e.keyCode>=0&&e.keyCode<=7){}else if(e.keyCode>=9&&e.keyCode<=32){}else if(e.keyCode==8){}else if(e.keyCode==127){}else if(e.ctrlKey||e.keyCode==9||e.keyCode==46){}else if(e.keyCode>=112&&e.keyCode<=123){}else{console.log("input");let cellIndex=grid.startCellIndex;let column=grid.tbs_getColumnByIndex(cellIndex);if(grid.notNull(column[grid.column_editable])&&column[grid.column_editable]){if(grid.notNull(grid.user_edit)){if(panelInput.style.left=="30000px"){grid.tbs_editStart(e,"key")}else{grid.tbs_editing(e,"key")}}else{grid.input_show(e,"key")}}}}};const keyupEvent=function(e){let input=document.querySelector(selector+" .tbs-grid-input");let colType=input.dataset.type};const clickEvent=function(e){let column=grid.columns;let input=document.querySelector(selector+" .tbs-grid-input");let colType=grid.columns[grid.startCellIndex][grid.column_type]};const blurEvent=function(e){let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");let input_icon=document.querySelector(selector+" .tbs-grid-panel-input-icon");let mode=input.dataset.mode;let rowIndex=input.dataset.rowIndex;let cellIndex=input.dataset.cellIndex;let column=grid.columns[cellIndex];if(rowIndex==undefined||cellIndex==undefined){grid.input_hide();return}if(grid.popupActive==1){grid.input_focus();return}if(input.dataset.mode==undefined||input.dataset.mode==""){e.stopImmediatePropagation()}if(rowIndex==-1||cellIndex==-1)return;if(grid.notNull(grid.user_edit)){grid.tbs_editEnd(e,"key")}else{if(isNaN(cellIndex))return;let s=input.value;if(column[grid.column_type]==grid.code_combo)s=input_code.value;else if(column[grid.column_type]=="number"&&grid.tbs_trim(s)==grid.options[grid.option_zeroChar])s="0";else if(column[grid.column_type]=="currency"&&grid.tbs_trim(s)==grid.options[grid.option_zeroChar])s="0";grid.tbs_setValueByIndex(rowIndex,cellIndex,grid.tbs_getFormatValue(column,s));grid.input_hide()}grid.tbs_apply()};const wheelEvent=function(e){};const copyEvent=function(e){let ta=document.createElement("textarea");let s="";if(grid.classRange40.data_select_panel30.length>0){let startRowIndex=0;let startCellIndex=grid.classRange40._startCellIndex;let lastRowIndex=0;let lastCellIndex=grid.classRange40._lastCellIndex;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){for(let colIndex=startCellIndex;colIndex<=lastCellIndex;colIndex++){let val=grid.tbs_getTopValueByIndex(rowIndex,colIndex);if(grid.null(val))val="";s+=val;if(colIndex<lastCellIndex)s+="\t"}if(rowIndex<lastRowIndex)s+="\r\n"}ta.textContent=s;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta)}else if(grid.classRange50.data_select_panel30.length>0){let startRowIndex=0;let startCellIndex=grid.classRange50._startCellIndex;let lastRowIndex=0;let lastCellIndex=grid.classRange50._lastCellIndex;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){for(let colIndex=startCellIndex;colIndex<=lastCellIndex;colIndex++){let val=grid.tbs_getFooterValueByIndex(rowIndex,colIndex);if(grid.null(val))val="";s+=val;if(colIndex<lastCellIndex)s+="\t"}if(rowIndex<lastRowIndex)s+="\r\n"}ta.textContent=s;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta)}else{let startRowIndex=grid._startRowIndex;let startCellIndex=grid._startCellIndex;let lastRowIndex=grid._lastRowIndex;let lastCellIndex=grid._lastCellIndex;for(let rowIndex=startRowIndex;rowIndex<=lastRowIndex;rowIndex++){for(let colIndex=startCellIndex;colIndex<=lastCellIndex;colIndex++){let val=grid.tbs_getValueByIndex(rowIndex,colIndex);if(grid.null(val))val="";s+=val;if(colIndex<lastCellIndex)s+="\t"}if(rowIndex<lastRowIndex)s+="\r\n"}ta.textContent=s;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta)}};const pasteEvent=function(e){let data=e.clipboardData.getData("text/plain");let startRowIndex=grid.startRowIndex;let startCellIndex=grid.startCellIndex;let td=grid.tbs_getSelectedTableCell();if(td=="undefined"||td==null)return;let rowArray=data.split("\r\n");let i=0;for(let rowIndex=startRowIndex;rowIndex<startRowIndex+rowArray.length;rowIndex++){if(rowIndex>=grid.data_view.length)break;let colArray=rowArray[i].split("\t");let j=0;for(let colIndex=startCellIndex;colIndex<startCellIndex+colArray.length;colIndex++){if(grid.columns[colIndex][grid.column_editable]==false)continue;grid.tbs_setValueByIndex(rowIndex,colIndex,colArray[j]);j+=1}i+=1}grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())};const cutEvent=function(e){};input.addEventListener("keydown",keydownEvent,true);input.addEventListener("keyup",keyupEvent,true);input.addEventListener("click",clickEvent,true);input.addEventListener("blur",blurEvent,true);input.addEventListener("wheel",wheelEvent,true);input.addEventListener("copy",copyEvent,true);input.addEventListener("paste",pasteEvent,true);input.addEventListener("cut",cutEvent,true)};TbsGrid.prototype.event_input_icon=function(){let selector="#"+this.gridId;let grid=this;let input_icon=document.querySelector(selector+" .tbs-grid-panel-input-icon");let colType=input_icon.dataset.type;const mousedownEvent=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");let input_panel=document.querySelector(selector+" .tbs-grid-input-panel");let column=grid.columns[grid.startCellIndex];let colType=grid.columns[grid.startCellIndex][grid.column_type];if(colType=="date"){grid.tbsGridDate=new TbsGridDate(grid,column,input)}else if(colType==grid.code_combo){grid.tbsGridCombo=new TbsGridCombo(grid,column,input,input_code)}};input_icon.addEventListener("mousedown",mousedownEvent)};TbsGrid.prototype.input_show=function(e,mode){let selector="#"+this.gridId;let grid=this;let lineWeight=3;let rowIndex=grid.startRowIndex;let cellIndex=grid.startCellIndex;let columns=grid.columns;let column=columns[cellIndex];let colType=column[grid.column_type];let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");let input_icon=document.querySelector(selector+" .tbs-grid-panel-input-icon");let panelMain=document.querySelector(selector+" .tbs-grid-main");let td=document.querySelector(selector+" .tbs-grid-group30 .tbs-grid-cell-start");if(td==null)return;let value=this.tbs_getValue(rowIndex,column[grid.column_name]);let result=this.tbs_getFormat(column,value);if(column[grid.column_editable]==false)return;grid.tbs_moveCellLine(td,rowIndex,cellIndex);let left=td.getBoundingClientRect().left;let top=td.getBoundingClientRect().top;let leftMain=panelMain.getBoundingClientRect().left;let topMain=panelMain.getBoundingClientRect().top;if(mode=="mouse"){if(colType=="number"&&grid.tbs_trim(result.text)==grid.options[grid.option_zeroChar])input.value="0";else input.value=result.text;input_code.value=result.value}panelInput.style.top=top-topMain+lineWeight+"px";panelInput.style.left=left-leftMain+lineWeight+"px";panelInput.style.height=grid.rowHeight-lineWeight+"px";input.dataset.mode=mode;input.dataset.type=colType;input.dataset.rowIndex=grid.startRowIndex;input.dataset.cellIndex=grid.startCellIndex;input.dataset.click="";if(colType=="date"){let width=parseInt(column[[grid.column_width]]);panelInput.style.width=width-15-3+"px";input_icon.style.display="";input_icon.style.top=top+"px";input_icon.style.left=`${left+width-15}px`;input_icon.dataset.type=colType;input_icon.src=grid.gridConfig.options.imageRoot+"calendar.png"}else if(colType==grid.code_combo){let width=parseInt(column[[grid.column_width]]);panelInput.style.width=width-15-3+"px";input_icon.style.display="";input_icon.style.top=top+"px";input_icon.style.left=`${left+width-15}px`;input_icon.dataset.type=colType;input_icon.src=grid.gridConfig.options.imageRoot+"down-arrow.png"}else{input_icon.style.diplay="none";input.style.backgroundRepeat="";input.style.backgroundImage="";input.style.backgroundPosition="";input.style.backgroundSize="";panelInput.style.width=parseInt(column[[grid.column_width]])-lineWeight+"px"}if(mode=="mouse")input.select()};TbsGrid.prototype.input_hide=function(){let selector="#"+this.gridId;let grid=this;let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");let input_icon=document.querySelector(selector+" .tbs-grid-panel-input-icon");let input_panel=document.querySelector(selector+" .tbs-grid-input-panel");panelInput.style.left="30000px";panelInput.style.width="0px";input.value="";input_code.value="";input.dataset.rowIndex=-1;input.dataset.cellIndex=-1;input.dataset.mode="";input.dataset.type="";input_icon.style.display="none";input_icon.dataset.rowIndex=-1;input_icon.dataset.cellIndex=-1;input_icon.dataset.mode="";input_icon.dataset.type="";input_panel.innerHTML="";input_panel.style.width="0px";input_panel.style.left="30000px";input_panel.dataset.rowIndex=-1;input_panel.dataset.cellIndex=-1;input_panel.dataset.mode="";input_panel.dataset.type="";if(this.tbsGridDate){this.tbsGridDate.tbs_destroy();this.tbsGridDate=null}if(this.tbsGridCombo){this.tbsGridCombo.tbs_destroy();this.tbsGridCombo=null}};TbsGrid.prototype.input_focus=function(){let selector="#"+this.gridId;let grid=this;if(this.null(this.mobile))document.querySelector(selector+" .tbs-grid-input").focus()};TbsGrid.prototype.tbs_editStart=function(e,mode){let selector="#"+this.gridId;let grid=this;let state=0;let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");let result=true;let rowIndex=state==0?grid.startRowIndex:input.dataset.rowIndex;let cellIndex=state==0?grid.startCellIndex:input.dataset.cellIndex;let column=grid.tbs_getColumnByIndex(cellIndex);let columnName=grid.tbs_getColumnName(cellIndex);let value=grid.tbs_getValue(rowIndex,columnName);let text=grid.tbs_getText(rowIndex,columnName);let eventData={};let eventRow=grid.tbs_getRow(rowIndex);eventRow.rowIndex=rowIndex;eventRow.columnIndex=cellIndex;eventRow.columnName=columnName;eventRow.value=value;eventRow.text=text;eventRow.state=state;eventRow.newValue=input.value;eventRow.data=eventRow;if(column[grid.column_editable]==true&&grid.notNull(grid.user_edit)){let result=true;result=grid.tbs_edit(e,grid,state,eventRow,grid.user_edit);if(grid.null(result)||result==true){grid.input_show(e,mode)}else{document.querySelector(selector+" .tbs-grid-input").blur()}}};TbsGrid.prototype.tbs_editing=function(e,mode){let selector="#"+this.gridId;let grid=this;let state=1;let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");if(input.dataset.cellIndex==-1){grid.input_hide();return}let result=true;let rowIndex=state==0?grid.startRowIndex:input.dataset.rowIndex;let cellIndex=state==0?grid.startCellIndex:input.dataset.cellIndex;let column=grid.tbs_getColumnByIndex(cellIndex);let columnName=grid.tbs_getColumnName(cellIndex);let value=grid.tbs_getValue(rowIndex,columnName);let text=grid.tbs_getText(rowIndex,columnName);let eventData={};let eventRow=grid.tbs_getRow(rowIndex);eventRow.rowIndex=rowIndex;eventRow.columnIndex=cellIndex;eventRow.columnName=columnName;eventRow.value=value;eventRow.text=text;eventRow.state=state;eventRow.newValue=input.value;eventRow.data=eventRow;if(column[grid.column_editable]==true&&grid.notNull(grid.user_edit)){let result=true;if(state==1&&panelInput.style.left!="30000px"){result=grid.tbs_edit(e,grid,state,eventRow,grid.user_edit);if(grid.null(result)||result==true){}else{grid.input_hide();grid.tbs_apply()}}}};TbsGrid.prototype.tbs_editEnd=function(e,mode){let selector="#"+this.gridId;let grid=this;let state=2;let panelInput=document.querySelector(selector+" .tbs-grid-panel-input");let input=document.querySelector(selector+" .tbs-grid-input");let input_code=document.querySelector(selector+" .tbs-grid-input-code");if(grid.null(input.dataset.cellIndex)||input.dataset.cellIndex==-1){grid.input_hide()}else{let result=true;let rowIndex=state==0?grid.startRowIndex:input.dataset.rowIndex;let cellIndex=state==0?grid.startCellIndex:input.dataset.cellIndex;let column=grid.tbs_getColumnByIndex(cellIndex);let columnName=grid.tbs_getColumnName(cellIndex);let value=grid.tbs_getValue(rowIndex,columnName);let text=grid.tbs_getText(rowIndex,columnName);let eventData={};let eventRow=grid.tbs_getRow(rowIndex);eventRow.rowIndex=rowIndex;eventRow.columnIndex=cellIndex;eventRow.columnName=columnName;eventRow.value=value;eventRow.text=text;eventRow.state=state;eventRow.newValue=input.value;eventRow.data=eventRow;if(column[grid.column_editable]==true&&grid.notNull(grid.user_edit)){let result=true;if(state==2&&panelInput.style.left!="30000px"){result=grid.tbs_edit(e,grid,state,eventRow,grid.user_edit);if(grid.null(result)||result==true){let s=input.value;if(column[grid.column_type]==grid.code_combo)s=input_code.value;grid.tbs_setValueByIndex(rowIndex,cellIndex,grid.tbs_getFormatValue(column,s));grid.input_hide();grid.tbs_apply()}else{grid.input_hide();grid.tbs_apply()}}}}document.querySelector(selector+" .tbs-grid-input").blur()};TbsGrid.prototype.tbs_isSortableColumn=function(columnName){let selector="#"+this.gridId;let grid=this;let result=false;result=grid.options[grid.option_sortable];return result};TbsGrid.prototype.tbs_isResizableColumn=function(columnName){let selector="#"+this.gridId;let grid=this;let result=false;result=grid.options[grid.option_resizable];return result};TbsGrid.prototype.tbs_isMovableColumn=function(columnName){let selector="#"+this.gridId;let grid=this;let result=false;result=grid.options[grid.option_movable];return result};TbsGrid.prototype.tbs_isAutoResizableColumn=function(columnName){let selector="#"+this.gridId;let grid=this;let result=false;result=grid.options[grid.option_autoResizable];return result};TbsGrid.prototype.tbs_isAutoWidthColumn=function(columnName){let selector="#"+this.gridId;let grid=this;let result=false;result=grid.options[grid.option_autoWidth];return result};TbsGrid.prototype.tbs_isClassName=function(element,className){let selector="#"+this.gridId;let grid=this;let result=element.classList.contains(className);return result};TbsGrid.prototype.tbs_isNotValidColumnType=function(columnType){let arr=["string","number","combo","date"];return arr.indexOf(columnType)==-1?true:false};TbsGrid.prototype.tbs_isInPanel=function(e,panelName,startX,startY){let selector="#"+this.gridId;let grid=this;let lastX=this.lastX;let lastY=this.lastY;let moveX=lastX-startX;let moveY=lastY-startY;let panel=document.querySelector(selector+" .tbs-grid-"+panelName);let absRect=grid.tbs_getOffset(panel);let rect=panel.getBoundingClientRect();let groupTop=absRect.top;let groupBottom=absRect.top+rect.height;let groupLeft=absRect.left;let groupRight=absRect.left+rect.width;if(lastX<groupLeft||lastX>groupRight||lastY<groupTop||lastY>groupBottom)return false;else return true};TbsGrid.prototype.tbs_isSelectedCell=function(panelName,rowIndex,cellIndex){let result=0;let rows=[];if(panelName=="panel31")rows=this.data_select_panel31;else if(panelName=="panel32")rows=this.data_select_panel30;else if(panelName=="panel30")rows=this.data_select_panel30;else if(panelName=="panel41")rows=this.classRange40.data_select_panel31;else if(panelName=="panel42")rows=this.classRange40.data_select_panel30;else if(panelName=="panel40")rows=this.classRange40.data_select_panel30;else if(panelName=="panel51")rows=this.classRange50.data_select_panel31;else if(panelName=="panel52")rows=this.classRange50.data_select_panel30;else if(panelName=="panel50")rows=this.classRange50.data_select_panel30;else if(panelName=="panel61")rows=this.data_select_panel31;else if(panelName=="panel62")rows=this.data_select_panel30;else if(panelName=="panel60")rows=this.data_select_panel30;else rows=this.data_select_panel30;for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(rowIndex==row[0][0]){result=row[1][cellIndex];break}}return result};TbsGrid.prototype.tbs_isSelectedHeaderCell=function(panelName,cellIndex){let result=0;let rows=this.data_select_panel30;for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(row[1][cellIndex]==1){result=row[1][cellIndex];break}}return result};TbsGrid.prototype.tbs_isSelectedCell31=function(rowIndex,cellIndex){let result=0;let rows=this.data_select_panel31;for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(rowIndex==row[0][0]){result=row[1][cellIndex];break}}return result};TbsGrid.prototype.tbs_isSelectedCell30=function(rowIndex,cellIndex){let result=0;let rows=this.data_select_panel30;for(let i=0,len=rows.length;i<len;i++){let row=rows[i];if(rowIndex==row[0][0]){result=row[1][cellIndex];break}}return result};TbsGrid.prototype.tbs_isColumnName=function(columnName){let grid=this;let result=false;for(let i=0,len=this.columns.length;i<len;i++){let column=this.columns[i];if(columnName==column[grid.column_name]){result=true;break}}return result};TbsGrid.prototype.tbs_isColumnTypeNumber=function(columnName){let grid=this;let result=false;let column=grid.getColumn(columnName);if(column[grid.column_type]==grid.code_number||column[grid.column_type]==grid.code_currency)result=true;return result};TbsGrid.prototype.tbs_isSortColumnName=function(columnName){let grid=this;let result=false;for(let i=0,len=this.classSort.sortColumns.length;i<len;i++){let sortColumn=this.classSort.sortColumns[i];if(columnName==sortColumn[grid.column_name]){result=true;break}}return result};TbsGrid.prototype.tbs_isFilterColumnName=function(columnName){let grid=this;let result=false;for(let i=0,len=this.filterColumns.length;i<len;i++){let filterColumn=this.filterColumns[i];if(columnName==filterColumn[grid.column_name]){result=true;break}}return result};TbsGrid.prototype.tbs_isLastTopRowIndex=function(rowIndex){let grid=this;let result=false;let rowCount=grid.getRowCount()-1;if(grid.pageIntRowCount>=rowCount-rowIndex+1){return true}return result};TbsGrid.prototype.tbs_createFrame=function(){let selector="#"+this.gridId;let grid=this;let s="";s+='<div class="tbs-grid" tabindex="1" style="">';let isShowToolbar=grid.options.toolbar[grid.toolbar_visible]?"tbs-show":"tbs-hide";s+='<div class="tbs-grid-panel10 '+isShowToolbar+'">';s+='  <div class="tbs-grid-panel10-wrap">';s+='    \t<div class="tbs-grid-panel10-filter" style="display:none;">';s+='    \t\t<input class="tbs-grid-panel10-filter-input" placeholder="Search">';s+="    \t</div>";s+='    \t<div class="tbs-grid-panel10-page" style="display:none;">';s+='          <div class="tbs-grid-panel10-page-first">first</div>';s+='          <div class="tbs-grid-panel10-page-prev">prev</div>';s+='          <div class="tbs-grid-panel10-page-select">1</div>';s+='          <div class="tbs-grid-panel10-page-next">next</div>';s+='          <div class="tbs-grid-panel10-page-last">last</div>';s+="    \t</div>";s+='    \t<div class="tbs-grid-panel10-buttons" style="display:;">';s+='          <div class="tbs-grid-panel10-buttons-wrap">';s+='              <div class="tbs-grid-panel10-buttons-filter">Filter</div>';s+='              <div class="tbs-grid-panel10-buttons-filter-reset">Reset</div>';s+='              <div class="tbs-grid-panel10-buttons-sort">Sorting</div>';s+='              <div class="tbs-grid-panel10-buttons-sort-reset">Reset</div>';s+='              <div class="tbs-grid-panel10-buttons-group">Grouping</div>';s+='              <div class="tbs-grid-panel10-buttons-group-reset">Reset</div>';s+="          </div>";s+="    \t</div>";s+="  </div>";s+="</div>";if(grid.options[grid.option_groupVisible]==true)s+='<div class="tbs-grid-panel80 tbs-show"></div>';else s+='<div class="tbs-grid-panel80 tbs-hide"></div>';if(grid.options[grid.option_sortVisible]==true)s+='<div class="tbs-grid-panel90 tbs-show"></div>';else s+='<div class="tbs-grid-panel90 tbs-hide"></div>';s+='  <div class="tbs-grid-main">';s+='  \t<div class="tbs-grid-wrap">';s+='  \t    <div class="tbs-grid-group21">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel21"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel22"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group20">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel20"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group71">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel71"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel72"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group70">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel70"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group41">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel41"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel42"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group40">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel40"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group61">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel61"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel62"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group60">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel60"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group31">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel31"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel32"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group30">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel30"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group51">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel51"><table class="tbs-grid-table"></table></div>';s+='  \t    \t\t<div class="tbs-grid-panel52"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+='  \t    <div class="tbs-grid-group50">';s+='  \t    \t<div class="tbs-grid-panel">';s+='  \t    \t\t<div class="tbs-grid-panel50"><table class="tbs-grid-table"></table></div>';s+="  \t\t\t</div>";s+="  \t\t</div>";s+="  \t</div>";s+='  \t<div class="tbs-grid-vertical-scroll" style="display:none;">';s+='  \t\t<div class="tbs-grid-vertical-scroll-wrap">';s+='  \t\t\t<div class="tbs-grid-vertical-scroll-bar"></div>';s+="  \t\t</div>";s+='  \t\t<div class="tbs-grid-vertical-scroll-up"><div>â–²</div></div>';s+='  \t\t<div class="tbs-grid-vertical-scroll-down"><div>â–¼</div></div>';s+="  \t</div>";s+='  \t<div class="tbs-grid-horizontal-scroll" style="display:none;">';s+='  \t\t<div class="tbs-grid-horizontal-scroll-wrap">';s+='  \t\t\t   <div class="tbs-grid-horizontal-scroll-bar"></div>';s+="  \t\t</div>";s+='  \t\t<div class="tbs-grid-horizontal-scroll-left"><div>â—€</div></div>';s+='  \t\t<div class="tbs-grid-horizontal-scroll-right"><div>â–¶</div></div>';s+="  \t</div>";s+='  \t<div class="tbs-grid-vertical-scroll60" style="display:none;">';s+='  \t\t<div class="tbs-grid-vertical-scroll60-wrap">';s+='  \t\t\t<div class="tbs-grid-vertical-scroll6-bar"></div>';s+="  \t\t</div>";s+='  \t\t<div class="tbs-grid-vertical-scroll60-up">â–²</div>';s+='  \t\t<div class="tbs-grid-vertical-scroll60-down">â–¼</div>';s+="  \t</div>";s+='  \t<div class="tbs-grid-horizontal-scroll32" style="display:none;">';s+='  \t\t<div class="tbs-grid-horizontal-scroll32-wrap">';s+='  \t\t\t   <div class="tbs-grid-horizontal-scroll2-bar"></div>';s+="  \t\t</div>";s+='  \t\t<div class="tbs-grid-horizontal-scroll32-left"><div>â—€</div></div>';s+='  \t\t<div class="tbs-grid-horizontal-scroll32-right"><div>â–¶</div></div>';s+="  \t</div>";s+='  \t<div class="tbs-grid-scroll-box" \tstyle="display:none;"></div>';s+='  \t<div class="tbs-grid-top-line" \t\tstyle="left:30000px;"></div>';s+='  \t<div class="tbs-grid-bottom-line" \tstyle="left:30000px;"></div>';s+='  \t<div class="tbs-grid-left-line" \tstyle="left:30000px;"></div>';s+='  \t<div class="tbs-grid-right-line" \tstyle="left:30000px;"></div>';s+='  \t<div class="tbs-grid-input-panel" \tstyle="left:30000px;"></div>';s+=' \t\t<div class="tbs-grid-canvas"></div>';s+='     <div class="tbs-grid-panel-input">';s+='        <input type="text" class="tbs-grid-input"  data-type="" data-click=""/>';s+='        <img class="tbs-grid-panel-input-icon" data-type="" data-click="" />';s+="     </div>";s+='     <input type="text" class="tbs-grid-input-code" data-type="" data-click="" style="left:30000px;"/>';s+="\t</div>";s+='  <div class="tbs-grid-layer" style="left:30000px;display: none;"></div>';s+="</div>";document.querySelector(selector).innerHTML=s;document.querySelector(selector+" .tbs-grid-canvas").appendChild(document.createElement("canvas"));this.topLineDiv=document.querySelector(selector+" .tbs-grid-top-line");this.bottomLineDiv=document.querySelector(selector+" .tbs-grid-bottom-line");this.leftLineDiv=document.querySelector(selector+" .tbs-grid-left-line");this.rightLineDiv=document.querySelector(selector+" .tbs-grid-right-line")};TbsGrid.prototype.tbs_setToolbar=function(toolbar){let selector="#"+this.gridId;let grid=this;if(toolbar==undefined)return;this.toolbar_visible=toolbar.visible!=undefined?this.toolbar_visible=toolbar.visible:this.toolbar_visible};TbsGrid.prototype.tbs_setGrid=function(columns,options={},headers=[]){let selector="#"+this.gridId;let grid=this;this.tbs_createOption(options);this.tbs_createColumn(columns,headers);this.tbs_createGrid(grid.columns)};TbsGrid.prototype.tbs_createGrid=function(column){let selector="#"+this.gridId;let grid=this;this.tbs_createFrame();this.tbs_createTable10();this.tbs_createTable80();this.tbs_createTable90();this.tbs_createTable20();this.tbs_createTable70();this.tbs_createTable40();this.tbs_createTable50();this.tbs_setPanelSize();this.tbs_createTable30();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.tbs_addEventAll()};TbsGrid.prototype.tbs_createTable10=function(){let selector="#"+this.gridId;let grid=this;let panel10=document.querySelector(selector+" .tbs-grid-panel10");panel10.classList.add("tbs-show")};TbsGrid.prototype.tbs_createTable20=function(){let selector="#"+this.gridId;let grid=this;const clickTopCheckBoxEvent=function(e){let checkbox=document.querySelector(selector+" .tbs-grid-panel21 .tbs-grid-cell-checkbox");if(checkbox.checked==true){for(let i=0,len=grid.data_view.length;i<len;i++){grid.data_view[i].check=true}grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}else{for(let i=0,len=grid.data_view.length;i<len;i++){grid.data_view[i].check=false}grid.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}};let table,thead,tbody,tr,th,td;table=document.createElement("table");table.className="tbs-grid-table";let tableWidth=this.options[grid.option_numWidth];tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style.height=this.headerRowHeight*this.headerRowCount+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";td.style.width=this.options[grid.option_numWidth]+"px";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";td.appendChild(div);tr.appendChild(td);tableWidth=tableWidth+(this.options[grid.option_rowMode]?this.options[grid.option_rowModeWidth]:0);td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";td.style.display=this.options[grid.option_rowMode]?"":"none";td.style.width=this.options[grid.option_rowModeWidth]+"px";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="s";div.style.textAlign="center";td.appendChild(div);tr.appendChild(td);tableWidth=tableWidth+(this.options[grid.option_checkbox]?this.options[grid.option_checkBoxWidth]:0);document.querySelector(selector+" .tbs-grid-group21").style.width=tableWidth+"px";document.querySelector(selector+" .tbs-grid-panel21").style.width=tableWidth+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";td.style.display=this.options[grid.option_checkbox]?"":"none";td.style.width=this.options[grid.option_checkBoxWidth]+"px";div=grid.tbs_createElementCellDiv();let input=document.createElement("input");input.setAttribute("type","checkbox");input.classList.add("tbs-grid-cell-checkbox");div.appendChild(input);td.appendChild(div);tr.appendChild(td);tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel21").innerHTML="";document.querySelector(selector+" .tbs-grid-panel21").appendChild(table);if(this.options[grid.option_checkbox]==true){document.querySelector(selector+" .tbs-grid-cell-checkbox").addEventListener("click",clickTopCheckBoxEvent)}let headerRowCount=this.headerRowCount;table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");let sumWidth=0;for(let i=0,len=this.columns.length;i<len;i++){th=document.createElement("th");th.style.width=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i][grid.column_width])+"px":"0px";th.style.display=this.columns[i][grid.column_visible]==true?"":"none";sumWidth+=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i][grid.column_width]):0;tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");for(let rowIndex=0;rowIndex<headerRowCount;rowIndex++){tr=document.createElement("tr");tr.style="height:"+this.headerRowHeight+"px";for(let i=0,len=this.headerColumnTable[0].length;i<len;i++){let td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.display="none";let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.appendChild(div);let span=document.createElement("span");span.classList.add("tbs-grid-cell-span");div.appendChild(span);let spanSort=document.createElement("span");spanSort.classList.add("tbs-grid-cell-span-sort");div.appendChild(spanSort);let reSizeDiv=document.createElement("div");reSizeDiv.classList.add("tbs-grid-cell-resize");let sortDiv=document.createElement("div");sortDiv.classList.add("tbs-grid-cell-sort");td.appendChild(div);td.appendChild(reSizeDiv);tr.appendChild(td)}tbody.appendChild(tr)}table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel20").innerHTML="";document.querySelector(selector+" .tbs-grid-panel20").appendChild(table);this.tbs_displayPanel20()};TbsGrid.prototype.tbs_createTable30=function(){let selector="#"+this.gridId;let grid=this;let table,thead,tbody,tr,th,td;let pageRowCount=this.pageRowCount;table=document.createElement("table");table.className="tbs-grid-table";tbody=document.createElement("tbody");thead=document.createElement("thead");tr=document.createElement("tr");th=document.createElement("th");th.style.width=this.options[grid.option_numWidth]+"px";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_rowMode]?this.options[grid.option_rowModeWidth]+"px":"0px";th.style.display=this.options[grid.option_rowMode]?"":"none";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_checkbox]?this.options[grid.option_checkBoxWidth]+"px":"0px";th.style.display=this.options[grid.option_checkbox]?"":"none";tr.appendChild(th);thead.appendChild(tr);table.appendChild(thead);for(let rowIndex=0;rowIndex<pageRowCount;rowIndex++){tr=document.createElement("tr");let attr=document.createAttribute("data-rowId");tr.setAttributeNode(attr);tr.style="display:none;height"+this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style="text-align:center;";td.appendChild(div);td.style.width=this.options[grid.option_numWidth]+"px";tr.appendChild(td);td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.display=this.options[grid.option_rowMode]?"":"none";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style.textAlign="center;";td.appendChild(div);td.style.width=this.options[grid.option_rowModeWidth]+"px";tr.appendChild(td);td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.display=this.options[grid.option_checkbox]?"":"none";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style.textAlign="center;";let input=document.createElement("input");input.setAttribute("type","checkbox");input.classList.add("tbs-grid-cell-checkbox");div.appendChild(input);td.appendChild(div);td.style.width=this.options[grid.option_checkBoxWidth]+"px";tr.appendChild(td);tbody.appendChild(tr)}table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel31").innerHTML="";document.querySelector(selector+" .tbs-grid-panel31").appendChild(table);table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");let sumWidth=0;for(let i=0,len=this.columns.length;i<len;i++){let column=this.columns[i];th=document.createElement("th");th.style.width=column[grid.column_visible]==true?parseInt(column[grid.column_width])+"px":"0px";th.style.display=column[grid.column_visible]==true?"":"none";sumWidth+=this.columns[i][grid.column_visible]==true?parseInt(column[grid.column_width]):0;tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");for(let rowIndex=0;rowIndex<pageRowCount;rowIndex++){tr=document.createElement("tr");tr.style="display:none;height:"+this.rowHeight+"px";for(let i=0;i<this.columns.length;i++){let column=this.columns[i];let td=document.createElement("td");td.className="tbs-grid-cell";td.style.display=column[grid.column_visible]==true?"":"none";let div=grid.tbs_createElementCellDiv();let spanText=grid.tbs_createElementCellText();div.appendChild(spanText);td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)}table.appendChild(tbody);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-group31").style.width=sumWidth+"px";document.querySelector(selector+" .tbs-grid-panel31").style.width=sumWidth+"px";document.querySelector(selector+" .tbs-grid-panel30").innerHTML="";document.querySelector(selector+" .tbs-grid-panel30").appendChild(table)};TbsGrid.prototype.tbs_createTable40=function(){let selector="#"+this.gridId;let grid=this;let topColumns=this.topColumns;if(topColumns.length==0)return;let column=this.columns;let table,thead,tbody,tr,th,td,input;table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");th=document.createElement("th");th.style.width=this.options[grid.option_numWidth]+"px";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_rowMode]?this.options[grid.option_rowModeWidth]+"px":"0px";th.style.display=this.options[grid.option_rowMode]?"":"none";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_checkbox]?this.options[grid.option_checkBoxWidth]+"px":"0px";th.style.display=this.options[grid.option_checkbox]?"":"none";tr.appendChild(th);thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style.height=this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="âˆ‘";td.style.width=this.options[grid.option_numWidth]+"px";td.appendChild(div);tr.appendChild(td);let tableWidth=this.options[grid.option_numWidth];if(this.options[grid.option_rowMode]==true){tableWidth+=this.options[grid.option_rowModeWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-div");div.textContent="";td.style.width=td.style.width=this.options[grid.option_rowModeWidth]+"px";td.appendChild(div);tr.appendChild(td)}if(this.options[grid.option_checkbox]==true){tableWidth+=this.options[grid.option_checkBoxWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.style.width=td.style.width=this.options[grid.option_checkBoxWidth]+"px";td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel41").innerHTML="";document.querySelector(selector+" .tbs-grid-panel41").appendChild(table);table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");for(let i=0,len=this.columns.length;i<len;i++){th=document.createElement("th");th.style.width=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i].width)+"px":"0px";th.style.display=this.columns[i][grid.column_visible]==true?"":"none";tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style="height:"+this.rowHeight+"px";for(let i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];let td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.width=column[grid.column_width]+"px";td.dataset.name=column[grid.column_name];td.dataset.cellIndex=i;let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");let spanText=grid.tbs_createElementCellText();div.appendChild(spanText);td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel40").innerHTML="";document.querySelector(selector+" .tbs-grid-panel40").appendChild(table)};TbsGrid.prototype.tbs_createTable50=function(){let selector="#"+this.gridId;let grid=this;let footerColumns=this.footerColumns;if(footerColumns.length==0)return;let column=this.columns;let table,thead,tbody,tr,th,td,input;table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");th=document.createElement("th");th.style.width=this.options[grid.option_numWidth]+"px";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_rowMode]?this.options[grid.option_rowModeWidth]+"px":"0px";th.style.display=this.options[grid.option_rowMode]?"":"none";tr.appendChild(th);th=document.createElement("th");th.style.width=this.options[grid.option_checkbox]?this.options[grid.option_checkBoxWidth]+"px":"0px";th.style.display=this.options[grid.option_checkbox]?"":"none";tr.appendChild(th);thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style.height=this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="âˆ‘";td.style.width=this.options[grid.option_numWidth]+"px";td.appendChild(div);tr.appendChild(td);let tableWidth=this.options[grid.option_numWidth];if(this.options[grid.option_rowMode]==true){tableWidth+=this.options[grid.option_rowModeWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-div");div.textContent="";td.style.width=td.style.width=this.options[grid.option_rowModeWidth]+"px";td.appendChild(div);tr.appendChild(td)}if(this.options[grid.option_checkbox]==true){tableWidth+=this.options[grid.option_checkBoxWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.style.width=td.style.width=this.options[grid.option_checkBoxWidth]+"px";td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel51").innerHTML="";document.querySelector(selector+" .tbs-grid-panel51").appendChild(table);table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");for(let i=0,len=this.columns.length;i<len;i++){th=document.createElement("th");th.style.width=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i].width)+"px":"0px";th.style.display=this.columns[i][grid.column_visible]==true?"":"none";tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style="height:"+this.rowHeight+"px";for(let i=0,len=grid.columns.length;i<len;i++){let column=grid.columns[i];let td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.width=column[grid.column_width]+"px";td.dataset.name=column[grid.column_name];td.dataset.cellIndex=i;let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");let spanText=grid.tbs_createElementCellText();div.appendChild(spanText);td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel50").innerHTML="";document.querySelector(selector+" .tbs-grid-panel50").appendChild(table)};TbsGrid.prototype.tbs_createTable70=function(){let selector="#"+this.gridId;let grid=this;grid.tbs_createTable70_2()};TbsGrid.prototype.tbs_createTable70_1=function(){let selector="#"+this.gridId;let grid=this;let column=this.columns;let table,thead,tbody,tr,th,td,input;table=document.createElement("table");table.className="tbs-grid-table";tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style.height=this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";td.style.width=this.options[grid.option_numWidth]+"px";td.appendChild(div);tr.appendChild(td);let tableWidth=this.options[grid.option_numWidth];if(this.options[grid.option_rowMode]==true){tableWidth+=this.options[grid.option_rowModeWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";td.style.width=td.style.width=this.options[grid.option_rowModeWidth]+"px";td.appendChild(div);tr.appendChild(td)}if(this.options[grid.option_checkbox]==true){tableWidth+=this.options[grid.option_checkBoxWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.style.width=td.style.width=this.options[grid.option_checkBoxWidth]+"px";td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr);table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel71").innerHTML="";document.querySelector(selector+" .tbs-grid-panel71").appendChild(table);table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");let sumWidth=0;for(let i=0,len=this.columns.length;i<len;i++){th=document.createElement("th");th.style.width=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i].width)+"px":"0px";th.style.display=this.columns[i][grid.column_visible]==true?"":"none";sumWidth+=this.columns[i][grid.column_visible]==true?parseInt(this.columns[i].width):0;tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");tr=document.createElement("tr");tr.style="height:"+this.rowHeight+"px";sumWidth=0;let len=column.length;for(let i=0;i<len;i++){let col=column[i];if(col[grid.column_name]!=undefined){let td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";let width=col["width"]!=""?col["width"]:"100";td.style.width=width+"px";sumWidth+=Number(width);td.dataset.name=col[grid.column_name];td.dataset.cellIndex=this.tbs_getColumnIndex(col[grid.column_name]);let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)}table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel70").innerHTML="";document.querySelector(selector+" .tbs-grid-panel70").appendChild(table)};TbsGrid.prototype.tbs_createTable70_2=function(){let selector="#"+this.gridId;let grid=this;let column=this.columns;let table,thead,tbody,tr,th,td,input;table=document.createElement("table");table.className="tbs-grid-table";tbody=document.createElement("tbody");for(let i=0;i<2;i++){tr=document.createElement("tr");tr.style.height=this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent=i==0?"":"R";td.style.width=this.options[grid.option_numWidth]+"px";td.appendChild(div);tr.appendChild(td);let tableWidth=this.options[grid.option_numWidth];if(grid.options[grid.option_rowMode]==true){tableWidth+=this.options[grid.option_rowModeWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";td.style.width=td.style.width=this.options[grid.option_rowModeWidth]+"px";td.appendChild(div);tr.appendChild(td)}if(grid.options[grid.option_checkbox]==true){tableWidth+=this.options[grid.option_checkBoxWidth];td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.style.width=td.style.width=this.options[grid.option_checkBoxWidth]+"px";td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)}table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel71").innerHTML="";document.querySelector(selector+" .tbs-grid-panel71").appendChild(table);table=document.createElement("table");table.className="tbs-grid-table";thead=document.createElement("thead");tr=document.createElement("tr");let sumWidth=0;for(let x=0,len=this.columns.length;x<len;x++){th=document.createElement("th");th.style.width=this.columns[x][grid.column_visible]==true?parseInt(this.columns[x].width)+"px":"0px";th.style.display=this.columns[x][grid.column_visible]==true?"":"none";sumWidth+=this.columns[x][grid.column_visible]==true?parseInt(this.columns[x].width):0;tr.appendChild(th)}thead.appendChild(tr);table.appendChild(thead);tbody=document.createElement("tbody");for(let i=0;i<2;i++){tr=document.createElement("tr");tr.style="height:"+grid.rowHeight+"px";sumWidth=0;let len=column.length;for(let x=0;x<len;x++){let col=column[x];if(col[grid.column_name]!=undefined){let td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.textAlign="center";let width=col["width"]!=""?col["width"]:"100";td.style.width=width+"px";sumWidth+=Number(width);td.dataset.name=col[grid.column_name];td.dataset.cellIndex=this.tbs_getColumnIndex(col[grid.column_name]);let div=document.createElement("div");div.classList.add("tbs-grid-cell-div");td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)}}table.appendChild(tbody);document.querySelector(selector+" .tbs-grid-panel70").innerHTML="";document.querySelector(selector+" .tbs-grid-panel70").appendChild(table)};TbsGrid.prototype.tbs_createTable80=function(){let selector="#"+this.gridId;let grid=this;let div=document.createElement("div");div.className="tbs-grid-panel-bar";let span=document.createElement("span");span.className="tbs-grid-panel-bar-span";span.textContent=grid.classGroup.infoText;div.appendChild(span);document.querySelector(selector+" .tbs-grid-panel80").innerHTML="";document.querySelector(selector+" .tbs-grid-panel80").appendChild(div)};TbsGrid.prototype.tbs_createTable90=function(){let selector="#"+this.gridId;let grid=this;let div=document.createElement("div");div.className="tbs-grid-panel-bar";let span=document.createElement("span");span.className="tbs-grid-panel-bar-span";span.textContent=grid.classSort.infoText;div.appendChild(span);document.querySelector(selector+" .tbs-grid-panel90").innerHTML="";document.querySelector(selector+" .tbs-grid-panel90").appendChild(div)};TbsGrid.prototype.tbs_updateTableRows30=function(){let selector="#"+this.gridId;let grid=this;let table,thead,tbody,tr,th,td;let pageRowCount=this.pageRowCount;let tableRows=document.querySelectorAll(selector+" .tbs-grid-panel31 .tbs-grid-table tbody tr");if(tableRows.length>=this.pageRowCount)return;let addRowCount=this.pageRowCount-tableRows.length;tbody=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table tbody");if(grid.null(tbody))return;for(let rowIndex=0;rowIndex<addRowCount;rowIndex++){tr=document.createElement("tr");let attr=document.createAttribute("data-rowId");tr.setAttributeNode(attr);tr.style="display:none;height"+this.rowHeight+"px";td=document.createElement("td");td.classList.add("tbs-grid-cell");div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style="text-align:center;";td.appendChild(div);td.style.width=this.options[grid.option_numWidth]+"px";tr.appendChild(td);td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.display=this.options[grid.option_rowMode]?"":"none";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style.textAlign="center;";td.appendChild(div);td.style.width=this.options[grid.option_rowModeWidth]+"px";tr.appendChild(td);td=document.createElement("td");td.classList.add("tbs-grid-cell");td.style.display=this.options[grid.option_checkbox]?"":"none";div=document.createElement("div");div.classList.add("tbs-grid-cell-div");div.textContent="";div.style.textAlign="center;";let input=document.createElement("input");input.setAttribute("type","checkbox");input.classList.add("tbs-grid-cell-checkbox");div.appendChild(input);td.appendChild(div);td.style.width=this.options[grid.option_checkBoxWidth]+"px";tr.appendChild(td);tbody.appendChild(tr)}tbody=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table tbody");for(let rowIndex=0;rowIndex<addRowCount;rowIndex++){tr=document.createElement("tr");tr.style="display:none;height:"+this.rowHeight+"px";for(let i=0;i<this.columns.length;i++){let column=this.columns[i];let td=document.createElement("td");td.className="tbs-grid-cell";td.style.display=column[grid.column_visible]==true?"":"none";let div=grid.tbs_createElementCellDiv();let spanText=grid.tbs_createElementCellText();div.appendChild(spanText);td.appendChild(div);tr.appendChild(td)}tbody.appendChild(tr)}};TbsGrid.prototype.tbs_setFrozenColumn=function(fixedColumnIndex){let selector="#"+this.gridId;let grid=this;if(grid.null[fixedColumnIndex]){this.fixedColumnIndex=-1;return}if(fixedColumnIndex>=grid.columns.length-1){this.fixedColumnIndex=-1;return}let colIndex=fixedColumnIndex;this.fixedColumnIndex=fixedColumnIndex;let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let table30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let table40=document.querySelector(selector+" .tbs-grid-panel40 .tbs-grid-table");let table50=document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table");let table60=document.querySelector(selector+" .tbs-grid-panel60 .tbs-grid-table");let panel22=document.querySelector(selector+" .tbs-grid-panel22");let panel32=document.querySelector(selector+" .tbs-grid-panel32");let panel42=document.querySelector(selector+" .tbs-grid-panel42");let panel52=document.querySelector(selector+" .tbs-grid-panel52");let panel62=document.querySelector(selector+" .tbs-grid-panel62");grid.tbs_createFrozenColumnTable(table20,panel22,fixedColumnIndex);grid.tbs_createFrozenColumnTable(table30,panel32,fixedColumnIndex);if(table40!=null)grid.tbs_createFrozenColumnTable(table40,panel42,fixedColumnIndex);if(table50!=null)grid.tbs_createFrozenColumnTable(table50,panel52,fixedColumnIndex);if(this.fixedRowIndex!=-1){grid.tbs_createFrozenColumnTable(table30,panel62,fixedColumnIndex,"panel62")}let leftRect=document.querySelector(selector+" .tbs-grid-panel31").getBoundingClientRect();let fixTopRect=document.querySelector(selector+" .tbs-grid-panel22").getBoundingClientRect();this.tbs_setPanelSize();this.tbs_displayPanel20();this.tbs_displayPanel30(0)};TbsGrid.prototype.tbs_setFrozenRow=function(fixedRowIndex,fixedRowCount){let selector="#"+this.gridId;let grid=this;const fn_getTableRowIndex=function(rowIndex){let result=0;let tableRows=document.querySelectorAll(selector+' .tbs-grid-panel31 .tbs-grid-table tbody tr:not([style*="display:"])');for(let i=0,len=tableRows.length;i<tableRows.length;i++){let tableRow=tableRows[i];let index=parseInt(tableRow.childNodes[0].dataset.rowIndex);if(index==rowIndex){result=tablesRow.rowIndex;break}}return result};if(grid.null(fixedRowCount)){fixedRowCount=fn_getTableRowIndex(rowIndex)}if(fixedRowIndex+1>this.tbs_getRowCount()&&fixedRowCount>grid.pageRowCount){this.fixedRowIndex=-1;this.fixedRowCount=0;return}this.fixedRowIndex=fixedRowIndex;this.fixedRowCount=fixedRowCount;let table31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table");let table30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let panel61=document.querySelector(selector+" .tbs-grid-panel61");let panel60=document.querySelector(selector+" .tbs-grid-panel60");let panel62=document.querySelector(selector+" .tbs-grid-panel62");let copyTable=table31.cloneNode(true);let trList=copyTable.querySelectorAll("tbody tr");for(let i=trList.length-1;i>=0;i--){if(i>fixedRowIndex)copyTable.deleteRow(-1)}panel61.innerHTML="";panel61.appendChild(copyTable);copyTable=table30.cloneNode(true);trList=copyTable.querySelectorAll("tbody tr");for(let i=trList.length-1;i>=0;i--){if(i>fixedRowIndex)copyTable.deleteRow(-1)}panel60.innerHTML="";panel60.appendChild(copyTable);if(this.fixedColumnIndex!=-1){grid.tbs_createFrozenColumnTable(table30,panel62,fixedColumnIndex,"panel62")}this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(grid.fixedRowIndex)};TbsGrid.prototype.tbs_createFrozenColumnTable=function(fromPanelTable,toPanel,fixedColumnIndex,panelName=""){let selector="#"+this.gridId;let grid=this;let table=fromPanelTable.cloneNode(true);let tableRows=table.querySelectorAll("tbody tr");let tableCells=table.querySelectorAll("thead th");let sumWidth=0;if(panelName==""){for(let i=0,len=tableRows.length;i<len;i++){for(let x=0,len2=tableCells.length;x<len2;x++){let column=grid.columns[x];if(i==0&&x<=fixedColumnIndex){sumWidth+=parseInt(tableCells[x].style.width,10)}if(x>fixedColumnIndex){tableRows[i].childNodes[x].style.display="none";tableCells[x].style.display="none";tableCells[x].style.width="0px"}}}toPanel.style.width=sumWidth+"px";toPanel.innerHTML="";toPanel.appendChild(table);tableRows=fromPanelTable.querySelectorAll("tbody tr");tableCells=fromPanelTable.querySelectorAll("thead th");for(let i=0,len=tableRows.length;i<len;i++){for(let x=0;x<=fixedColumnIndex;x++){tableRows[i].childNodes[x].style.display="none";tableCells[x].style.display="none";tableCells[x].style.width="0px"}}fromPanelTable.style.width=parseInt(fromPanelTable.style.width,10)-sumWidth+"px"}else if(panelName=="panel62"){let fixedRowIndex=this.fixedRowIndex;for(let i=0,len=tableRows.length;i<len;i++){for(let x=0,len2=tableCells.length;x<len2;x++){let column=grid.columns[x];if(i==0&&x<=fixedColumnIndex){sumWidth+=parseInt(tableCells[x].style.width,10)}if(x>fixedColumnIndex){tableRows[i].childNodes[x].style.display="none";tableCells[x].style.display="none";tableCells[x].style.width="0px"}}}toPanel.style.width=sumWidth+"px";toPanel.innerHTML="";toPanel.appendChild(table);tableRows=fromPanelTable.querySelectorAll("tbody tr");tableCells=fromPanelTable.querySelectorAll("thead th");for(let i=tableRows.length-1;i>=0;i--){if(i>fixedRowIndex)table.deleteRow(-1)}fromPanelTable.style.width=parseInt(fromPanelTable.style.width,10)-sumWidth+"px"}};TbsGrid.prototype.tbs_removeFrozenColumn=function(){let selector="#"+this.gridId;let grid=this;let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let table30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let table40=document.querySelector(selector+" .tbs-grid-panel40 .tbs-grid-table");let table50=document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table");let panel22=document.querySelector(selector+" .tbs-grid-panel22");let panel32=document.querySelector(selector+" .tbs-grid-panel32");let panel42=document.querySelector(selector+" .tbs-grid-panel42");let panel52=document.querySelector(selector+" .tbs-grid-panel52");let columns=this.columns;let fixedColumnIndex=this.fixedColumnIndex+1;colIndex=fixedColumnIndex;panel22.childNodes[0].innerHTML="";panel32.childNodes[0].innerHTML="";panel42.childNodes[0].innerHTML="";panel52.childNodes[0].innerHTML="";panel22.style="width:0px;";panel32.style="width:0px;";panel42.style="width:0px;";panel52.style="width:0px;";let sumWidth=0;for(let x=0;x<columns.length;x++){sumWidth+=parseInt(columns[x].width,10)}let table=table20;let trList=table.querySelectorAll("tbody tr");let colList=table.querySelectorAll("thead th");for(let i=0,len=trList.length;i<len;i++){for(let x=0;x<colIndex;x++){trList[i].childNodes[x].style.display="";colList[x].style.display="";colList[x].style.width=columns[x].width+"px"}}table=table30;trList=table.querySelectorAll("tbody tr");colList=table.querySelectorAll("thead th");for(let i=0,len=trList.length;i<len;i++){for(let x=0;x<colIndex;x++){trList[i].childNodes[x].style.display="";colList[x].style.display="";colList[x].style.width=columns[x].width+"px"}}if(table40!=null){let table=table40;let trList=table.querySelectorAll("tbody tr");let colList=table.querySelectorAll("thead th");for(let i=0,len=trList.length;i<len;i++){for(let x=0;x<colIndex;x++){trList[i].childNodes[x].style.display="";colList[x].style.display="";colList[x].style.width=columns[x].width+"px"}}}if(table50!=null){let table=table50;let trList=table.querySelectorAll("tbody tr");let colList=table.querySelectorAll("thead th");for(let i=0,len=trList.length;i<len;i++){for(let x=0;x<colIndex;x++){trList[i].childNodes[x].style.display="";colList[x].style.display="";colList[x].style.width=columns[x].width+"px"}}}this.fixedColumnIndex=-1;this.tbs_setPanelSize();this.tbs_displayPanel20();this.tbs_displayPanel30(0)};TbsGrid.prototype.tbs_removeFrozenRow=function(){let selector="#"+this.gridId;let grid=this;this.fixedRowIndex=-1;this.fixedRowCount=0;let panel61=document.querySelector(selector+" .tbs-grid-panel61");let panel60=document.querySelector(selector+" .tbs-grid-panel60");panel61.childNodes[0].innerHTML="";panel60.childNodes[0].innerHTML="";this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(0)};TbsGrid.prototype.getGroupRowInit=function(row,id){let selector="#"+this.gridId;let grid=this;for(let colIndex=0;colIndex<grid.columns.length;colIndex++){let col=grid.columns[colIndex];if(id==""){if(col[grid.column_type]=="number"){row[col[grid.column_name]]=0}else{row[col[grid.column_name]]=""}}else{if(col[grid.column_name]!=id){if(col[grid.column_type]=="number"){row[col[grid.column_name]]=0}else{row[col[grid.column_name]]=""}}else{if(id!="")row[col[grid.column_name]]+grid.option_sumChar}}}};TbsGrid.prototype.getGroupRowSum=function(row,srow,erow){let selector="#"+this.gridId;let grid=this;for(let i=srow;i<=erow;i++){for(let colIndex=0;colIndex<this.columns.length;colIndex++){let col=this.columns[colIndex];if(col[grid.column_summaryType]!=""){row[col[grid.column_name]]+=this.data_view[i][col.column_id]}}}};TbsGrid.prototype.getGroupNode=function(node){let result={};for(let i=0,len=this.data_view.length;i<len;i++){for(let x=0;x<this.columns.length;x++){let layout=this.data_view[i].layout[this.columns[x].column_id];if(layout.node==node){result.row=this.data_view[i];result.rowIndex=i;result.colIndex=x;result.id=this.tbs_getColumnName(x);result=this.data_view[i][this.columns[x].column_id];result.layout=this.data_view[i].layout[this.columns[x].column_id];break}}}return result};TbsGrid.prototype.setGroup=function(sortColumns,summaryColumns,mergeType){let selector=this.gridId;let grid=this;if(this.data_view.length==0)return;this.merge=true;this.classSort.sortColumns=sortColumns;this.summaryColumns=summaryColumns;this.mergeType=mergeType;let groupView=[];let direction="vertical";for(let i=0,len=grid.data_view.length;i<len;i++){let groupRow={};for(let x=0,colLen=grid.columns.length;x<colLen;x++){let id=grid.columns[x].column_id;groupRow[id]={};groupRow[id].srow=-1;groupRow[id].erow=-1;groupRow[id].scol=-1;groupRow[id].ecol=-1;groupRow[id].depth=-1;groupRow[id].node=-1;groupRow[id].parentNode=0;groupRow[id].firstChild=false;groupRow[id].lastChild=false;groupRow[id].mergeClass=""}groupView.push(groupRow)}let nextGroupId=function(id){for(let i=0,len=grid.summaryColumns.length;i<len;i++){if(id==grid.summaryColumns[i].column_id){if(i+1<len)return grid.summaryColumns[i+1].column_id}}return id};let getLastRowIndex=function(rowIndex,erow,id){let val=grid.tbs_getValue(rowIndex,id);let lastRowIndex=rowIndex;for(let i=rowIndex+1;i<=erow;i++){if(val==grid.tbs_getValue(i,id)){lastRowIndex=i;continue}else break}return lastRowIndex};let node=0;let setGroupBy=function(srow,erow,id,depth,parentNode){let colIndex=grid.tbs_getColumnIndex(id);let startRowIndex=0,lastRowIndex=0;for(let i=srow;i<=erow;i++){startRowIndex=i;i=getLastRowIndex(i,erow,id);lastRowIndex=i;node+=1;let group=groupView[startRowIndex][id];group.id=id;group.srow=startRowIndex;group.erow=lastRowIndex;group.node=node;group.parentNode=parentNode;group.depth=depth;group.firstChild=startRowIndex==srow?true:false;group.lastChild=lastRowIndex==erow?true:false;let nextId=nextGroupId(id);if(id!=nextId)setGroupBy(startRowIndex,lastRowIndex,nextId,depth+1,node)}};if(grid.summaryColumns.length>0)setGroupBy(0,grid.data_view.length-1,grid.summaryColumns[0].column_id,0,0);grid.classGroup.groupView=groupView;let setRowSpan=function(srow,erow,id){for(let i=srow,k=0;i<=erow;i++,k++){let layout=grid.data_view[i].layout[id];if(grid.mergeType==1){layout[grid.layout_rowSpan]=i==srow?erow-srow+1-k:1;layout[grid.layout_subRowSpan]=erow-srow+1-k}else if(grid.mergeType==2){layout[grid.layout_text]=i==srow?layout[grid.layout_text]:"";layout[grid.layout_rowSpan]=1;layout[grid.layout_subRowSpan]=1;for(let x=0,len2=grid.summaryColumns.length;x<len2;x++){if(i<erow)layout.mergeClass="tbs-grid-cell-bottom-none"}}else if(grid.mergeType==3){layout[grid.layout_rowSpan]=1;layout[grid.layout_subRowSpan]=1}else if(grid.mergeType==4){layout[grid.layout_text]=i==srow?layout[grid.layout_text]:"";layout[grid.layout_rowSpan]=1;layout[grid.layout_subRowSpan]=1}else if(grid.mergeType==5){layout[grid.layout_rowSpan]=i==srow?erow-srow+1-k:1;layout[grid.layout_subRowSpan]=erow-srow+1-k}else if(grid.mergeType==6){layout[grid.layout_rowSpan]=i==srow?erow-srow+1-k:1;layout[grid.layout_subRowSpan]=erow-srow+1-k}}};for(let i=0,len=grid.data_view.length;i<len;i++){for(let x=0,len2=grid.summaryColumns.length;x<len2;x++){let id=summaryColumns[x].column_id;let layout=grid.data_view[i].layout[id];let group=grid.classGroup.groupView[i][id];if(group.srow!=-1){layout.layout_srow=group.srow;layout.layout_erow=group.erow;layout.layout_scol=group.scol;layout.layout_ecol=group.ecol;layout.layout_depth=group.depth;layout.layout_node=group.node;layout.layout_parentNode=group.parentNode;layout.layout_firstChild=group.firstChild;layout.layout_lastChild=group.lastChild;layout.layout_mergeClass=group.mergeClass;setRowSpan(layout.srow,layout.erow,id)}}}let newView=[];let addRow=function(node){let result=grid.getGroupNode(node);if(result.row==undefined)return;let srow=result.layout.srow;let erow=result.layout.erow;let tmpRow=JSON.parse(JSON.stringify(result.row));let id=result.id;let layout=result.layout;let tmpView=[];if(layout.depth==grid.summaryColumns.length-1){for(let i=srow;i<=erow;i++)tmpView.push(JSON.parse(JSON.stringify(grid.data_view[i])))}if(grid.mergeType==4){for(let i=0,len=tmpView.length;i<len-1;i++){for(let x=0,len2=grid.summaryColumns.length;x<len2;x++){if(i<erow)tmpView[i].layout[grid.summaryColumns[x].column_id].mergeClass="tbs-grid-cell-bottom-none";if(i==0)tmpView[i].layout[grid.summaryColumns[x].column_id][grid.layout_text]=tmpView[i][id]}}}if(grid.mergeType==5){let rowCount=tmpView.length;for(let i=0,k=0,len=tmpView.length;i<len;i++,k++){for(let x=0,len2=grid.summaryColumns.length;x<len2;x++){tmpView[i].layout[grid.summaryColumns[x].column_id][grid.column_visible]=i==0?true:false;tmpView[i].layout[grid.summaryColumns[x].column_id].rowSpan=i==0?rowCount-k:1;tmpView[i].layout[grid.summaryColumns[x].column_id].subRowSpan=rowCount-k}}}grid.getGroupRowInit(tmpRow,id);grid.getGroupRowSum(tmpRow,srow,erow);tmpRow[grid.code_mode]="S";tmpRow.colorDepth=layout.depth;tmpView.push(JSON.parse(JSON.stringify(tmpRow)));for(let i=0,len=tmpView.length;i<len;i++){newView.push(JSON.parse(JSON.stringify(tmpView[i])))}if(layout.lastChild&&layout.depth!=0){addRow(layout.parentNode)}};let addTotalSum=function(){let srow=0;let erow=grid.data_view.length-1;let tmpRow=JSON.parse(JSON.stringify(grid.data_view[0]));grid.getGroupRowInit(tmpRow,"");grid.getGroupRowSum(tmpRow,srow,erow);tmpRow[grid.code_mode]="S";tmpRow.colorDepth="";newView.push(JSON.parse(JSON.stringify(tmpRow)))};let getSum=function(aid){let id=this.summaryColumns[this.summaryColumns.length-1].column_id;for(let i=0;i<grid.data_view.length;i++){let row=grid.data_view[i];if(row.layout[id].srow!=undefined&&row.layout[id].srow!=-1){addRow(row.layout[id].node)}}addTotalSum()};if(mergeType==3){getSum();grid.data_view=[];grid.data_view=newView}else if(mergeType==4){getSum();grid.data_view=[];grid.data_view=newView}else if(mergeType==5){getSum();grid.data_view=[];grid.data_view=newView}grid.horizontalScroll.tbs_setScroll(grid.code_horizontal);grid.verticalScroll.tbs_setScroll(grid.code_vertical);grid.tbs_refreshRefData();grid.tbs_displayPanel30(0)};TbsGrid.prototype.tbs_getHeaderCell=function(colIndex){let selector="#"+this.gridId;let grid=this;let tableRows=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table tbody tr");let rowCount=this.headerRowCount;if(rowCount>1){for(let i=rowCount-1;i>=0;i--){let tableRow=tableRows[i];if(tableRow.childNodes[colIndex].dataset.name!=""){return tableRow.childNodes[colIndex]}}}else{return tableRows[0].childNodes[colIndex]}};TbsGrid.prototype.getTextWidth=function(canvas,text,fontSize,fontFamily){let selector="#"+this.gridId;let grid=this;let context=canvas.getContext("2d");context.fontSize=fontSize;context.fontFamily=fontFamily;let metrics=context.measureText(text);return metrics.width};TbsGrid.prototype.getTextWidth2=function(context,text){let selector="#"+this.gridId;let grid=this;let metrics=context.measureText(text);return metrics.width};TbsGrid.prototype.tbs_setColumnAutoWidth=function(){let selector="#"+this.gridId;let grid=this;let canvas=document.querySelector(selector+" .tbs-grid-canvas").childNodes[0];let arr=[];for(let x=0,len=grid.columns.length;x<len;x++)arr[x]=0;let fontSize=grid.gridConfig.font.fontSize;let fontFamilty=grid.gridConfig.font.fontFamily;for(let i=0,len=grid.headerColumnTable.length;i<len;i++){for(let x=0,len2=grid.columns.length;x<len2;x++){if(grid.headerColumnTable[i][x][grid.column_kind]=="column"){let width=parseInt(grid.getTextWidth(canvas,grid.headerColumnTable[i][x][grid.column_text],fontSize,fontFamilty));if(width>=arr[x]){arr[x]=width}}}}for(let i=0,len=grid.data_view.length;i<len;i++){for(let x=0,len2=grid.columns.length;x<len2;x++){let columnName=grid.tbs_getColumnName(x);let column=grid.tbs_getColumn(columnName);let val=grid.tbs_getValueByIndex(i,x);let width=parseInt(grid.getTextWidth(canvas,grid.tbs_getFormatText(column,val),fontSize,fontFamilty));if(width>=arr[x]){arr[x]=width}}}for(let x=0,len=grid.columns.length;x<len;x++)arr[x]+=20;grid.tbs_setAllColumnWidth(arr);grid.tbs_displayPanel20()};TbsGrid.prototype.setRowHeight=function(type,rowHeight){let selector="#"+this.gridId;let grid=this;if(type==undefined){this.setRowHeight("header",rowHeight);this.setRowHeight("content",rowHeight);this.setRowHeight("top",rowHeight);this.setRowHeight("footer",rowHeight)}else{if(type=="header"){this.headerRowHeight=rowHeight;this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(0)}if(type=="content"){this.rowHeight=rowHeight;document.querySelector(selector+" .tbs-grid-input").style.height=rowHeight+"px";this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(0)}if(type=="top"){this.topRowHeight=rowHeight;this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(0)}if(type=="footer"){this.footerRowHeight=rowHeight;this.tbs_setPanelSize();this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical);this.tbs_displayPanel30(0)}}};TbsGrid.prototype.selector=document.querySelector;TbsGrid.prototype.selectorAll=document.querySelectorAll;TbsGrid.prototype.tbs_setGridModePage=function(){let selector="#"+this.gridId;let grid=this;let page=document.querySelector(selector+" .tbs-grid-panel10-page");page.style.display="";grid.classPage.pageRowcount=grid.classPage.options.pageRowCount};TbsGrid.prototype.tbs_setGridModePagenation=function(){let selector="#"+this.gridId;let grid=this;let page=document.querySelector(selector+" .tbs-grid-panel10-page");page.style.display=""};TbsGrid.prototype.tbs_createOption=function(options){let grid=this;grid.tbs_setOptions(options)};TbsGrid.prototype.tbs_setOption=function(optionName,optionValue){let grid=this;grid.options[optionName]=optionValue;if(optionName==grid.option_groupVisible){if(optionValue==true)grid.tbs_showGroupPanel();else grid.tbs_hideGroupPanel()}};TbsGrid.prototype.tbs_setOptions=function(options){let grid=this;for(let key in options)grid.tbs_setOption(optionMenu,key)};TbsGrid.prototype.tbs_setPanelSize=function(){let selector="#"+this.gridId;let grid=this;let rectGrid=document.querySelector(selector).getBoundingClientRect();let main=document.querySelector(selector+" .tbs-grid-main");let panel10=document.querySelector(selector+" .tbs-grid-panel10");let panel80=document.querySelector(selector+" .tbs-grid-panel80");let panel90=document.querySelector(selector+" .tbs-grid-panel90");let panel20=document.querySelector(selector+" .tbs-grid-panel20");let panel21=document.querySelector(selector+" .tbs-grid-panel21");let panel22=document.querySelector(selector+" .tbs-grid-panel22");let panel30=document.querySelector(selector+" .tbs-grid-panel30");let panel31=document.querySelector(selector+" .tbs-grid-panel31");let panel32=document.querySelector(selector+" .tbs-grid-panel32");let panel40=document.querySelector(selector+" .tbs-grid-panel40");let panel41=document.querySelector(selector+" .tbs-grid-panel41");let panel42=document.querySelector(selector+" .tbs-grid-panel42");let panel50=document.querySelector(selector+" .tbs-grid-panel50");let panel51=document.querySelector(selector+" .tbs-grid-panel51");let panel52=document.querySelector(selector+" .tbs-grid-panel52");let panel60=document.querySelector(selector+" .tbs-grid-panel60");let panel61=document.querySelector(selector+" .tbs-grid-panel61");let panel62=document.querySelector(selector+" .tbs-grid-panel62");let panel70=document.querySelector(selector+" .tbs-grid-panel70");let panel71=document.querySelector(selector+" .tbs-grid-panel71");let panel72=document.querySelector(selector+" .tbs-grid-panel72");let group20=document.querySelector(selector+" .tbs-grid-group20");let group21=document.querySelector(selector+" .tbs-grid-group21");let group30=document.querySelector(selector+" .tbs-grid-group30");let group31=document.querySelector(selector+" .tbs-grid-group31");let group40=document.querySelector(selector+" .tbs-grid-group40");let group41=document.querySelector(selector+" .tbs-grid-group41");let group50=document.querySelector(selector+" .tbs-grid-group50");let group51=document.querySelector(selector+" .tbs-grid-group51");let group60=document.querySelector(selector+" .tbs-grid-group60");let group61=document.querySelector(selector+" .tbs-grid-group61");let group70=document.querySelector(selector+" .tbs-grid-group70");let group71=document.querySelector(selector+" .tbs-grid-group71");let mainHeight=rectGrid.height;if(grid.toolbar_visible==true)mainHeight=mainHeight-25;if(grid.options[grid.option_groupVisible]==true)mainHeight=mainHeight-33;if(grid.options[grid.option_sortVisible]==true)mainHeight=mainHeight-33;main.style.height=`${mainHeight}px`;let rectTable21=document.querySelector(selector+" .tbs-grid-panel21 .tbs-grid-table").getBoundingClientRect();let rectTable22=document.querySelector(selector+" .tbs-grid-panel22 .tbs-grid-table").getBoundingClientRect();let rectTable20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table").getBoundingClientRect();let height=parseInt(rectTable20.height);if(this.fixedRowIndex!=-1&&this.fixedColumnIndex!=-1){group21.style.left="0px";group21.style.top="0px";group21.style.bottom=height+"px";group21.style.width=parseInt(rectTable21.width)+parseInt(rectTable22.width)+"px";group21.style.height=height+"px";group20.style.left=parseInt(rectTable21.width)+parseInt(rectTable22.width)+"px";group20.style.height=height+"px";panel22.style.left=parseInt(rectTable21.width)+"px"}else if(this.fixedColumnIndex!=-1){group21.style.left="0px";group21.style.top="0px";group21.style.bottom=height+"px";group21.style.width=parseInt(rectTable21.width)+parseInt(rectTable22.width)+"px";group21.style.height=height+"px";group20.style.left=parseInt(rectTable21.width)+parseInt(rectTable22.width)+"px";group20.style.height=height+"px";panel22.style.left=parseInt(rectTable21.width)+"px"}else{group21.style.left="0px";group21.style.top="0px";group21.style.bottom=height+"px";group21.style.width=parseInt(rectTable21.width)+"px";group21.style.height=height+"px";group20.style.left=parseInt(rectTable21.width)+"px";group20.style.height=height+"px";panel22.style.width="0px"}if(grid.options[grid.option_filterVisible]){let rectTable71=document.querySelector(selector+" .tbs-grid-panel71 .tbs-grid-table").getBoundingClientRect();let rectTable72=document.querySelector(selector+" .tbs-grid-panel72 .tbs-grid-table").getBoundingClientRect();let rectTable70=document.querySelector(selector+" .tbs-grid-panel70 .tbs-grid-table").getBoundingClientRect();if(this.fixedColumnIndex!=-1){group71.style.top=height+"px";group71.style.width=group21.style.width;group71.style.height=parseInt(rectTable70.height)+"px";group70.style.top=height+"px";group70.style.left=group21.style.width;group70.style.height=parseInt(rectTable70.height)+"px";panel72.style.left=panel22.style.left;panel72.style.width=panel22.style.width;panel70.style.left=panel20.style.left}else{group71.style.top=height+"px";group71.style.width=group21.style.width;group71.style.height=parseInt(rectTable70.height)+"px";group70.style.top=height+"px";group70.style.left=group21.style.width;group70.style.height=parseInt(rectTable70.height)+"px";panel72.style.width="0px";panel70.style.left="0px"}height+=parseInt(rectTable71.height)}if(this.topColumns.length>0){let rectTable41=document.querySelector(selector+" .tbs-grid-panel41 .tbs-grid-table").getBoundingClientRect();let rectTable42=document.querySelector(selector+" .tbs-grid-panel42 .tbs-grid-table").getBoundingClientRect();let rectTable40=document.querySelector(selector+" .tbs-grid-panel40 .tbs-grid-table").getBoundingClientRect();if(this.fixedRowIndex!=-1&&this.fixedColumnIndex!=-1){group41.style.top=height+"px";group41.style.width=group21.style.width;group41.style.height=parseInt(rectTable40.height)+"px";group40.style.top=height+"px";group40.style.left=group21.style.width;group40.style.height=parseInt(rectTable40.height)+"px";panel42.style.left=panel22.style.left;panel42.style.width=panel22.style.width;panel40.style.left=panel20.style.left}else if(this.fixedColumnIndex!=-1){group41.style.top=height+"px";group41.style.width=group21.style.width;group41.style.height=parseInt(rectTable40.height)+"px";group40.style.top=height+"px";group40.style.left=group21.style.width;group40.style.height=parseInt(rectTable40.height)+"px";panel42.style.left=panel22.style.left;panel42.style.width=panel22.style.width;panel40.style.left=panel20.style.left}else{group41.style.top=height+"px";group41.style.width=group21.style.width;group41.style.height=parseInt(rectTable40.height)+"px";group40.style.top=height+"px";group40.style.left=group21.style.width;group40.style.height=parseInt(rectTable40.height)+"px";panel42.style.width="0px";panel40.style.left="0px"}height+=parseInt(rectTable40.height)}if(this.fixedRowIndex!=-1&&this.fixedColumnIndex!=-1){group61.style.top=height+"px";group61.style.left=group21.style.left;group61.style.width=group21.style.width;group61.style.height=grid.fixedRowCount*grid.rowHeight+"px";group60.style.top=height+"px";group60.style.left=group20.style.left;group60.style.width=group20.style.width;group60.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel61.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel61.style.width=panel21.style.width;panel62.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel62.style.width=panel22.style.width;panel62.style.left=panel22.style.left;panel60.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel60.style.width=group20.style.width;height+=this.fixedRowCount*grid.rowHeight}else if(this.fixedRowIndex!=-1){let panel61=document.querySelector(selector+" .tbs-grid-panel61");let rectTable61=document.querySelector(selector+" .tbs-grid-panel61 .tbs-grid-table").getBoundingClientRect();group61.style.top=height+"px";group61.style.left=group21.style.left;group61.style.width=group21.style.width;group61.style.height=grid.fixedRowCount*grid.rowHeight+"px";group60.style.top=height+"px";group60.style.left=group20.style.left;group60.style.width=group20.style.width;group60.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel61.style.height=grid.fixedRowCount*grid.rowHeight+"px";panel60.style.height=grid.fixedRowCount*grid.rowHeight+"px";height+=this.fixedRowCount*grid.rowHeight}if(this.fixedRowIndex!=-1){let rectTable31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").getBoundingClientRect();let rectTable32=document.querySelector(selector+" .tbs-grid-panel32 .tbs-grid-table").getBoundingClientRect();let rectTable30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table").getBoundingClientRect();group31.style.top=height+"px";group30.style.top=height+"px";group31.style.width=group21.style.width;group31.style.height=parseInt(rectTable30.height)+"px";group30.style.left=group21.style.width;panel32.style.left=panel22.style.left;panel32.style.width=panel22.style.width;panel40.style.left=panel20.style.left}else if(this.fixedColumnIndex!=-1){let rectTable31=document.querySelector(selector+" .tbs-grid-panel31 .tbs-grid-table").getBoundingClientRect();let rectTable32=document.querySelector(selector+" .tbs-grid-panel32 .tbs-grid-table").getBoundingClientRect();let rectTable30=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table").getBoundingClientRect();group31.style.top=height+"px";group31.style.width=group21.style.width;group30.style.top=height+"px";group30.style.left=group21.style.width;panel32=document.querySelector(selector+" .tbs-grid-panel32");panel30=document.querySelector(selector+" .tbs-grid-panel30");panel32.style.width="0px";panel30.style.left="0px";panel32.style.left=panel22.style.left;panel32.style.width=panel22.style.width}else{group31.style.top=height+"px";group31.style.width=group21.style.width;group30.style.top=height+"px";group30.style.left=group21.style.width;panel32=document.querySelector(selector+" .tbs-grid-panel32");panel30=document.querySelector(selector+" .tbs-grid-panel30");panel32.style.width="0px";panel30.style.left="0px"}if(this.footerColumns.length>0){if(this.fixedColumnIndex!=-1&&this.fixedRowIndex!=-1){let rectTable50=document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table").getBoundingClientRect();group31.style.bottom=parseInt(rectTable50.height)+"px";group30.style.bottom=parseInt(rectTable50.height)+"px";group51.style.width=group21.style.width;group51.style.height=parseInt(rectTable50.height)+"px";group50.style.left=group21.style.width;group50.style.height=parseInt(rectTable50.height)+"px";panel52=document.querySelector(selector+" .tbs-grid-panel52");panel50=document.querySelector(selector+" .tbs-grid-panel50");panel52.style.left=panel22.style.left}else if(this.fixedColumnIndex!=-1){let rectTable50=document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table").getBoundingClientRect();group31.style.bottom=parseInt(rectTable50.height)+"px";group30.style.bottom=parseInt(rectTable50.height)+"px";group51.style.width=group21.style.width;group51.style.height=parseInt(rectTable50.height)+"px";group50.style.left=group21.style.width;group50.style.height=parseInt(rectTable50.height)+"px";panel52=document.querySelector(selector+" .tbs-grid-panel52");panel50=document.querySelector(selector+" .tbs-grid-panel50");panel52.style.left=panel22.style.left}else{let rectTable50=document.querySelector(selector+" .tbs-grid-panel50 .tbs-grid-table").getBoundingClientRect();group51.style.width=group21.style.width;group51.style.height=parseInt(rectTable50.height)+"px";group50.style.left=group21.style.width;group50.style.height=parseInt(rectTable50.height)+"px";group31.style.bottom=parseInt(rectTable50.height)+"px";group30.style.bottom=parseInt(rectTable50.height)+"px";panel52=document.querySelector(selector+" .tbs-grid-panel52");panel50=document.querySelector(selector+" .tbs-grid-panel50");panel52.style.width="0px";panel50.style.left="0px"}}this.tbs_setPageRowCount()};TbsGrid.prototype.tbs_setBarPosition=function(type,topRowIndex){let selector="#"+this.gridId;let grid=this;if(type==grid.code_horizontal){let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let railSize=grid.horizontalScroll.railSize;let hiddenSize=grid.horizontalScroll.hiddenSize;let curLeft=Math.abs(parseInt(table20.style.left.replace("px","")));xBar.style.left=curLeft/hiddenSize*railSize+"px"}else if(type==grid.code_vertical){topRowIndex=grid.null(topRowIndex)?0:topRowIndex;if(topRowIndex==0)document.querySelector(selector+" .tbs-grid-vertical-scroll-bar").style.top="0px";else if(grid.tbs_isLastTopRowIndex(topRowIndex)){document.querySelector(selector+" .tbs-grid-vertical-scroll-bar").style.top=grid.verticalScroll.railSize+"px"}else{let styleTop=parseInt(Math.ceil(topRowIndex/grid.verticalScroll.moveCount));document.querySelector(selector+" .tbs-grid-vertical-scroll-bar").style.top=styleTop+"px"}}};TbsGrid.prototype.tbs_setBarPositionByDirection=function(type,rowIndex){let selector="#"+this.gridId;let grid=this;if(type=="up"){let displayTopRowIndex=this.tbs_getFirstDisplayRowIndex();let trTopIndex=this.tbs_getFirstRowIndex()-1;if(trTopIndex<0)return false;grid.tbs_setBarPosition(grid.code_vertical,trTopIndex);grid.tbs_displayPanel30(trTopIndex);return trTopIndex}if(type=="down"){let displayTopRowIndex=this.tbs_getFirstDisplayRowIndex();let trTopIndex=0;if(rowIndex==undefined)trTopIndex=this.tbs_getFirstRowIndex()+1;else trTopIndex=rowIndex;if(grid.pageRowCount>grid.pageIntRowCount){if(trTopIndex>grid.data_view.length-grid.pageRowCount+1)return null}else{if(trTopIndex>grid.data_view.length-grid.pageRowCount)return null}grid.tbs_setBarPosition(grid.code_vertical,trTopIndex);grid.tbs_displayPanel30(trTopIndex);return trTopIndex}if(type=="right"){let hiddenSize=this.horizontalScroll.hiddenSize;let moveWidth=15;let divContent=document.querySelector(selector+" .tbs-grid-panel30");let divHeaderMove=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let divContentMove=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let sum=document.querySelector(selector+" .tbs-grid-panel40");let footer=document.querySelector(selector+" .tbs-grid-panel50");if(divHeaderMove.style.left==-1*hiddenSize+"px")return;let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let railSize=this.horizontalScroll.railSize;let curLeft=Math.abs(parseInt(divHeaderMove.style.left.replace("px","")));if(divContentMove.getBoundingClientRect().width<=divContent.getBoundingClientRect().width)return;let sLeft;if(curLeft+moveWidth>=hiddenSize)sLeft=-1*hiddenSize+"px";else sLeft=divHeaderMove.style.left.replace("px","")-moveWidth+"px";this.tbs_setContentPanelLeft(sLeft);this.tbs_setBarPosition(grid.code_horizontal);this.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}if(type=="left"){let moveWidth=15;let divHeaderMove=document.querySelector(selector+" .tbs-grid-panel20  .tbs-grid-table");let divContentMove=document.querySelector(selector+" .tbs-grid-panel30 .tbs-grid-table");let sum=document.querySelector(selector+" .tbs-grid-panel40");let footer=document.querySelector(selector+" .tbs-grid-panel50");if(divHeaderMove.style.left=="0px")return false;let xBar=document.querySelector(selector+" .tbs-grid-horizontal-scroll-bar");let railSize=this.horizontalScroll.railSize;let hiddenSize=this.horizontalScroll.hiddenSize;let curLeft=Math.abs(parseInt(divHeaderMove.style.left.replace("px","")));let sLeft;if(curLeft-moveWidth<=0)sLeft="0px";else sLeft=-1*curLeft+moveWidth+"px";this.tbs_setContentPanelLeft(sLeft);this.tbs_setBarPosition(grid.code_horizontal);this.tbs_displayPanel30(grid.tbs_getFirstRowIndex())}};TbsGrid.prototype.tbs_getContentPanelLeft=function(value){let selector="#"+this.gridId;let grid=this;let panel20=document.querySelector(selector+" .tbs-grid-panel20");value=parseInt(value,10);let railSize=this.horizontalScroll.railSize;let ratio=(panel20.childNodes[0].clientWidth-panel20.clientWidth)/railSize;let sLeft=(value*-1*ratio).toString()+"px";return sLeft};TbsGrid.prototype.tbs_setContentPanelLeft=function(value){let selector="#"+this.gridId;let grid=this;value=parseInt(value,10)+"px";let panel20=document.querySelector(selector+" .tbs-grid-panel20");let panel30=document.querySelector(selector+" .tbs-grid-panel30");let panel40=document.querySelector(selector+" .tbs-grid-panel40");let panel50=document.querySelector(selector+" .tbs-grid-panel50");let panel60=document.querySelector(selector+" .tbs-grid-panel60");let panel70=document.querySelector(selector+" .tbs-grid-panel70");if(this.notNull(panel20.childNodes[0]))panel20.childNodes[0].style.left=value;if(this.notNull(panel30.childNodes[0]))panel30.childNodes[0].style.left=value;if(this.notNull(panel40.childNodes[0]))panel40.childNodes[0].style.left=value;if(this.notNull(panel50.childNodes[0]))panel50.childNodes[0].style.left=value;if(this.notNull(panel60.childNodes[0]))panel60.childNodes[0].style.left=value;if(this.notNull(panel70.childNodes[0]))panel70.childNodes[0].style.left=value};TbsGrid.prototype.tbs_setContentPanelLeftMove=function(value){let selector="#"+this.gridId;let grid=this;let table20=document.querySelector(selector+" .tbs-grid-panel20 .tbs-grid-table");let left=parseInt(table20.style.left,10)+value+"px";this.tbs_setContentPanelLeft(left)};TbsGrid.prototype.tbs_setColumnWidth=function(colIndex,value){let selector="#"+this.gridId;let grid=this;let colList=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table thead th");let colList2=document.querySelectorAll(selector+" .tbs-grid-panel30 .tbs-grid-table thead th");let colList5=document.querySelectorAll(selector+" .tbs-grid-panel60 .tbs-grid-table thead th");let colList3=document.querySelectorAll(selector+" .tbs-grid-panel40 .tbs-grid-table thead th");let colList4=document.querySelectorAll(selector+" .tbs-grid-panel50 .tbs-grid-table thead th");let colList7=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-table thead th");let nWidth=parseInt(value)+"px";grid.columns[colIndex][grid.column_width]=parseInt(value,10);colList[colIndex].style.width=nWidth;colList2[colIndex].style.width=nWidth;if(grid.fixedRowIndex!=-1)colList5[colIndex].style.width=nWidth;if(grid.topColumns.length>0)colList3[colIndex].style.width=nWidth;if(grid.footerColumns.length>0)colList4[colIndex].style.width=nWidth;if(grid.options[grid.option_filterVisible])colList7[colIndex].style.width=nWidth;this.horizontalScroll.tbs_setScroll(grid.code_horizontal);this.verticalScroll.tbs_setScroll(grid.code_vertical)};TbsGrid.prototype.tbs_setAllColumnWidth=function(arr){let selector="#"+this.gridId;let grid=this;let thList20=document.querySelectorAll(selector+" .tbs-grid-panel20 .tbs-grid-table thead th");let thList30=document.querySelectorAll(selector+" .tbs-grid-panel30 .tbs-grid-table thead th");let thList40=document.querySelectorAll(selector+" .tbs-grid-panel40 .tbs-grid-table thead th");let thList50=document.querySelectorAll(selector+" .tbs-grid-panel50 .tbs-grid-table thead th");let thList60=document.querySelectorAll(selector+" .tbs-grid-panel60 .tbs-grid-table thead th");let thList70=document.querySelectorAll(selector+" .tbs-grid-panel70 .tbs-grid-table thead th");for(let x=0,len=grid.columns.length;x<len;x++){grid.columns[x].width=arr[x];let nWidth=arr[x]+"px";thList20[x].style.width=nWidth;thList30[x].style.width=nWidth;if(grid.topColumns.length>0)thList40[x].style.width=nWidth;if(grid.footerColumns.length>0)thList50[x].style.width=nWidth;if(grid.fixedRowIndex!=-1)thList60[x].style.width=nWidth;if(grid.options[grid.option_filterVisible])thList70[x].style.width=nWidth}grid.horizontalScroll.tbs_setScroll(grid.code_horizontal)};TbsGrid.prototype.tbs_setPageRowCount=function(panelName=""){let selector="#"+this.gridId;let grid=this;let rowHeight=this.rowHeight;let contentHeight=parseInt(document.querySelector(selector+" .tbs-grid-group30").getBoundingClientRect().height);let pageRowCount=contentHeight/rowHeight>parseInt(contentHeight/rowHeight)?parseInt(contentHeight/rowHeight)+1:parseInt(contentHeight/rowHeight);let pageIntRowCount=Math.floor(contentHeight/rowHeight);this.pageRowCount=pageRowCount;this.pageIntRowCount=pageIntRowCount};TbsGrid.prototype.tbs_setTopColumnDefaultValue=function(topColumn){let selector="#"+this.gridId;let grid=this;let columnName=topColumn[grid.column_name];topColumn[grid.column_align]=grid.tbs_getColumnProperty(columnName,grid.column_align)};TbsGrid.prototype.tbs_setTopColumns=function(columns){let selector="#"+this.id;let grid=this;grid.topColumns=grid.tbs_copyJson(columns);for(let i=0,len=grid.topColumns.length;i<len;i++){let topColumn=grid.topColumns[i];let columnName=topColumn[grid.column_name];if(grid.null(topColumn[grid.column_align]))topColumn[grid.column_align]="center"}};TbsGrid.prototype.tbs_setTopData=function(){let selector="#"+this.gridId;let grid=this;if(grid.topColumns.length==0)return;let topColumns=grid.topColumns;grid.data_top=[];let item={};item[grid.code_rowId]=grid.topMaxRowId;grid.topMaxRowId+=1;item[grid.code_mode]="";item={};let columns=grid.columns;for(let colIndex=0,len=columns.length;colIndex<len;colIndex++){let column=columns[colIndex];let columnName=column[grid.column_name];item[columnName]=null}grid.data_top.push(item);let topRow=grid.data_top[0];for(let i=0,colCount=topColumns.length;i<colCount;i++){let topColumn=topColumns[i];let columnName=topColumn[grid.column_name];if(grid.tbs_isColumnTypeNumber(columnName)==false)topRow[columnName]=topColumn[grid.column_name]}for(let rowIndex=0,len=grid.data_view.length;rowIndex<len;rowIndex++){let row=grid.data_view[rowIndex];for(let i=0,colCount=topColumns.length;i<colCount;i++){let topColumn=topColumns[i];let columnName=topColumn[grid.column_name];let sum=0;if(grid.tbs_isColumnTypeNumber(columnName)&&topColumn[grid.column_summaryType]=="sum"){topRow[columnName]+=parseFloat(row[columnName])}}}let rowCount=grid.tbs_getRowCount();for(let i=0,colCount=topColumns.length;i<colCount;i++){let topColumn=topColumns[i];let columnName=topColumn[grid.column_name];if(grid.tbs_isColumnTypeNumber(columnName)&&topColumn[grid.column_summaryType]=="avg"){topRow[columnName]=topRow[columnName]/rowCount}}for(let i=0,len=grid.data_top.length;i<len;i++){let row=grid.data_top[0];for(let x=0,len2=grid.columns.length;x<len2;x++){let column=grid.columns[x];let columnName=grid.getColumnName(x);let value=grid.tbs_getTopValue(i,columnName);grid.tbs_setTopValue(i,columnName,value)}}};TbsGrid.prototype.tbs_getTopValue=function(rowIndex,columnName){let column=this.tbs_getColumn(columnName);let columnType=column[this.column_type];let val=this.data_top[rowIndex][columnName];if(columnType==this.code_number)return Number(val);else if(columnType==this.code_currency)return Number(val);else return val};TbsGrid.prototype.tbs_getTopValueByIndex=function(rowIndex,colIndex){let columnName=this.tbs_getColumnName(colIndex);return this.tbs_getTopValue(rowIndex,columnName)};TbsGrid.prototype.tbs_getTopText=function(rowIndex,columnName){let grid=this;let column=grid.tbs_getColumn(columnName);let value=grid.tbs_getTopValue(rowIndex,columnName);let result=grid.tbs_getFormat(column,value);return result.text};TbsGrid.prototype.tbs_setTopValue=function(rowIndex,columnName,value){let selector="#"+this.gridId;let grid=this;let column=grid.tbs_getColumn(columnName);let result=grid.tbs_getFormat(column,value);grid.data_top[rowIndex][columnName]=result.value};TbsGrid.prototype.tbs_setTopValueByIndex=function(rowIndex,cellIndex,value){let columnName=this.tbs_getColumnName(cellIndex);this.tbs_setTopValue(rowIndex,columnName,value)};TbsGrid.prototype.null=function(p){return p==null||p==undefined};TbsGrid.prototype.notNull=function(p){return!(p==null||p==undefined)};TbsGrid.prototype.tbs_error=function(p){if(this.debug_mode){console.log("[TbsGrid error] "+p);r=false}};TbsGrid.prototype.tbs_caution=function(p){if(this.debug_mode){console.log("[TbsGrid caution] "+p);r=false}};TbsGrid.prototype.tbs_copyJson=function(p){return this.null(p)?{}:JSON.parse(JSON.stringify(p))};TbsGrid.prototype.tbs_empty=function(p){return p==null||p==undefined||this.tbs_trim(p)==""};TbsGrid.prototype.tbs_substr=function(s,index,len){let result="";try{s=s.toString();if(arguments.length==2)result=s.substring(index);else if(arguments.length==3)result=s.substring(index).substring(0,len);return result}catch(e){return result}};TbsGrid.prototype.tbs_trim=function(s){if(this.null(s))return"";else return s.toString().replace(/^\s+|\s+$/gi,"")};TbsGrid.prototype.tbs_round=function(num,dpLen){if(num>0)return+(Math.round(num.toString()+"e+"+dpLen.toString())+"e-"+dpLen.toString());else return-(Math.round(Math.abs(num).toString()+"e+"+dpLen.toString())+"e-"+dpLen.toString())};TbsGrid.prototype.tbs_ceil=function(num,dpLen){let s="1";for(let i=0;i<dpLen;i++){s+="0"}let n=parseInt(s);return Math.ceil(num*n)/n};TbsGrid.prototype.tbs_floor=function(num,dpLen){let s="1";for(let i=0;i<dpLen;i++){s+="0"}let n=parseInt(s);return Math.floor(num*n)/n};TbsGrid.prototype.tbs_getTreeRowCount=function(columns){let grid=this;let column_children=grid.column_children;const getDepth=column=>{return 1+(column[column_children]?Math.max(...column[column_children].map(getDepth)):0)};let depthList=[];for(let i=0,len=columns.length;i<len;i++){depthList.push(getDepth(columns[i]))}return Math.max(0,...depthList)};TbsGrid.prototype.changeOrderArray=function(arrayList,selectIndex,targetIndex){if(arrayList.length==0)return[];if(targetIndex==-1)newIndex=arrayList.length-1;else if(targetIndex==0)newIndex=0;else newIndex=selectIndex+targetIndex;if(newIndex<0||newIndex>=arrayList.length)return;const newArrayList=JSON.parse(JSON.stringify(arrayList));const target=newArrayList.splice(selectIndex,1)[0];newArrayList.splice(newIndex,0,target);arrayList=newArrayList;return newArrayList};TbsGrid.prototype.spliceAfter=function(arr,selectIndex,targetIndex){if(targetIndex==null){targetIndex=0}else targetIndex+=1;if(targetIndex==selectIndex)return arr;arr.splice(targetIndex,0,JSON.parse(JSON.stringify(arr[selectIndex])));if(targetIndex<selectIndex)selectIndex+=1;arr.splice(selectIndex,1);for(let x=0,colLen=arr.length;x<colLen;x++){arr[x].colIndex=x}return JSON.parse(JSON.stringify(arr))};TbsGrid.prototype.insertAfter=function(selectCol,targetCol){if(targetCol==null){selectCol.parentNode.insertBefore(selectCol,selectCol.parentNode.firstChild)}else{if(targetCol.cellIndex==this.columns.length-1){let cellIndex=targetCol.cellIndex;if(cellIndex>=this.columns.length)return;selectCol.parentNode.insertBefore(selectCol,null)}else{let cellIndex=targetCol.cellIndex+1;if(cellIndex>=this.columns.length)return;selectCol.parentNode.insertBefore(selectCol,targetCol.parentNode.childNodes[cellIndex])}}};